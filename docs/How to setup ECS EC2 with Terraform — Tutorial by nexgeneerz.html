<!DOCTYPE html>
<!-- saved from url=(0085)https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#The_network_configuration -->
<html lang="en-US" translate="no" prefix="og: http://ogp.me/ns#" class=" no-touch"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link data-optimized="2" rel="stylesheet" href="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/2c7a24436658c36694f25ec536c36c9c.css"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="A comprehensive guide for Amazon ECS EC2 using Terraform"><meta property="og:description" content="Our in-depth tutorial with full code samples describes Cloud Computing with ECS on EC2 in a production-ready setup with Infrastructure-as-Code via Terraform."><meta property="og:url" content="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/"><meta property="og:site_name" content="nexgeneerz.io"><meta property="article:tag" content="alb"><meta property="article:tag" content="bastion host"><meta property="article:tag" content="cloudfront"><meta property="article:tag" content="cloudwatch"><meta property="article:tag" content="ec2"><meta property="article:tag" content="ecs"><meta property="article:tag" content="iam"><meta property="article:tag" content="internet gateway"><meta property="article:tag" content="nat gateway"><meta property="article:tag" content="route53"><meta property="article:tag" content="security group"><meta property="article:tag" content="subnet"><meta property="article:tag" content="target group"><meta property="article:tag" content="trunk-based development"><meta property="article:tag" content="vpc"><meta property="article:section" content="AWS Cloud Computing"><meta property="article:published_time" content="2023-04-24T10:36:54+02:00"><meta property="article:modified_time" content="2023-04-26T14:56:18+02:00"><meta property="og:updated_time" content="2023-04-26T14:56:18+02:00"><meta property="og:image" content="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/20222908/AWS_ECS_EC2_Terraform.jpeg"><meta property="og:image:secure_url" content="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/20222908/AWS_ECS_EC2_Terraform.jpeg"><meta property="og:image:width" content="2000"><meta property="og:image:height" content="1125"><title>How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz</title><meta name="description" content="Follow our in-depth tutorial with all code samples about Cloud Computing with ECS EC2 in a production-grade setup using Infrastructure-as-Code via Terraform."><meta name="robots" content="follow, index, max-snippet:-1, max-video-preview:-1, max-image-preview:large"><link rel="canonical" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz"><meta property="og:description" content="Follow our in-depth tutorial with all code samples about Cloud Computing with ECS EC2 in a production-grade setup using Infrastructure-as-Code via Terraform."><meta property="og:url" content="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/"><meta property="og:site_name" content="nexgeneerz.io"><meta property="article:tag" content="alb"><meta property="article:tag" content="bastion host"><meta property="article:tag" content="cloudfront"><meta property="article:tag" content="cloudwatch"><meta property="article:tag" content="ec2"><meta property="article:tag" content="ecs"><meta property="article:tag" content="iam"><meta property="article:tag" content="internet gateway"><meta property="article:tag" content="nat gateway"><meta property="article:tag" content="route53"><meta property="article:tag" content="security group"><meta property="article:tag" content="subnet"><meta property="article:tag" content="target group"><meta property="article:tag" content="trunk-based development"><meta property="article:tag" content="vpc"><meta property="article:section" content="AWS Cloud Computing"><meta property="og:updated_time" content="2023-04-26T14:56:18+02:00"><meta property="og:image" content="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/20222908/AWS_ECS_EC2_Terraform.jpeg"><meta property="og:image:secure_url" content="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/20222908/AWS_ECS_EC2_Terraform.jpeg"><meta property="og:image:width" content="2000"><meta property="og:image:height" content="1125"><meta property="og:image:alt" content="AWS ECS EC2 Terraform"><meta property="og:image:type" content="image/jpeg"><meta property="article:published_time" content="2023-04-24T10:36:54+02:00"><meta property="article:modified_time" content="2023-04-26T14:56:18+02:00"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz"><meta name="twitter:description" content="Follow our in-depth tutorial with all code samples about Cloud Computing with ECS EC2 in a production-grade setup using Infrastructure-as-Code via Terraform."><meta name="twitter:image" content="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/20222908/AWS_ECS_EC2_Terraform.jpeg"><meta name="twitter:label1" content="Written by"><meta name="twitter:data1" content="Falko Burghausen"><meta name="twitter:label2" content="Time to read"><meta name="twitter:data2" content="42 minutes"> <script type="text/javascript" async="" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/recaptcha__en.js" crossorigin="anonymous" integrity="sha384-eZG8e4nRp0gEpRB75JBNzhS0vVseDRBVprGQYHJNXJCYwHihzdLYpvGhxa6VAhNb"></script><script async="" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/matomo.js"></script><script type="application/ld+json" class="rank-math-schema-pro">{"@context":"https://schema.org","@graph":[{"@type":"Place","@id":"https://nexgeneerz.io/#place","address":{"@type":"PostalAddress","streetAddress":"Chemin de la Pl\u00e2tri\u00e8re 3","postalCode":"1981","addressCountry":"Schweiz"}},{"@type":"Organization","@id":"https://nexgeneerz.io/#organization","name":"nexgeneerz.io","url":"https://nexgeneerz.io","email":"hello@nexgeneerz.io","address":{"@type":"PostalAddress","streetAddress":"Chemin de la Pl\u00e2tri\u00e8re 3","postalCode":"1981","addressCountry":"Schweiz"},"logo":{"@type":"ImageObject","@id":"https://nexgeneerz.io/#logo","url":"https://cdn.nexgeneerz.io/wp-content/uploads/2023/03/24074514/nexgeneerz-favicon.jpg","contentUrl":"https://cdn.nexgeneerz.io/wp-content/uploads/2023/03/24074514/nexgeneerz-favicon.jpg","caption":"nexgeneerz.io","inLanguage":"en-US","width":"600","height":"600"},"location":{"@id":"https://nexgeneerz.io/#place"}},{"@type":"WebSite","@id":"https://nexgeneerz.io/#website","url":"https://nexgeneerz.io","name":"nexgeneerz.io","publisher":{"@id":"https://nexgeneerz.io/#organization"},"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/20222908/AWS_ECS_EC2_Terraform.jpeg","url":"https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/20222908/AWS_ECS_EC2_Terraform.jpeg","width":"2000","height":"1125","caption":"AWS ECS EC2 Terraform","inLanguage":"en-US"},{"@type":"WebPage","@id":"https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#webpage","url":"https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/","name":"How to setup ECS EC2 with Terraform &mdash; Tutorial by nexgeneerz","datePublished":"2023-04-24T10:36:54+02:00","dateModified":"2023-04-26T14:56:18+02:00","isPartOf":{"@id":"https://nexgeneerz.io/#website"},"primaryImageOfPage":{"@id":"https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/20222908/AWS_ECS_EC2_Terraform.jpeg"},"inLanguage":"en-US"},{"@type":"Person","@id":"https://nexgeneerz.io/author/falko-burghausen/","name":"Falko Burghausen","description":"Falko Burghausen is one of the founders of the website beAnywhere and author of articles about travel, photography and new work.","url":"https://nexgeneerz.io/author/falko-burghausen/","image":{"@type":"ImageObject","@id":"https://secure.gravatar.com/avatar/4797f640c6637f259c12bc74755fb2cd?s=96&amp;d=mm&amp;r=g","url":"https://secure.gravatar.com/avatar/4797f640c6637f259c12bc74755fb2cd?s=96&amp;d=mm&amp;r=g","caption":"Falko Burghausen","inLanguage":"en-US"},"worksFor":{"@id":"https://nexgeneerz.io/#organization"}},{"@type":"BlogPosting","headline":"How to setup ECS EC2 with Terraform &mdash; Tutorial by nexgeneerz","keywords":"ecs ec2,ecs ec2 terraform,ecs ec2 autoscaling terraform,ecs ec2 terraform github,ecs ec2 autoscaling,ecs ec2 instance,ecs ec2 tutorial,ecs ec2 cluster,ecs ec2 vs fargate","datePublished":"2023-04-24T10:36:54+02:00","dateModified":"2023-04-26T14:56:18+02:00","author":{"@id":"https://nexgeneerz.io/author/falko-burghausen/","name":"Falko Burghausen"},"publisher":{"@id":"https://nexgeneerz.io/#organization"},"description":"Follow our in-depth tutorial with all code samples about Cloud Computing with ECS EC2 in a production-grade setup using Infrastructure-as-Code via Terraform.","name":"How to setup ECS EC2 with Terraform &mdash; Tutorial by nexgeneerz","@id":"https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#richSnippet","isPartOf":{"@id":"https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#webpage"},"image":{"@id":"https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/20222908/AWS_ECS_EC2_Terraform.jpeg"},"inLanguage":"en-US","mainEntityOfPage":{"@id":"https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#webpage"}}]}</script> <link rel="dns-prefetch" href="https://use.fontawesome.com/"><link rel="alternate" type="application/rss+xml" title="nexgeneerz.io » Feed" href="https://nexgeneerz.io/feed/"><link rel="alternate" type="application/rss+xml" title="nexgeneerz.io » Comments Feed" href="https://nexgeneerz.io/comments/feed/"><link rel="alternate" type="application/rss+xml" title="nexgeneerz.io » A comprehensive guide for Amazon ECS EC2 using Terraform Comments Feed" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/feed/"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="SKYPE_TOOLBAR" content="SKYPE_TOOLBAR_PARSER_COMPATIBLE"><style id="kevinbatdorf-code-block-pro-style-inline-css">.wp-block-kevinbatdorf-code-block-pro{-webkit-text-size-adjust:100%!important;box-sizing:border-box!important;direction:ltr!important;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;position:relative!important}.wp-block-kevinbatdorf-code-block-pro *{box-sizing:border-box!important}.wp-block-kevinbatdorf-code-block-pro pre,.wp-block-kevinbatdorf-code-block-pro pre *{font-size:inherit!important;line-height:inherit!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;background-image:none!important;border:0!important;border-radius:0!important;border-style:none!important;border-width:0!important;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)!important;color:inherit!important;font-family:inherit!important;margin:0!important;overflow:auto!important;overflow-wrap:normal!important;padding:16px 0 16px 16px!important;text-align:left!important;white-space:pre!important}.wp-block-kevinbatdorf-code-block-pro.padding-disabled:not(.code-block-pro-editor) pre{padding:0!important}.wp-block-kevinbatdorf-code-block-pro.padding-bottom-disabled pre{padding-bottom:0!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre code{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;background:none!important;background-color:transparent!important;border:0!important;border-radius:0!important;border-style:none!important;border-width:0!important;box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)!important;color:inherit!important;display:block!important;font-family:inherit!important;margin:0!important;overflow-wrap:normal!important;padding:0!important;text-align:left!important;white-space:pre!important;width:100%!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre code .line{display:inline-block!important;min-width:var(--cbp-block-width,100%)!important;vertical-align:top!important}.wp-block-kevinbatdorf-code-block-pro.cbp-has-line-numbers:not(.code-block-pro-editor) pre code .line{padding-left:calc(12px + var(--cbp-line-number-width, auto))!important}.wp-block-kevinbatdorf-code-block-pro.cbp-has-line-numbers:not(.code-block-pro-editor) pre code{counter-increment:step calc(var(--cbp-line-number-start, 1) - 1)!important;counter-reset:step!important}.wp-block-kevinbatdorf-code-block-pro pre code .line{position:relative!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre code .line:before{content:""!important;display:inline-block!important}.wp-block-kevinbatdorf-code-block-pro.cbp-has-line-numbers:not(.code-block-pro-editor) pre code .line:not(.cbp-line-number-disabled):before{color:var(--cbp-line-number-color,#999)!important;content:counter(step)!important;counter-increment:step!important;left:0!important;opacity:.5!important;position:absolute!important;text-align:right!important;transition-duration:.5s!important;transition-property:opacity!important;transition-timing-function:cubic-bezier(.4,0,.2,1)!important;-webkit-user-select:none!important;-moz-user-select:none!important;user-select:none!important;width:var(--cbp-line-number-width,auto)!important}.wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover .line{min-height:var(--cbp-block-height,100%)!important}.wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,.wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,.wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter{background:var(--cbp-line-highlight-color,rgb(14 165 233/.2))!important;left:-16px!important;min-height:var(--cbp-block-height,100%)!important;min-width:calc(var(--cbp-block-width, 100%) + 16px)!important;pointer-events:none!important;position:absolute!important;top:0!important;width:100%!important}[data-code-block-pro-font-family="Code-Pro-Comic-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,[data-code-block-pro-font-family="Code-Pro-Comic-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,[data-code-block-pro-font-family="Code-Pro-Comic-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter{top:-.125rem!important}[data-code-block-pro-font-family=Code-Pro-Fira-Code].wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Fira-Code].wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Fira-Code].wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter{top:-1.5px!important}[data-code-block-pro-font-family="Code-Pro-Deja-Vu-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,[data-code-block-pro-font-family="Code-Pro-Deja-Vu-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,[data-code-block-pro-font-family="Code-Pro-Deja-Vu-Mono.ttf"].wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Cozette].wp-block-kevinbatdorf-code-block-pro .line.cbp-line-highlight .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Cozette].wp-block-kevinbatdorf-code-block-pro .line.cbp-no-blur:hover .cbp-line-highlighter,[data-code-block-pro-font-family=Code-Pro-Cozette].wp-block-kevinbatdorf-code-block-pro.cbp-highlight-hover:not(.cbp-blur-enabled:not(.cbp-unblur-on-hover)) .line:hover .cbp-line-highlighter{top:-1px!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor).padding-disabled pre .line.cbp-line-highlight:after{left:0!important;width:100%!important}.wp-block-kevinbatdorf-code-block-pro.cbp-blur-enabled pre .line:not(.cbp-no-blur){filter:blur(1px)!important;opacity:.4!important;pointer-events:none!important;transition-duration:.2s!important;transition-property:all!important;transition-timing-function:cubic-bezier(.4,0,.2,1)!important}.wp-block-kevinbatdorf-code-block-pro.cbp-blur-enabled.cbp-unblur-on-hover:hover pre .line:not(.cbp-no-blur){--tw-blur:blur(0);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)!important;opacity:1!important;pointer-events:auto!important}.wp-block-kevinbatdorf-code-block-pro:not(.code-block-pro-editor) pre *{font-family:inherit!important}.cbp-see-more-simple-btn-hover{transition-property:none!important}.cbp-see-more-simple-btn-hover:hover{box-shadow:inset 0 0 100px 100px hsla(0,0%,100%,.1)!important}.code-block-pro-copy-button{border:0!important;border-style:none!important;border-width:0!important;cursor:pointer!important;left:auto!important;line-height:1!important;opacity:.1!important;padding:6px!important;position:absolute!important;right:0!important;top:0!important;transition-duration:.2s!important;transition-property:opacity!important;transition-timing-function:cubic-bezier(.4,0,.2,1)!important;z-index:10!important}.code-block-pro-copy-button:focus{opacity:.4!important}.code-block-pro-copy-button:not([data-has-text-button]){background:none!important;background-color:transparent!important}.wp-block-kevinbatdorf-code-block-pro.padding-disabled .code-block-pro-copy-button{padding:0!important}.wp-block-kevinbatdorf-code-block-pro:hover .code-block-pro-copy-button{opacity:.5!important}.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button:hover{opacity:.9!important}.code-block-pro-copy-button[data-has-text-button],.wp-block-kevinbatdorf-code-block-pro:hover .code-block-pro-copy-button[data-has-text-button]{opacity:1!important}.wp-block-kevinbatdorf-code-block-pro .code-block-pro-copy-button[data-has-text-button]:hover{opacity:.8!important}.code-block-pro-copy-button[data-has-text-button]{border-radius:.75rem!important;display:block!important;margin-right:.75rem!important;margin-top:.7rem!important;padding:.125rem .375rem!important}.code-block-pro-copy-button[data-inside-header-type=headlightsMuted],.code-block-pro-copy-button[data-inside-header-type^=headlights]{margin-top:.85rem!important}.code-block-pro-copy-button[data-inside-header-type=headlightsMutedAlt]{margin-top:.65rem!important}.code-block-pro-copy-button[data-inside-header-type=simpleString]{margin-top:.645rem!important}.code-block-pro-copy-button[data-inside-header-type=pillString]{margin-top:1rem!important}.code-block-pro-copy-button[data-inside-header-type=pillString] .cbp-btn-text{position:relative!important;top:1px!important}.cbp-btn-text{font-size:.75rem!important;line-height:1rem!important}.code-block-pro-copy-button .without-check{display:block!important}.code-block-pro-copy-button .with-check{display:none!important}.code-block-pro-copy-button.cbp-copying{opacity:1!important}.code-block-pro-copy-button.cbp-copying .without-check{display:none!important}.code-block-pro-copy-button.cbp-copying .with-check{display:block!important}.cbp-footer-link:hover{text-decoration-line:underline!important}</style><style id="rank-math-toc-block-style-inline-css">.wp-block-rank-math-toc-block nav ol{counter-reset:item}.wp-block-rank-math-toc-block nav ol li{display:block}.wp-block-rank-math-toc-block nav ol li:before{content:counters(item, ".") " ";counter-increment:item}</style><style id="classic-theme-styles-inline-css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style><style id="global-styles-inline-css">body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}</style><link rel="stylesheet" id="font-awesome-official-css" href="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/all.css" media="all" integrity="sha384-iw3OoTErCYJJB9mCa8LNS2hbsQ7M3C0EpIsO/H5+EGAkPGc6rk+V8i04oW/K5xq0" crossorigin="anonymous"><link rel="stylesheet" id="font-awesome-official-v4shim-css" href="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/v4-shims.css" media="all" integrity="sha384-TjXU13dTMPo+5ZlOUI1IGXvpmajjoetPqbUJqTx+uZ1bGwylKHNEItuVe/mg/H6l" crossorigin="anonymous"> <script src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/jquery.min.js" id="jquery-core-js"></script><script src="chrome-extension://jbkfoedolllekgbhcbcoahefnbanhhlh/content/fido2/page-script.js" id="bw-fido2-page-script"></script> <script></script><link rel="https://api.w.org/" href="https://nexgeneerz.io/wp-json/"><link rel="alternate" type="application/json" href="https://nexgeneerz.io/wp-json/wp/v2/posts/43185"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://nexgeneerz.io/xmlrpc.php?rsd"><meta name="generator" content="WordPress 6.4.3"><link rel="shortlink" href="https://nexgeneerz.io/?p=43185"><link rel="alternate" type="application/json+oembed" href="https://nexgeneerz.io/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F"><link rel="alternate" type="text/xml+oembed" href="https://nexgeneerz.io/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F&amp;format=xml"><style type="text/css" media="handheld, projection, screen">body #reading-position-indicator,body.admin-bar #reading-position-indicator {bottom: 0;top: inherit;height: 10px;background: rgba(221,221,221,0.05);}#reading-position-indicator::-webkit-progress-bar{background-color: rgba(221,221,221,0.05)}
			#reading-position-indicator {
	color: rgba(51,162,184,0.8);
background: rgba(221,221,221,0.05);
}
#reading-position-indicator::-webkit-progress-value {
background-color: rgba(51,162,184,0.8);
}
#reading-position-indicator::-moz-progress-bar {
background-color: rgba(51,162,184,0.8);
}
#reading-position-indicator::[aria-valuenow]:before {
background-color: rgba(51,162,184,0.8);
}
.progress-bar  {
background-color: rgba(51,162,184,0.8); ;
}</style><meta name="generator" content="Powered by WPBakery Page Builder - drag and drop page builder for WordPress."><link rel="icon" href="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/12195952/nexgeneerz-favicon-150x150.jpg" sizes="32x32"><link rel="icon" href="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/12195952/nexgeneerz-favicon-350x350.jpg" sizes="192x192"><link rel="apple-touch-icon" href="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/12195952/nexgeneerz-favicon-350x350.jpg"><meta name="msapplication-TileImage" content="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/12195952/nexgeneerz-favicon-350x350.jpg">
<noscript><style>.wpb_animate_when_almost_visible { opacity: 1; }</style></noscript><style id="us-icon-fonts">@font-face{font-display:block;font-style:normal;font-family:"fontawesome";font-weight:900;src:url("https://nexgeneerz.io/wp-content/fontawesome/fa-solid-900.woff2") format("woff2")}.fas{font-family:"fontawesome";font-weight:900}@font-face{font-display:block;font-style:normal;font-family:"fontawesome";font-weight:400;src:url("https://nexgeneerz.io/wp-content/fontawesome/fa-regular-400.woff2") format("woff2")}.far{font-family:"fontawesome";font-weight:400}@font-face{font-display:block;font-style:normal;font-family:"Font Awesome 5 Brands";font-weight:400;src:url("https://nexgeneerz.io/wp-content/fontawesome/fa-brands-400.woff2") format("woff2")}.fab{font-family:"Font Awesome 5 Brands";font-weight:400}@font-face{font-display:block;font-style:normal;font-family:"Material Icons";font-weight:400;src:url("https://nexgeneerz.io/wp-content/themes/Zephyr/fonts/material-icons.woff2?ver=8.21.3") format("woff2")}.material-icons{font-family:"Material Icons";font-weight:400}</style><style id="us-current-header-css">.l-subheader.at_top,.l-subheader.at_top .w-dropdown-list,.l-subheader.at_top .type_mobile .w-nav-list.level_1{background:#333333;color:var(--color-header-middle-text)}.no-touch .l-subheader.at_top a:hover,.no-touch .l-header.bg_transparent .l-subheader.at_top .w-dropdown.opened a:hover{color:var(--color-content-border)}.l-header.bg_transparent:not(.sticky) .l-subheader.at_top{background:#34393d;color:var(--color-header-middle-text)}.no-touch .l-header.bg_transparent:not(.sticky) .at_top .w-cart-link:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_top .w-text a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_top .w-html a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_top .w-nav>a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_top .w-menu a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_top .w-search>a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_top .w-dropdown a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_top .type_desktop .menu-item.level_1:hover>a{color:var(--color-content-border)}.l-subheader.at_middle,.l-subheader.at_middle .w-dropdown-list,.l-subheader.at_middle .type_mobile .w-nav-list.level_1{background:#1d2327;color:#fbfbfb}.no-touch .l-subheader.at_middle a:hover,.no-touch .l-header.bg_transparent .l-subheader.at_middle .w-dropdown.opened a:hover{color:var(--color-header-middle-text-hover)}.l-header.bg_transparent:not(.sticky) .l-subheader.at_middle{background:var(--color-header-transparent-bg);color:var(--color-header-transparent-text)}.no-touch .l-header.bg_transparent:not(.sticky) .at_middle .w-cart-link:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_middle .w-text a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_middle .w-html a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_middle .w-nav>a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_middle .w-menu a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_middle .w-search>a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_middle .w-dropdown a:hover,.no-touch .l-header.bg_transparent:not(.sticky) .at_middle .type_desktop .menu-item.level_1:hover>a{color:var(--color-header-transparent-text-hover)}.header_ver .l-header{background:#1d2327;color:#fbfbfb}@media (min-width:1281px){.hidden_for_default{display:none!important}.l-subheader.at_bottom{display:none}.l-header{position:relative;z-index:111;width:100%}.l-subheader{margin:0 auto}.l-subheader.width_full{padding-left:1.5rem;padding-right:1.5rem}.l-subheader-h{display:flex;align-items:center;position:relative;margin:0 auto;max-width:var(--site-content-width,1200px);height:inherit}.w-header-show{display:none}.l-header.pos_fixed{position:fixed;left:0}.l-header.pos_fixed:not(.notransition) .l-subheader{transition-property:transform,background,box-shadow,line-height,height;transition-duration:.3s;transition-timing-function:cubic-bezier(.78,.13,.15,.86)}.headerinpos_bottom.sticky_first_section .l-header.pos_fixed{position:fixed!important}.header_hor .l-header.sticky_auto_hide{transition:transform .3s cubic-bezier(.78,.13,.15,.86) .1s}.header_hor .l-header.sticky_auto_hide.down{transform:translateY(-110%)}.l-header.bg_transparent:not(.sticky) .l-subheader{box-shadow:none!important;background:none}.l-header.bg_transparent~.l-main .l-section.width_full.height_auto:first-of-type>.l-section-h{padding-top:0!important;padding-bottom:0!important}.l-header.pos_static.bg_transparent{position:absolute;left:0}.l-subheader.width_full .l-subheader-h{max-width:none!important}.l-header.shadow_thin .l-subheader.at_middle,.l-header.shadow_thin .l-subheader.at_bottom{box-shadow:0 1px 0 rgba(0,0,0,0.08)}.l-header.shadow_wide .l-subheader.at_middle,.l-header.shadow_wide .l-subheader.at_bottom{box-shadow:0 3px 5px -1px rgba(0,0,0,0.1),0 2px 1px -1px rgba(0,0,0,0.05)}.header_hor .l-subheader-cell>.w-cart{margin-left:0;margin-right:0}:root{--header-height:160px;--header-sticky-height:60px}.l-header:before{content:'160'}.l-header.sticky:before{content:'60'}.l-subheader.at_top{line-height:40px;height:40px}.l-header.sticky .l-subheader.at_top{line-height:0px;height:0px;overflow:hidden}.l-subheader.at_middle{line-height:120px;height:120px}.l-header.sticky .l-subheader.at_middle{line-height:60px;height:60px}.l-subheader.at_bottom{line-height:50px;height:50px}.l-header.sticky .l-subheader.at_bottom{line-height:50px;height:50px}.l-subheader.at_top .l-subheader-cell.at_left,.l-subheader.at_top .l-subheader-cell.at_right{display:flex;flex-basis:100px}.headerinpos_above .l-header.pos_fixed{overflow:hidden;transition:transform 0.3s;transform:translate3d(0,-100%,0)}.headerinpos_above .l-header.pos_fixed.sticky{overflow:visible;transform:none}.headerinpos_above .l-header.pos_fixed~.l-section>.l-section-h,.headerinpos_above .l-header.pos_fixed~.l-main .l-section:first-of-type>.l-section-h{padding-top:0!important}.headerinpos_below .l-header.pos_fixed:not(.sticky){position:absolute;top:100%}.headerinpos_below .l-header.pos_fixed~.l-main>.l-section:first-of-type>.l-section-h{padding-top:0!important}.headerinpos_below .l-header.pos_fixed~.l-main .l-section.full_height:nth-of-type(2){min-height:100vh}.headerinpos_below .l-header.pos_fixed~.l-main>.l-section:nth-of-type(2)>.l-section-h{padding-top:var(--header-height)}.headerinpos_bottom .l-header.pos_fixed:not(.sticky){position:absolute;top:100vh}.headerinpos_bottom .l-header.pos_fixed~.l-main>.l-section:first-of-type>.l-section-h{padding-top:0!important}.headerinpos_bottom .l-header.pos_fixed~.l-main>.l-section:first-of-type>.l-section-h{padding-bottom:var(--header-height)}.headerinpos_bottom .l-header.pos_fixed.bg_transparent~.l-main .l-section.valign_center:not(.height_auto):first-of-type>.l-section-h{top:calc( var(--header-height) / 2 )}.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-cart-dropdown,.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-nav.type_desktop .w-nav-list.level_2{bottom:100%;transform-origin:0 100%}.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-nav.type_mobile.m_layout_dropdown .w-nav-list.level_1{top:auto;bottom:100%;box-shadow:var(--box-shadow-up)}.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-nav.type_desktop .w-nav-list.level_3,.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-nav.type_desktop .w-nav-list.level_4{top:auto;bottom:0;transform-origin:0 100%}.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-dropdown-list{top:auto;bottom:-0.4em;padding-top:0.4em;padding-bottom:2.4em}.admin-bar .l-header.pos_static.bg_solid~.l-main .l-section.full_height:first-of-type{min-height:calc( 100vh - var(--header-height) - 32px )}.admin-bar .l-header.pos_fixed:not(.sticky_auto_hide)~.l-main .l-section.full_height:not(:first-of-type){min-height:calc( 100vh - var(--header-sticky-height) - 32px )}.admin-bar.headerinpos_below .l-header.pos_fixed~.l-main .l-section.full_height:nth-of-type(2){min-height:calc(100vh - 32px)}}@media (min-width:1176px) and (max-width:1280px){.hidden_for_laptops{display:none!important}.l-subheader.at_bottom{display:none}.l-header{position:relative;z-index:111;width:100%}.l-subheader{margin:0 auto}.l-subheader.width_full{padding-left:1.5rem;padding-right:1.5rem}.l-subheader-h{display:flex;align-items:center;position:relative;margin:0 auto;max-width:var(--site-content-width,1200px);height:inherit}.w-header-show{display:none}.l-header.pos_fixed{position:fixed;left:0}.l-header.pos_fixed:not(.notransition) .l-subheader{transition-property:transform,background,box-shadow,line-height,height;transition-duration:.3s;transition-timing-function:cubic-bezier(.78,.13,.15,.86)}.headerinpos_bottom.sticky_first_section .l-header.pos_fixed{position:fixed!important}.header_hor .l-header.sticky_auto_hide{transition:transform .3s cubic-bezier(.78,.13,.15,.86) .1s}.header_hor .l-header.sticky_auto_hide.down{transform:translateY(-110%)}.l-header.bg_transparent:not(.sticky) .l-subheader{box-shadow:none!important;background:none}.l-header.bg_transparent~.l-main .l-section.width_full.height_auto:first-of-type>.l-section-h{padding-top:0!important;padding-bottom:0!important}.l-header.pos_static.bg_transparent{position:absolute;left:0}.l-subheader.width_full .l-subheader-h{max-width:none!important}.l-header.shadow_thin .l-subheader.at_middle,.l-header.shadow_thin .l-subheader.at_bottom{box-shadow:0 1px 0 rgba(0,0,0,0.08)}.l-header.shadow_wide .l-subheader.at_middle,.l-header.shadow_wide .l-subheader.at_bottom{box-shadow:0 3px 5px -1px rgba(0,0,0,0.1),0 2px 1px -1px rgba(0,0,0,0.05)}.header_hor .l-subheader-cell>.w-cart{margin-left:0;margin-right:0}:root{--header-height:160px;--header-sticky-height:60px}.l-header:before{content:'160'}.l-header.sticky:before{content:'60'}.l-subheader.at_top{line-height:40px;height:40px}.l-header.sticky .l-subheader.at_top{line-height:0px;height:0px;overflow:hidden}.l-subheader.at_middle{line-height:120px;height:120px}.l-header.sticky .l-subheader.at_middle{line-height:60px;height:60px}.l-subheader.at_bottom{line-height:50px;height:50px}.l-header.sticky .l-subheader.at_bottom{line-height:50px;height:50px}.l-subheader.at_top .l-subheader-cell.at_left,.l-subheader.at_top .l-subheader-cell.at_right{display:flex;flex-basis:100px}.headerinpos_above .l-header.pos_fixed{overflow:hidden;transition:transform 0.3s;transform:translate3d(0,-100%,0)}.headerinpos_above .l-header.pos_fixed.sticky{overflow:visible;transform:none}.headerinpos_above .l-header.pos_fixed~.l-section>.l-section-h,.headerinpos_above .l-header.pos_fixed~.l-main .l-section:first-of-type>.l-section-h{padding-top:0!important}.headerinpos_below .l-header.pos_fixed:not(.sticky){position:absolute;top:100%}.headerinpos_below .l-header.pos_fixed~.l-main>.l-section:first-of-type>.l-section-h{padding-top:0!important}.headerinpos_below .l-header.pos_fixed~.l-main .l-section.full_height:nth-of-type(2){min-height:100vh}.headerinpos_below .l-header.pos_fixed~.l-main>.l-section:nth-of-type(2)>.l-section-h{padding-top:var(--header-height)}.headerinpos_bottom .l-header.pos_fixed:not(.sticky){position:absolute;top:100vh}.headerinpos_bottom .l-header.pos_fixed~.l-main>.l-section:first-of-type>.l-section-h{padding-top:0!important}.headerinpos_bottom .l-header.pos_fixed~.l-main>.l-section:first-of-type>.l-section-h{padding-bottom:var(--header-height)}.headerinpos_bottom .l-header.pos_fixed.bg_transparent~.l-main .l-section.valign_center:not(.height_auto):first-of-type>.l-section-h{top:calc( var(--header-height) / 2 )}.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-cart-dropdown,.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-nav.type_desktop .w-nav-list.level_2{bottom:100%;transform-origin:0 100%}.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-nav.type_mobile.m_layout_dropdown .w-nav-list.level_1{top:auto;bottom:100%;box-shadow:var(--box-shadow-up)}.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-nav.type_desktop .w-nav-list.level_3,.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-nav.type_desktop .w-nav-list.level_4{top:auto;bottom:0;transform-origin:0 100%}.headerinpos_bottom .l-header.pos_fixed:not(.sticky) .w-dropdown-list{top:auto;bottom:-0.4em;padding-top:0.4em;padding-bottom:2.4em}.admin-bar .l-header.pos_static.bg_solid~.l-main .l-section.full_height:first-of-type{min-height:calc( 100vh - var(--header-height) - 32px )}.admin-bar .l-header.pos_fixed:not(.sticky_auto_hide)~.l-main .l-section.full_height:not(:first-of-type){min-height:calc( 100vh - var(--header-sticky-height) - 32px )}.admin-bar.headerinpos_below .l-header.pos_fixed~.l-main .l-section.full_height:nth-of-type(2){min-height:calc(100vh - 32px)}}@media (min-width:601px) and (max-width:1175px){.hidden_for_tablets{display:none!important}.l-subheader.at_top{display:none}.l-subheader.at_bottom{display:none}.l-header{position:relative;z-index:111;width:100%}.l-subheader{margin:0 auto}.l-subheader.width_full{padding-left:1.5rem;padding-right:1.5rem}.l-subheader-h{display:flex;align-items:center;position:relative;margin:0 auto;max-width:var(--site-content-width,1200px);height:inherit}.w-header-show{display:none}.l-header.pos_fixed{position:fixed;left:0}.l-header.pos_fixed:not(.notransition) .l-subheader{transition-property:transform,background,box-shadow,line-height,height;transition-duration:.3s;transition-timing-function:cubic-bezier(.78,.13,.15,.86)}.headerinpos_bottom.sticky_first_section .l-header.pos_fixed{position:fixed!important}.header_hor .l-header.sticky_auto_hide{transition:transform .3s cubic-bezier(.78,.13,.15,.86) .1s}.header_hor .l-header.sticky_auto_hide.down{transform:translateY(-110%)}.l-header.bg_transparent:not(.sticky) .l-subheader{box-shadow:none!important;background:none}.l-header.bg_transparent~.l-main .l-section.width_full.height_auto:first-of-type>.l-section-h{padding-top:0!important;padding-bottom:0!important}.l-header.pos_static.bg_transparent{position:absolute;left:0}.l-subheader.width_full .l-subheader-h{max-width:none!important}.l-header.shadow_thin .l-subheader.at_middle,.l-header.shadow_thin .l-subheader.at_bottom{box-shadow:0 1px 0 rgba(0,0,0,0.08)}.l-header.shadow_wide .l-subheader.at_middle,.l-header.shadow_wide .l-subheader.at_bottom{box-shadow:0 3px 5px -1px rgba(0,0,0,0.1),0 2px 1px -1px rgba(0,0,0,0.05)}.header_hor .l-subheader-cell>.w-cart{margin-left:0;margin-right:0}:root{--header-height:80px;--header-sticky-height:60px}.l-header:before{content:'80'}.l-header.sticky:before{content:'60'}.l-subheader.at_top{line-height:40px;height:40px}.l-header.sticky .l-subheader.at_top{line-height:40px;height:40px}.l-subheader.at_middle{line-height:80px;height:80px}.l-header.sticky .l-subheader.at_middle{line-height:60px;height:60px}.l-subheader.at_bottom{line-height:50px;height:50px}.l-header.sticky .l-subheader.at_bottom{line-height:50px;height:50px}.l-subheader.at_top .l-subheader-cell.at_left,.l-subheader.at_top .l-subheader-cell.at_right{display:flex;flex-basis:100px}}@media (max-width:600px){.hidden_for_mobiles{display:none!important}.l-subheader.at_top{display:none}.l-subheader.at_bottom{display:none}.l-header{position:relative;z-index:111;width:100%}.l-subheader{margin:0 auto}.l-subheader.width_full{padding-left:1.5rem;padding-right:1.5rem}.l-subheader-h{display:flex;align-items:center;position:relative;margin:0 auto;max-width:var(--site-content-width,1200px);height:inherit}.w-header-show{display:none}.l-header.pos_fixed{position:fixed;left:0}.l-header.pos_fixed:not(.notransition) .l-subheader{transition-property:transform,background,box-shadow,line-height,height;transition-duration:.3s;transition-timing-function:cubic-bezier(.78,.13,.15,.86)}.headerinpos_bottom.sticky_first_section .l-header.pos_fixed{position:fixed!important}.header_hor .l-header.sticky_auto_hide{transition:transform .3s cubic-bezier(.78,.13,.15,.86) .1s}.header_hor .l-header.sticky_auto_hide.down{transform:translateY(-110%)}.l-header.bg_transparent:not(.sticky) .l-subheader{box-shadow:none!important;background:none}.l-header.bg_transparent~.l-main .l-section.width_full.height_auto:first-of-type>.l-section-h{padding-top:0!important;padding-bottom:0!important}.l-header.pos_static.bg_transparent{position:absolute;left:0}.l-subheader.width_full .l-subheader-h{max-width:none!important}.l-header.shadow_thin .l-subheader.at_middle,.l-header.shadow_thin .l-subheader.at_bottom{box-shadow:0 1px 0 rgba(0,0,0,0.08)}.l-header.shadow_wide .l-subheader.at_middle,.l-header.shadow_wide .l-subheader.at_bottom{box-shadow:0 3px 5px -1px rgba(0,0,0,0.1),0 2px 1px -1px rgba(0,0,0,0.05)}.header_hor .l-subheader-cell>.w-cart{margin-left:0;margin-right:0}:root{--header-height:70px;--header-sticky-height:70px}.l-header:before{content:'70'}.l-header.sticky:before{content:'70'}.l-subheader.at_top{line-height:40px;height:40px}.l-header.sticky .l-subheader.at_top{line-height:0px;height:0px;overflow:hidden}.l-subheader.at_middle{line-height:70px;height:70px}.l-header.sticky .l-subheader.at_middle{line-height:70px;height:70px}.l-subheader.at_bottom{line-height:50px;height:50px}.l-header.sticky .l-subheader.at_bottom{line-height:50px;height:50px}}@media (min-width:1281px){.ush_image_1{height:30px!important}.l-header.sticky .ush_image_1{height:25px!important}}@media (min-width:1176px) and (max-width:1280px){.ush_image_1{height:30px!important}.l-header.sticky .ush_image_1{height:25px!important}}@media (min-width:601px) and (max-width:1175px){.ush_image_1{height:30px!important}.l-header.sticky .ush_image_1{height:25px!important}}@media (max-width:600px){.ush_image_1{height:20px!important}.l-header.sticky .ush_image_1{height:20px!important}}.header_hor .ush_menu_1.type_desktop .menu-item.level_1>a:not(.w-btn){padding-left:10px;padding-right:10px}.header_hor .ush_menu_1.type_desktop .menu-item.level_1>a.w-btn{margin-left:10px;margin-right:10px}.header_hor .ush_menu_1.type_desktop.align-edges>.w-nav-list.level_1{margin-left:-10px;margin-right:-10px}.header_ver .ush_menu_1.type_desktop .menu-item.level_1>a:not(.w-btn){padding-top:10px;padding-bottom:10px}.header_ver .ush_menu_1.type_desktop .menu-item.level_1>a.w-btn{margin-top:10px;margin-bottom:10px}.ush_menu_1.type_desktop .menu-item-has-children.level_1>a>.w-nav-arrow{display:inline-block}.ush_menu_1.type_desktop .menu-item:not(.level_1){font-size:15px}.ush_menu_1.type_mobile .w-nav-anchor.level_1,.ush_menu_1.type_mobile .w-nav-anchor.level_1 + .w-nav-arrow{font-size:18px}.ush_menu_1.type_mobile .w-nav-anchor:not(.level_1),.ush_menu_1.type_mobile .w-nav-anchor:not(.level_1) + .w-nav-arrow{font-size:14px}@media (min-width:1281px){.ush_menu_1 .w-nav-icon{font-size:}}@media (min-width:1176px) and (max-width:1280px){.ush_menu_1 .w-nav-icon{font-size:}}@media (min-width:601px) and (max-width:1175px){.ush_menu_1 .w-nav-icon{font-size:}}@media (max-width:600px){.ush_menu_1 .w-nav-icon{font-size:}}.ush_menu_1 .w-nav-icon>div{border-width:3px}@media screen and (max-width:1175px){.w-nav.ush_menu_1>.w-nav-list.level_1{display:none}.ush_menu_1 .w-nav-control{display:block}}.ush_menu_1 .w-nav-item.level_1>a:not(.w-btn):focus,.no-touch .ush_menu_1 .w-nav-item.level_1.opened>a:not(.w-btn),.no-touch .ush_menu_1 .w-nav-item.level_1:hover>a:not(.w-btn){background:#ffffff;color:var(--color-header-middle-text-hover)}.ush_menu_1 .w-nav-item.level_1.current-menu-item>a:not(.w-btn),.ush_menu_1 .w-nav-item.level_1.current-menu-ancestor>a:not(.w-btn),.ush_menu_1 .w-nav-item.level_1.current-page-ancestor>a:not(.w-btn){background:;color:var(--color-content-link)}.l-header.bg_transparent:not(.sticky) .ush_menu_1.type_desktop .w-nav-item.level_1.current-menu-item>a:not(.w-btn),.l-header.bg_transparent:not(.sticky) .ush_menu_1.type_desktop .w-nav-item.level_1.current-menu-ancestor>a:not(.w-btn),.l-header.bg_transparent:not(.sticky) .ush_menu_1.type_desktop .w-nav-item.level_1.current-page-ancestor>a:not(.w-btn){background:transparent;color:var(--color-content-bg-alt)}.ush_menu_1 .w-nav-list:not(.level_1){background:#ffffff;color:var(--color-header-middle-text)}.no-touch .ush_menu_1 .w-nav-item:not(.level_1)>a:focus,.no-touch .ush_menu_1 .w-nav-item:not(.level_1):hover>a{background:var(--color-content-bg-alt);color:var(--color-header-middle-text)}.ush_menu_1 .w-nav-item:not(.level_1).current-menu-item>a,.ush_menu_1 .w-nav-item:not(.level_1).current-menu-ancestor>a,.ush_menu_1 .w-nav-item:not(.level_1).current-page-ancestor>a{background:var(--color-header-middle-bg);color:var(--color-content-link)}.header_hor .ush_menu_2.type_desktop .menu-item.level_1>a:not(.w-btn){padding-left:15px;padding-right:15px}.header_hor .ush_menu_2.type_desktop .menu-item.level_1>a.w-btn{margin-left:15px;margin-right:15px}.header_hor .ush_menu_2.type_desktop.align-edges>.w-nav-list.level_1{margin-left:-15px;margin-right:-15px}.header_ver .ush_menu_2.type_desktop .menu-item.level_1>a:not(.w-btn){padding-top:15px;padding-bottom:15px}.header_ver .ush_menu_2.type_desktop .menu-item.level_1>a.w-btn{margin-top:15px;margin-bottom:15px}.ush_menu_2.type_desktop .menu-item-has-children.level_1>a>.w-nav-arrow{display:inline-block}.ush_menu_2.type_desktop .menu-item:not(.level_1){font-size:15px}.ush_menu_2.type_mobile .w-nav-anchor.level_1,.ush_menu_2.type_mobile .w-nav-anchor.level_1 + .w-nav-arrow{font-size:25px}.ush_menu_2.type_mobile .w-nav-anchor:not(.level_1),.ush_menu_2.type_mobile .w-nav-anchor:not(.level_1) + .w-nav-arrow{font-size:20px}@media (min-width:1281px){.ush_menu_2 .w-nav-icon{font-size:}}@media (min-width:1176px) and (max-width:1280px){.ush_menu_2 .w-nav-icon{font-size:}}@media (min-width:601px) and (max-width:1175px){.ush_menu_2 .w-nav-icon{font-size:}}@media (max-width:600px){.ush_menu_2 .w-nav-icon{font-size:}}.ush_menu_2 .w-nav-icon>div{border-width:3px}@media screen and (max-width:1174px){.w-nav.ush_menu_2>.w-nav-list.level_1{display:none}.ush_menu_2 .w-nav-control{display:block}}.ush_menu_2 .w-nav-item.level_1>a:not(.w-btn):focus,.no-touch .ush_menu_2 .w-nav-item.level_1.opened>a:not(.w-btn),.no-touch .ush_menu_2 .w-nav-item.level_1:hover>a:not(.w-btn){background:;color:var(--color-content-bg-alt)}.ush_menu_2 .w-nav-item.level_1.current-menu-item>a:not(.w-btn),.ush_menu_2 .w-nav-item.level_1.current-menu-ancestor>a:not(.w-btn),.ush_menu_2 .w-nav-item.level_1.current-page-ancestor>a:not(.w-btn){background:;color:var(--color-content-link)}.l-header.bg_transparent:not(.sticky) .ush_menu_2.type_desktop .w-nav-item.level_1.current-menu-item>a:not(.w-btn),.l-header.bg_transparent:not(.sticky) .ush_menu_2.type_desktop .w-nav-item.level_1.current-menu-ancestor>a:not(.w-btn),.l-header.bg_transparent:not(.sticky) .ush_menu_2.type_desktop .w-nav-item.level_1.current-page-ancestor>a:not(.w-btn){background:transparent;color:var(--color-content-bg-alt)}.ush_menu_2 .w-nav-list:not(.level_1){background:#ffffff;color:var(--color-header-middle-text)}.no-touch .ush_menu_2 .w-nav-item:not(.level_1)>a:focus,.no-touch .ush_menu_2 .w-nav-item:not(.level_1):hover>a{background:var(--color-content-bg-alt);color:var(--color-header-middle-text)}.ush_menu_2 .w-nav-item:not(.level_1).current-menu-item>a,.ush_menu_2 .w-nav-item:not(.level_1).current-menu-ancestor>a,.ush_menu_2 .w-nav-item:not(.level_1).current-page-ancestor>a{background:var(--color-header-middle-bg);color:var(--color-content-link)}.ush_search_1 .w-search-form{background:var(--color-content-bg);color:var(--color-content-text)}@media (min-width:1281px){.ush_search_1.layout_simple{max-width:240px}.ush_search_1.layout_modern.active{width:240px}.ush_search_1{font-size:}}@media (min-width:1176px) and (max-width:1280px){.ush_search_1.layout_simple{max-width:250px}.ush_search_1.layout_modern.active{width:250px}.ush_search_1{font-size:}}@media (min-width:601px) and (max-width:1175px){.ush_search_1.layout_simple{max-width:200px}.ush_search_1.layout_modern.active{width:200px}.ush_search_1{font-size:}}@media (max-width:600px){.ush_search_1{font-size:}}.ush_socials_1 .w-socials-list{margin:-0em}.ush_socials_1 .w-socials-item{padding:0em}.ush_menu_1{font-size:15px!important;font-family:var(--h1-font-family)!important;font-weight:600!important}.ush_dropdown_1{font-size:16px!important;font-weight:700!important}.ush_menu_2{font-size:15px!important;font-family:var(--h1-font-family)!important;font-weight:600!important}@media (min-width:1176px) and (max-width:1280px){.ush_menu_1{font-size:15px!important;font-family:var(--h1-font-family)!important;font-weight:600!important}.ush_dropdown_1{font-size:16px!important;font-weight:700!important}.ush_menu_2{font-size:15px!important;font-family:var(--h1-font-family)!important;font-weight:600!important}}@media (min-width:601px) and (max-width:1175px){.ush_menu_1{font-size:15px!important;font-family:var(--h1-font-family)!important;font-weight:600!important}.ush_dropdown_1{font-size:16px!important;font-weight:700!important}.ush_menu_2{font-size:15px!important;font-family:var(--h1-font-family)!important;font-weight:600!important}}@media (max-width:600px){.ush_menu_1{font-size:15px!important;font-family:var(--h1-font-family)!important;font-weight:600!important}.ush_dropdown_1{font-size:16px!important;font-weight:700!important}.ush_menu_2{font-size:15px!important;font-family:var(--h1-font-family)!important;font-weight:600!important}}</style><style id="us-design-options-css">.us_custom_ee96f3d4{max-width:150px!important;margin-top:1.5rem!important;margin-bottom:1.5rem!important}.us_custom_7cf6dd33{color:var(--color-header-middle-text-hover)!important;font-size:0.8rem!important;letter-spacing:1px!important;text-transform:uppercase!important;margin-top:1rem!important}.us_custom_fb1528c0{margin-top:1.5rem!important;margin-bottom:1.5rem!important}.us_custom_70facfb4{margin-bottom:1.5rem!important}.us_custom_173c0608{margin-top:1.5rem!important}.us_custom_aa57ee06{color:var(--color-content-bg-alt)!important;margin-top:2.5rem!important}.us_custom_ca3ca538{font-size:24px!important;margin-top:1.5rem!important}.us_custom_c8e5d0b2{padding-top:0.5rem!important;padding-bottom:1.5rem!important;padding-right:1.5rem!important;border-right-width:1px!important;border-color:#f3f3f3!important;border-right-style:solid!important}.us_custom_28437073{height:40px!important;margin-bottom:0.5rem!important}.us_custom_a79eefa2{font-size:0.8rem!important;letter-spacing:1px!important;text-transform:uppercase!important;padding:0!important;margin:0!important}.us_custom_eec4eb20{border-color:#f3f3f3!important;padding:0.5rem 1.5rem 1.5rem 1.5rem!important}.us_custom_aec7dde0{margin-top:0.5rem!important}.us_custom_fc97a67e{border-top-width:1px!important;border-color:#f3f3f3!important;border-top-style:solid!important}.us_custom_f00529e1{margin-top:1.5rem!important;margin-bottom:1.5rem!important;margin-right:0.5rem!important}.us_custom_b258765b{margin:1.5rem 0.5rem 1.5rem 0.5rem!important}.us_custom_aa1f24f8{margin-left:0.5rem!important;margin-top:1.5rem!important;margin-bottom:1.5rem!important}.us_custom_09a1fd4c{padding:8% 2.5rem 8% 2.5rem!important}.us_custom_a518f36e{animation-name:fade!important}.us_custom_6a02d20a{height:40vh!important}.us_custom_6b9b0aaa{font-size:3rem!important;line-height:1.3!important;font-weight:900!important;text-shadow:1px 1px 4px rgba(0,0,0,0.19)!important}.us_custom_2cb3cbd6{text-align:left!important;font-size:2rem!important}.us_custom_a47756f1{text-align:left!important;font-size:1.6rem!important;margin-top:8rem!important}.us_custom_397da033{animation-name:afl!important;animation-delay:0.4s!important;background:#3F454A!important}.us_custom_f2900c84{color:var(--color-header-middle-text-hover)!important;font-size:0.8rem!important;width:100%!important;margin-bottom:3.5rem!important}.us_custom_fe9223b9{color:var(--color-header-middle-text-hover)!important;font-size:0.8rem!important;margin-right:0!important}.us_custom_d1d3b3c6{line-height:1.4!important}.us_custom_1e0e9307{font-size:18px!important}.us_custom_7e20fa79{animation-name:afl!important}.us_custom_da7ceeb3{font-size:1rem!important}.us_custom_dfc0bc7e{text-align:center!important;font-size:0.8rem!important}.us_custom_36de0169{font-size:0.8rem!important;margin-top:1.5rem!important}.us_custom_c89666ab{font-size:0.8rem!important;margin-bottom:0.5rem!important}@media (min-width:1176px) and (max-width:1280px){.us_custom_6a02d20a{height:40vh!important}.us_custom_6b9b0aaa{font-size:3rem!important}.us_custom_2cb3cbd6{text-align:left!important;font-size:2rem!important}.us_custom_a47756f1{margin-top:8rem!important}.us_custom_c89666ab{font-size:0.8rem!important}}@media (min-width:601px) and (max-width:1175px){.us_custom_6a02d20a{height:60vh!important}.us_custom_6b9b0aaa{font-size:3rem!important}.us_custom_2cb3cbd6{text-align:left!important;font-size:2rem!important}.us_custom_a47756f1{margin-top:2rem!important}.us_custom_c89666ab{text-align:center!important;font-size:0.8rem!important}}@media (max-width:600px){.us_custom_6a02d20a{height:70vh!important}.us_custom_6b9b0aaa{font-size:1.8rem!important;line-height:1.2!important}.us_custom_2cb3cbd6{text-align:left!important;font-size:1rem!important}.us_custom_a47756f1{margin-top:2rem!important}.us_custom_397da033{padding-top:0!important;padding-bottom:0!important}.us_custom_c89666ab{text-align:center!important;font-size:0.8rem!important}}</style></head><body class="post-template-default single single-post postid-43185 single-format-standard wp-embed-responsive l-body Zephyr_8.21.3 us-core_8.21.3 links_underline headerinpos_top essb-8.9 wpb-js-composer js-comp-ver-7.4 vc_responsive header_hor state_default"><div class="l-canvas type_wide"><header id="page-header" class="l-header id_41887 pos_fixed bg_transparent shadow_thin sticky"><div class="l-subheader at_top"><div class="l-subheader-h"><div class="l-subheader-cell at_left"></div><div class="l-subheader-cell at_center"></div><div class="l-subheader-cell at_right"></div></div></div><div class="l-subheader at_middle"><div class="l-subheader-h"><div class="l-subheader-cell at_left"><div class="w-image ush_image_1"><a href="https://nexgeneerz.io/" aria-label="nexgeneers-logo-white" class="w-image-h"><img width="600" height="71" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/nexgeneers-logo-white-600x71.png" class="attachment-medium size-medium" alt="" decoding="async" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2023/03/22152929/nexgeneers-logo-white-600x71.png 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/03/22152929/nexgeneers-logo-white-768x91.png 768w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/03/22152929/nexgeneers-logo-white.png 1000w" sizes="(max-width: 600px) 100vw, 600px"><span class="ripple-container"></span></a></div></div><div class="l-subheader-cell at_center"></div><div class="l-subheader-cell at_right"><nav class="w-nav hidden_for_tablets hidden_for_mobiles ush_menu_2 mega-menu-dark height_full dropdown_opacity m_align_left m_layout_fullscreen m_effect_aft type_desktop"><a class="w-nav-control" aria-label="Menu" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#"><span>Menu</span><div class="w-nav-icon"><div></div></div></a><ul class="w-nav-list level_1 hover_underline"><li id="menu-item-43138" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home w-nav-item level_1 menu-item-43138"><a class="w-nav-anchor level_1" href="https://nexgeneerz.io/"><span class="w-nav-title">Start</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a></li><li id="menu-item-43094" class="mega-menu-wrapper menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children w-nav-item level_1 menu-item-43094 togglable"><a class="w-nav-anchor level_1" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#"><span class="w-nav-title">Services</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a><ul class="w-nav-list level_2"><li id="menu-item-43095" class="menu-item menu-item-type-post_type menu-item-object-us_page_block w-nav-item level_2 menu-item-43095"><section class="l-section wpb_row height_auto width_full"><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_top type_default stacking_default"><div class="vc_col-sm-6 wpb_column vc_column_container"><div class="vc_column-inner us_custom_c8e5d0b2"><div class="wpb_wrapper"><div class="w-hwrapper us_custom_28437073 menu-headline-button-right valign_middle align_none" style="--hwrapper-gap:1.20rem"><h4 style="text-align: left" class="vc_custom_heading us_custom_a79eefa2">Our services for you</h4></div><article class="bea-link-card "><div class="flex-container"><div class="icon"><i style="background: #e70084; color: #ffffff" class="fas fa-chalkboard-teacher"></i></div><div><h4><a href="https://nexgeneerz.io/fractional-cto-as-a-service/" class="main-link">CTO-as-a-Service</a></h4><p>Work with experienced tech leaders</p></div></div></article><article class="bea-link-card "><div class="flex-container"><div class="icon"><i style="background: #e70084; color: #ffffff" class="fas fa-cloud-upload"></i></div><div><h4><a href="https://nexgeneerz.io/cloud-for-startups-aws/" class="main-link">Cloud Computing for Startups</a></h4><p>Start your business cloud-native</p></div></div></article></div></div></div><div class="vc_col-sm-6 wpb_column vc_column_container"><div class="vc_column-inner us_custom_eec4eb20"><div class="wpb_wrapper"><div class="w-hwrapper us_custom_28437073 menu-headline-button-right valign_middle align_none" style="--hwrapper-gap:1.20rem"><h4 style="text-align: left" class="vc_custom_heading us_custom_a79eefa2">How we work</h4><div class="w-btn-wrapper align_none"><a class="w-btn us-btn-style_26 icon_atleft" title="Articles" href="https://nexgeneerz.io/startup-knowledge-hub/"><i class="fas fa-caret-right"></i><span class="w-btn-label">See all articles</span><span class="ripple-container"></span></a></div></div><div class="w-grid us_custom_aec7dde0 mega-menu-blog-post-wrapper type_grid layout_43097 with_css_animation" id="us_grid_1" style="--gap:0.5rem;"><style>.layout_43097 .w-grid-item-h{}.layout_43097 .usg_post_image_1{width:30%!important;margin-left:0!important;margin-right:5%!important;border-radius:0.5rem!important}.layout_43097 .usg_vwrapper_1{width:65%!important;margin-left:0!important;margin-right:0!important}.layout_43097 .usg_post_title_1{font-size:15px!important;line-height:1.6!important}@media (min-width:1176px) and (max-width:1280px){.layout_43097 .usg_post_image_1{width:30%!important;margin-left:0!important;margin-right:5%!important;border-radius:0.5rem!important}.layout_43097 .usg_vwrapper_1{width:65%!important;margin-left:0!important;margin-right:0!important}.layout_43097 .usg_post_title_1{font-size:15px!important;line-height:1.6!important}}@media (min-width:601px) and (max-width:1175px){.layout_43097 .usg_post_image_1{width:30%!important;margin-left:0!important;margin-right:5%!important;border-radius:0.5rem!important}.layout_43097 .usg_vwrapper_1{width:65%!important;margin-left:0!important;margin-right:0!important}.layout_43097 .usg_post_title_1{font-size:15px!important;line-height:1.6!important}}@media (max-width:600px){.layout_43097 .usg_post_image_1{width:100%!important;margin-left:0!important;margin-bottom:5%!important;margin-right:0!important}.layout_43097 .usg_vwrapper_1{width:100%!important}}</style><div class="w-grid-list"><article class="w-grid-item us_animate_fade size_1x1 post-43232 post type-post status-publish format-standard has-post-thumbnail hentry category-amazon-web-services-aws-cloud-computing tag-alb tag-cloudfront tag-cloudwatch tag-ecs tag-iam tag-internet-gateway tag-nat-gateway tag-route53 tag-security-group tag-subnet tag-target-group tag-trunk-based-development tag-vpc start" data-id="43232"><div class="w-grid-item-h">
<a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/" class="w-grid-item-anchor" aria-label="How to setup Amazon ECS Fargate using Terraform"></a><div class="w-hwrapper usg_hwrapper_1 mega-menu-blog-post align_none valign_middle wrap" style="--hwrapper-gap:1.20rem"><div class="w-post-elm post_image usg_post_image_1 has_width has_ratio"><div style="padding-bottom:56.25%"></div><a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/" aria-label="How to setup Amazon ECS Fargate using Terraform"><img width="2000" height="1125" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/ECS-Fargate-scaled.jpg" class="attachment-us_600_600_crop size-us_600_600_crop wp-post-image" alt="In-depth tutorial ECS Fargate" decoding="async" loading="lazy" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-scaled.jpg 2000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-600x338.jpg 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-350x197.jpg 350w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-1000x563.jpg 1000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-768x432.jpg 768w" sizes="(max-width: 2000px) 100vw, 2000px" title="How to setup Amazon ECS Fargate using Terraform 1"></a></div><div class="w-vwrapper usg_vwrapper_1 align_none valign_top"><h4 class="w-post-elm post_title usg_post_title_1 entry-title color_link_inherit"><a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/">How to setup Amazon ECS Fargate using Terraform</a></h4></div></div></div></article><article class="w-grid-item us_animate_fade size_1x1 post-42861 post type-post status-publish format-standard has-post-thumbnail hentry category-engineering-productivity tag-agile tag-estimations tag-product-development tag-roadmap-planning tag-user-stories start" data-id="42861"><div class="w-grid-item-h">
<a href="https://nexgeneerz.io/about-story-points-estimations-and-other-expensive-misconceptions/" class="w-grid-item-anchor" aria-label="About Story Points, Estimations and other expensive misconceptions"></a><div class="w-hwrapper usg_hwrapper_1 mega-menu-blog-post align_none valign_middle wrap" style="--hwrapper-gap:1.20rem"><div class="w-post-elm post_image usg_post_image_1 has_width has_ratio"><div style="padding-bottom:56.25%"></div><a href="https://nexgeneerz.io/about-story-points-estimations-and-other-expensive-misconceptions/" aria-label="About Story Points, Estimations and other expensive misconceptions"><img width="2000" height="1126" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/story-points-estimations-user-stories.jpeg" class="attachment-us_600_600_crop size-us_600_600_crop wp-post-image" alt="Story points, estimations, user stories" decoding="async" loading="lazy" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories.jpeg 2000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories-600x338.jpeg 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories-350x197.jpeg 350w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories-1000x563.jpeg 1000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories-768x432.jpeg 768w" sizes="(max-width: 2000px) 100vw, 2000px" title="About Story Points, Estimations and other expensive misconceptions 2"></a></div><div class="w-vwrapper usg_vwrapper_1 align_none valign_top"><h4 class="w-post-elm post_title usg_post_title_1 entry-title color_link_inherit"><a href="https://nexgeneerz.io/about-story-points-estimations-and-other-expensive-misconceptions/">About Story Points, Estimations and other expensive misconceptions</a></h4></div></div></div></article><article class="w-grid-item us_animate_fade size_1x1 post-42251 post type-post status-publish format-standard has-post-thumbnail hentry category-personal-development tag-career-development tag-communication start" data-id="42251"><div class="w-grid-item-h">
<a href="https://nexgeneerz.io/communication-skills-for-software-engineers/" class="w-grid-item-anchor" aria-label="Effective communication skills for software engineers"></a><div class="w-hwrapper usg_hwrapper_1 mega-menu-blog-post align_none valign_middle wrap" style="--hwrapper-gap:1.20rem"><div class="w-post-elm post_image usg_post_image_1 has_width has_ratio"><div style="padding-bottom:56.25%"></div><a href="https://nexgeneerz.io/communication-skills-for-software-engineers/" aria-label="Effective communication skills for software engineers"><img width="2000" height="1126" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/communication-as-a-software-engineer-600x600.jpeg" class="attachment-us_600_600_crop size-us_600_600_crop wp-post-image" alt="Communication skills for software engineers" decoding="async" loading="lazy" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2022/12/07185451/communication-as-a-software-engineer.jpeg 2000w, https://cdn.nexgeneerz.io/wp-content/uploads/2022/12/07185451/communication-as-a-software-engineer-600x338.jpeg 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2022/12/07185451/communication-as-a-software-engineer-768x432.jpeg 768w" sizes="(max-width: 2000px) 100vw, 2000px" title="Effective communication skills for software engineers 3"></a></div><div class="w-vwrapper usg_vwrapper_1 align_none valign_top"><h4 class="w-post-elm post_title usg_post_title_1 entry-title color_link_inherit"><a href="https://nexgeneerz.io/communication-skills-for-software-engineers/">Effective communication skills for software engineers</a></h4></div></div></div></article></div><div class="w-grid-preloader"><div class="g-preloader type_1"><div></div></div></div></div></div></div></div></div></div></section><section class="l-section wpb_row us_custom_fc97a67e height_auto width_full"><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_top type_default stacking_default"><div class="vc_col-sm-4 wpb_column vc_column_container"><div class="vc_column-inner us_custom_f00529e1"><div class="wpb_wrapper"><article class="bea-link-card "><div class="flex-container"><div class="icon"><i style="background: #33a2b8; color: #ffffff" class="fas fa-envelope"></i></div><div><h4><a href="https://nexgeneerz.io/contact/" class="main-link">Get in touch</a></h4><p>Contact us by email</p></div></div></article></div></div></div><div class="vc_col-sm-4 wpb_column vc_column_container"><div class="vc_column-inner us_custom_b258765b"><div class="wpb_wrapper"><article class="bea-link-card "><div class="flex-container"><div class="icon"><i style="background: #33a2b8; color: #ffffff" class="fas fa-linkedin"></i></div><div><h4><a href="https://www.linkedin.com/company/nexgeneerz" class="main-link">LinkedIn</a></h4><p>Follow us on LinkedIn</p></div></div></article></div></div></div><div class="vc_col-sm-4 wpb_column vc_column_container"><div class="vc_column-inner us_custom_aa1f24f8"><div class="wpb_wrapper"><article class="bea-link-card "><div class="flex-container"><div class="icon"><i style="background: #33a2b8; color: #ffffff" class="fas fa-medium"></i></div><div><h4><a href="https://medium.com/@falko.burghausen" class="main-link">Medium</a></h4><p>Read our articles on Medium</p></div></div></article></div></div></div></div></div></section></li></ul></li><li id="menu-item-43137" class="menu-item menu-item-type-post_type menu-item-object-page w-nav-item level_1 menu-item-43137"><a class="w-nav-anchor level_1" href="https://nexgeneerz.io/startup-knowledge-hub/"><span class="w-nav-title">Knowledge Hub</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a></li><li id="menu-item-42177" class="menu-item menu-item-type-post_type menu-item-object-page w-nav-item level_1 menu-item-42177"><a class="w-nav-anchor level_1" href="https://nexgeneerz.io/our-story-falko-burghausen/"><span class="w-nav-title">Our story</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a></li><li id="menu-item-42702" class="menu-item menu-item-type-post_type menu-item-object-page w-nav-item level_1 menu-item-42702"><a class="w-nav-anchor level_1" href="https://nexgeneerz.io/contact/"><span class="w-nav-title">Contact</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a></li><li class="w-nav-close"></li></ul></nav><div class="w-search ush_search_1 elm_in_header layout_fullscreen with_ripple"><div class="w-search-background" style="background:var(--color-content-bg-grad)"></div><a class="w-search-open" role="button" aria-label="Search" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#"><i class="fas fa-search"></i></a><div class="w-search-form"><form class="w-form-row for_text" role="search" action="https://nexgeneerz.io/" method="get"><div class="w-form-row-field"><input type="text" name="s" placeholder="Search" aria-label="Search" value=""></div><button aria-label="Close" class="w-search-close" type="button"></button></form></div></div><div class="w-socials hidden_for_mobiles ush_socials_1 color_text shape_circle style_default hover_fade"><div class="w-socials-list"><div class="w-socials-item linkedin"><a target="_blank" rel="nofollow" href="https://www.linkedin.com/company/nexgeneerz" class="w-socials-item-link" title="LinkedIn" aria-label="LinkedIn"><span class="w-socials-item-link-hover"></span><i class="fab fa-linkedin"></i><span class="ripple-container"></span></a></div><div class="w-socials-item medium"><a target="_blank" rel="nofollow" href="https://medium.com/@falko.burghausen" class="w-socials-item-link" title="Medium" aria-label="Medium"><span class="w-socials-item-link-hover"></span><i class="fab fa-medium"></i><span class="ripple-container"></span></a></div><div class="w-socials-item github"><a target="_blank" rel="nofollow" href="https://github.com/nexgeneerz" class="w-socials-item-link" title="GitHub" aria-label="GitHub"><span class="w-socials-item-link-hover"></span><i class="fab fa-github"></i><span class="ripple-container"></span></a></div></div></div></div></div></div><div class="l-subheader for_hidden hidden"><nav class="w-nav hidden_for_laptops ush_menu_1 mobile-menu height_full dropdown_mdesign m_align_left m_layout_fullscreen m_effect_aft type_desktop"><a class="w-nav-control" aria-label="Menu" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#"><span>Menu</span><div class="w-nav-icon"><div></div></div></a><ul class="w-nav-list level_1 hover_underline"><li id="menu-item-43150" class="menu-item menu-item-type-post_type menu-item-object-us_page_block w-nav-item level_1 menu-item-43150"><div class="w-image us_custom_ee96f3d4 align_none"><a title="Start" href="https://nexgeneerz.io/" aria-label="nexgeneers-logo-white" class="w-image-h"><img width="1000" height="118" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/nexgeneers-logo-white.png" class="attachment-full size-full" alt="" decoding="async" fetchpriority="high" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2023/03/22152929/nexgeneers-logo-white.png 1000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/03/22152929/nexgeneers-logo-white-600x71.png 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/03/22152929/nexgeneers-logo-white-768x91.png 768w" sizes="(max-width: 1000px) 100vw, 1000px"><span class="ripple-container"></span></a></div></li><li id="menu-item-43147" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children w-nav-item level_1 menu-item-43147 togglable"><a class="w-nav-anchor level_1" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#"><span class="w-nav-title">Services</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a><ul class="w-nav-list level_2"><li id="menu-item-43151" class="menu-item menu-item-type-post_type menu-item-object-page w-nav-item level_2 menu-item-43151"><a class="w-nav-anchor level_2" href="https://nexgeneerz.io/fractional-cto-as-a-service/"><span class="w-nav-title">Fractional CTO-as-a-Service</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a></li><li id="menu-item-43152" class="menu-item menu-item-type-post_type menu-item-object-page w-nav-item level_2 menu-item-43152"><a class="w-nav-anchor level_2" href="https://nexgeneerz.io/cloud-for-startups-aws/"><span class="w-nav-title">Cloud Computing for Startups</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a></li></ul></li><li id="menu-item-43153" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children w-nav-item level_1 menu-item-43153 togglable"><a class="w-nav-anchor level_1" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#"><span class="w-nav-title">Knowledge Hub</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a><ul class="w-nav-list level_2"><li id="menu-item-43154" class="menu-item menu-item-type-post_type menu-item-object-us_page_block w-nav-item level_2 menu-item-43154"><h4 style="text-align: left" class="vc_custom_heading us_custom_7cf6dd33">Read our articles</h4><div class="w-grid us_custom_fb1528c0 type_grid layout_43145 with_css_animation" id="us_grid_2" style="--gap:0.5rem;"><style>.layout_43145 .w-grid-item-h{}.layout_43145 .usg_post_image_1{font-size:0.8rem!important;max-width:50px!important;margin-left:0!important;border-radius:0.5rem!important}.layout_43145 .usg_vwrapper_1{width:65%!important}.layout_43145 .usg_post_title_1{font-size:0.8rem!important;line-height:1.2!important}@media (min-width:1176px) and (max-width:1280px){.layout_43145 .usg_post_image_1{font-size:0.8rem!important;max-width:50px!important;margin-left:0!important;border-radius:0.5rem!important}.layout_43145 .usg_vwrapper_1{width:65%!important}.layout_43145 .usg_post_title_1{font-size:0.8rem!important;line-height:1.2!important}}@media (min-width:601px) and (max-width:1175px){.layout_43145 .usg_post_image_1{font-size:0.8rem!important;max-width:50px!important;margin-left:0!important;border-radius:0.5rem!important}.layout_43145 .usg_vwrapper_1{width:65%!important}.layout_43145 .usg_post_title_1{font-size:0.8rem!important;line-height:1.2!important}}@media (max-width:600px){.layout_43145 .usg_vwrapper_1{width:100%!important}}</style><div class="w-grid-list"><article class="w-grid-item us_animate_afr size_1x1 post-43232 post type-post status-publish format-standard has-post-thumbnail hentry category-amazon-web-services-aws-cloud-computing tag-alb tag-cloudfront tag-cloudwatch tag-ecs tag-iam tag-internet-gateway tag-nat-gateway tag-route53 tag-security-group tag-subnet tag-target-group tag-trunk-based-development tag-vpc start" data-id="43232"><div class="w-grid-item-h">
<a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/" class="w-grid-item-anchor" aria-label="How to setup Amazon ECS Fargate using Terraform"></a><div class="w-hwrapper usg_hwrapper_1 mega-menu-blog-post align_none valign_middle" style="--hwrapper-gap:1rem"><div class="w-post-elm post_image usg_post_image_1 has_ratio"><div style="padding-bottom:100%"></div><a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/" aria-label="How to setup Amazon ECS Fargate using Terraform"><img width="2000" height="1125" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/ECS-Fargate-scaled.jpg" class="attachment-full size-full wp-post-image" alt="In-depth tutorial ECS Fargate" decoding="async" loading="lazy" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-scaled.jpg 2000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-600x338.jpg 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-350x197.jpg 350w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-1000x563.jpg 1000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-768x432.jpg 768w" sizes="(max-width: 2000px) 100vw, 2000px" title="How to setup Amazon ECS Fargate using Terraform 4"></a></div><div class="w-vwrapper usg_vwrapper_1 align_none valign_middle"><h4 class="w-post-elm post_title usg_post_title_1 entry-title color_link_inherit"><a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/">How to setup Amazon ECS Fargate using Terraform</a></h4></div></div></div></article><article class="w-grid-item us_animate_afr size_1x1 post-42861 post type-post status-publish format-standard has-post-thumbnail hentry category-engineering-productivity tag-agile tag-estimations tag-product-development tag-roadmap-planning tag-user-stories start" data-id="42861"><div class="w-grid-item-h">
<a href="https://nexgeneerz.io/about-story-points-estimations-and-other-expensive-misconceptions/" class="w-grid-item-anchor" aria-label="About Story Points, Estimations and other expensive misconceptions"></a><div class="w-hwrapper usg_hwrapper_1 mega-menu-blog-post align_none valign_middle" style="--hwrapper-gap:1rem"><div class="w-post-elm post_image usg_post_image_1 has_ratio"><div style="padding-bottom:100%"></div><a href="https://nexgeneerz.io/about-story-points-estimations-and-other-expensive-misconceptions/" aria-label="About Story Points, Estimations and other expensive misconceptions"><img width="2000" height="1126" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/story-points-estimations-user-stories.jpeg" class="attachment-full size-full wp-post-image" alt="Story points, estimations, user stories" decoding="async" loading="lazy" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories.jpeg 2000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories-600x338.jpeg 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories-350x197.jpeg 350w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories-1000x563.jpeg 1000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/07202311/story-points-estimations-user-stories-768x432.jpeg 768w" sizes="(max-width: 2000px) 100vw, 2000px" title="About Story Points, Estimations and other expensive misconceptions 5"></a></div><div class="w-vwrapper usg_vwrapper_1 align_none valign_middle"><h4 class="w-post-elm post_title usg_post_title_1 entry-title color_link_inherit"><a href="https://nexgeneerz.io/about-story-points-estimations-and-other-expensive-misconceptions/">About Story Points, Estimations and other expensive misconceptions</a></h4></div></div></div></article><article class="w-grid-item us_animate_afr size_1x1 post-42251 post type-post status-publish format-standard has-post-thumbnail hentry category-personal-development tag-career-development tag-communication start" data-id="42251"><div class="w-grid-item-h">
<a href="https://nexgeneerz.io/communication-skills-for-software-engineers/" class="w-grid-item-anchor" aria-label="Effective communication skills for software engineers"></a><div class="w-hwrapper usg_hwrapper_1 mega-menu-blog-post align_none valign_middle" style="--hwrapper-gap:1rem"><div class="w-post-elm post_image usg_post_image_1 has_ratio"><div style="padding-bottom:100%"></div><a href="https://nexgeneerz.io/communication-skills-for-software-engineers/" aria-label="Effective communication skills for software engineers"><img width="2000" height="1126" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/communication-as-a-software-engineer.jpeg" class="attachment-full size-full wp-post-image" alt="Communication skills for software engineers" decoding="async" loading="lazy" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2022/12/07185451/communication-as-a-software-engineer.jpeg 2000w, https://cdn.nexgeneerz.io/wp-content/uploads/2022/12/07185451/communication-as-a-software-engineer-600x338.jpeg 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2022/12/07185451/communication-as-a-software-engineer-768x432.jpeg 768w" sizes="(max-width: 2000px) 100vw, 2000px" title="Effective communication skills for software engineers 6"></a></div><div class="w-vwrapper usg_vwrapper_1 align_none valign_middle"><h4 class="w-post-elm post_title usg_post_title_1 entry-title color_link_inherit"><a href="https://nexgeneerz.io/communication-skills-for-software-engineers/">Effective communication skills for software engineers</a></h4></div></div></div></article></div><div class="w-grid-preloader"><div class="g-preloader type_1"><div></div></div></div></div><div class="w-btn-wrapper align_justify"><a class="w-btn us-btn-style_27 us_custom_70facfb4 icon_atright" title="Articles" href="https://nexgeneerz.io/startup-knowledge-hub/"><span class="w-btn-label">All articles</span><i class="fas fa-caret-right"></i><span class="ripple-container"></span></a></div></li></ul></li><li id="menu-item-42719" class="menu-item menu-item-type-post_type menu-item-object-page w-nav-item level_1 menu-item-42719"><a class="w-nav-anchor level_1" href="https://nexgeneerz.io/our-story-falko-burghausen/"><span class="w-nav-title">Our story</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a></li><li id="menu-item-42715" class="menu-item menu-item-type-post_type menu-item-object-page w-nav-item level_1 menu-item-42715"><a class="w-nav-anchor level_1" href="https://nexgeneerz.io/contact/"><span class="w-nav-title">Contact</span><span class="w-nav-arrow"></span><span class="ripple-container"></span></a></li><li id="menu-item-42781" class="menu-item menu-item-type-post_type menu-item-object-us_page_block w-nav-item level_1 menu-item-42781"><h4 style="text-align: left" class="vc_custom_heading us_custom_aa57ee06">Follow us on Social Media</h4><div class="w-socials us_custom_ca3ca538 color_text shape_rounded style_default hover_fade" style="--gap:0.2em;"><div class="w-socials-list"><div class="w-socials-item linkedin"><a target="_blank" href="https://www.linkedin.com/company/nexgeneerz" class="w-socials-item-link" title="LinkedIn" aria-label="LinkedIn"><span class="w-socials-item-link-hover"></span><i class="fab fa-linkedin"></i><span class="ripple-container"></span></a></div><div class="w-socials-item medium"><a target="_blank" rel="nofollow" href="https://medium.com/@falko.burghausen" class="w-socials-item-link" title="Medium" aria-label="Medium"><span class="w-socials-item-link-hover"></span><i class="fab fa-medium"></i><span class="ripple-container"></span></a></div><div class="w-socials-item email"><a href="mailto:hello@nexgeneerz.io" class="w-socials-item-link" title="Email" aria-label="Email"><span class="w-socials-item-link-hover"></span><i class="fas fa-envelope"></i><span class="ripple-container"></span></a></div><div class="w-socials-item rss"><a target="_blank" rel="nofollow" href="https://nexgeneerz.io/feed" class="w-socials-item-link" title="RSS" aria-label="RSS"><span class="w-socials-item-link-hover"></span><i class="fas fa-rss"></i><span class="ripple-container"></span></a></div></div></div></li><li class="w-nav-close"></li></ul></nav></div></header><main id="page-content" class="l-main"><section class="l-section wpb_row us_custom_09a1fd4c for_blogpost blogpost_modern agency_style height_medium full_height valign_center color_primary"><div class="l-section-overlay" style="background:linear-gradient(117deg, rgba(51,162,184,1) 29%, rgba(231,0,132,1) 91%)"></div><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_middle type_default stacking_default"><div class="vc_col-sm-12 wpb_column vc_column_container"><div class="vc_column-inner us_custom_a518f36e us_animate_this start"><div class="wpb_wrapper"><div class="w-vwrapper us_custom_6a02d20a agency-style-content-wrapper align_left valign_middle"><h1 class="w-post-elm post_title us_custom_6b9b0aaa align_left entry-title color_link_inherit">A comprehensive guide for Amazon ECS EC2 using Terraform</h1><div class="w-post-elm post_custom_field us_custom_2cb3cbd6 type_text reading_time color_link_inherit"><span class="w-post-elm-before">Estimated reading time: </span><span class="w-post-elm-value">28</span><span class="w-post-elm-after"> minutes</span></div><div class="w-post-elm post_author us_custom_a47756f1 author-story agency-author vcard author color_link_inherit with_ava avapos_left"><a href="https://nexgeneerz.io/author/falko-burghausen/" class="fn" aria-hidden="true" tabindex="-1"><div class="post-author-ava" style="font-size:48px;"><img alt="Avatar of Falko Burghausen" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/4797f640c6637f259c12bc74755fb2cd.jpeg" srcset="https://secure.gravatar.com/avatar/4797f640c6637f259c12bc74755fb2cd?s=96&amp;d=mm&amp;r=g 2x" class="avatar avatar-48 photo" height="48" width="48" decoding="async"></div></a><div class="post-author-meta"><a href="https://nexgeneerz.io/author/falko-burghausen/" class="post-author-name fn">Falko Burghausen</a></div></div><div class="w-btn-wrapper align_center"><a class="w-btn us-btn-style_29 scrolldown-btn icon_atleft text_none active" aria-label="Button" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#article-content"><i class="fas fa-arrow-down"></i><span class="ripple-container"></span></a></div></div></div></div></div></div></div></section><section class="l-section wpb_row agency_style_wrapper height_auto width_full color_alternate" id="article-content"><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_top type_boxes stacking_default"><div class="vc_col-sm-4 wpb_column vc_column_container toc-column  has_bg_color"><div class="vc_column-inner us_custom_397da033 us_animate_this type_sticky start"><div class="wpb_wrapper"><div class="wpb_text_column"><div class="wpb_wrapper"><div class="lwptoc lwptoc-inherit" data-smooth-scroll="1" data-smooth-scroll-offset="120" data-lwptoc-initialized="1"><div class="lwptoc_i"><div class="lwptoc_header">
<b class="lwptoc_title">Table of contents</b>                    <span class="lwptoc_toggle">
<a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" class="lwptoc_toggle_label" data-label="Anzeigen">Verbergen</a>
</span></div><div class="lwptoc_items lwptoc_items-visible"><ul class="lwptoc_itemWrap"><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#ECS_EC2_-_Container_orchestration_without_Kubernetes" class="">
<span class="lwptoc_item_number">1.</span>
<span class="lwptoc_item_label">ECS EC2 – Container orchestration without Kubernetes</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#A_comparison_with_ECS_Fargate" class="">
<span class="lwptoc_item_number">2.</span>
<span class="lwptoc_item_label">A comparison with ECS Fargate</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#ECS_on_EC2_and_CICD" class="">
<span class="lwptoc_item_number">3.</span>
<span class="lwptoc_item_label">ECS on EC2 and CI/CD</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#Overview_of_the_main_components" class="">
<span class="lwptoc_item_number">4.</span>
<span class="lwptoc_item_label">Overview of the main components</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#Route_53_ECR_and_Certificate_Manager" class="">
<span class="lwptoc_item_number">5.</span>
<span class="lwptoc_item_label">Route 53, ECR and Certificate Manager</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#The_network_configuration" class="">
<span class="lwptoc_item_number">6.</span>
<span class="lwptoc_item_label">The network configuration</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#The_compute_layer_on_EC2" class="">
<span class="lwptoc_item_number">7.</span>
<span class="lwptoc_item_label">The compute layer on EC2</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#Autoscaling_on_ECS">
<span class="lwptoc_item_number">8.</span>
<span class="lwptoc_item_label">Autoscaling on ECS</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#Application_Load_Balancer">
<span class="lwptoc_item_number">9.</span>
<span class="lwptoc_item_label">Application Load Balancer</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#Security_Groups">
<span class="lwptoc_item_number">10.</span>
<span class="lwptoc_item_label">Security Groups</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#CloudFront_Distribution">
<span class="lwptoc_item_number">11.</span>
<span class="lwptoc_item_label">CloudFront Distribution</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#Bastion_Host">
<span class="lwptoc_item_number">12.</span>
<span class="lwptoc_item_label">Bastion Host</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#DNS_settings_with_Route_53">
<span class="lwptoc_item_number">13.</span>
<span class="lwptoc_item_label">DNS settings with Route 53</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#IAM_Roles_in_AWS_ECS">
<span class="lwptoc_item_number">14.</span>
<span class="lwptoc_item_label">IAM Roles in AWS ECS</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#Connect_to_the_EC2_Instances">
<span class="lwptoc_item_number">15.</span>
<span class="lwptoc_item_label">Connect to the EC2 Instances</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#What_is_missing">
<span class="lwptoc_item_number">16.</span>
<span class="lwptoc_item_label">What is missing?</span>
</a></li><li class="lwptoc_item">    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#Conclusion">
<span class="lwptoc_item_number">17.</span>
<span class="lwptoc_item_label">Conclusion</span>
</a></li></ul></div></div></div></div></div></div></div></div><div class="vc_col-sm-8 wpb_column vc_column_container"><div class="vc_column-inner us_custom_a518f36e us_animate_this start"><div class="wpb_wrapper"><div class="w-hwrapper us_custom_f2900c84 has_text_color valign_top wrap align_none" style="--hwrapper-gap:1.20rem"><nav class="g-breadcrumbs us_custom_fe9223b9 has_text_color separator_icon align_none hide_current"><div class="g-breadcrumbs-item"><a href="https://nexgeneerz.io/">Start</a><meta content="1"></div><div class="g-breadcrumbs-separator"><i class="far fa-angle-right"></i></div><div class="g-breadcrumbs-item"><a href="https://nexgeneerz.io/topic/cloud-infrastructure/">Cloud Infrastructure</a></div><div class="g-breadcrumbs-separator"><i class="far fa-angle-right"></i></div><div class="g-breadcrumbs-item"><a href="https://nexgeneerz.io/topic/cloud-infrastructure/amazon-web-services-aws-cloud-computing/">AWS Cloud Computing</a></div><div class="g-breadcrumbs-separator"><i class="far fa-angle-right"></i></div><div class="g-breadcrumbs-item"><a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/">A comprehensive guide for Amazon ECS EC2 using Terraform</a><meta content="2"></div></nav><time class="w-post-elm post_date us_custom_d1d3b3c6 agency-date hide_on_mobiles entry-date published" datetime="2023-04-24T10:36:54+02:00" title="24 April 2023 at 10:36:54 Europe/Zurich"><span class="w-post-elm-before">Published: </span>12 months ago</time></div><div class="w-post-elm post_content us_custom_1e0e9307 source-sans-pro without_sections"><p>In one of the previous articles in this series on Cloud Computing in AWS, we looked at<a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/" data-type="post" data-id="43232"> ECS on Fargate</a>. This article is about a very similar setup, which however offers much more flexibility, but at the same time comes along with a higher operational effort.</p><p>In our series, we emphasize examples that are suitable for a production environment and thus include aspects such as network security, access permissions or scalability and operational effort. All code examples are nevertheless reduced to the minimum for better clarity and, for example, deliberately do not feature any tags. All infrastructure is configured as infrastructure-as-code for easier reproducibility with <a href="http://terraform.io/" target="_blank" data-type="URL" data-id="http://terraform.io" rel="noreferrer noopener">Terraform</a> and can serve as a basis for your own setups.</p><p>Please note that provisioning AWS infrastructure resources may incur costs. Our Terraform-based tutorials help you remove all resources with a single command <code>terraform destroy</code> to avoid unintended costs.</p><p>At nexgeneerz.io, <a href="https://nexgeneerz.io/cloud-for-startups-aws/" data-type="page" data-id="42670">we help startups and SMEs build their Cloud Infrastructure</a> and guide them in gaining technical expertise. Often complex setups like container-based applications in a highly available environment are the initial conditions, where AWS ECS plays an important role as one of the most flexible Cloud Computing technology on the market.</p><p><a href="https://github.com/nexgeneerz/aws-scenario-ecs-ec2" data-type="URL" data-id="https://github.com/nexgeneerz/aws-scenario-ecs-ec2" target="_blank" rel="noreferrer noopener">You can find the entire tutorial on GitHub</a>, including all the source code to create a fully functional setup based on ECS on EC2 with Terraform. The only requirement is a top-level domain hosted on AWS (like <code>example.com</code>). More information can be found in the <a href="https://github.com/nexgeneerz/aws-scenario-ecs-ec2/blob/main/README.md" target="_blank" data-type="URL" data-id="https://github.com/nexgeneerz/aws-scenario-ecs-ec2/blob/main/README.md" rel="noreferrer noopener">README</a> of the project. Clone the repository with:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span role="button" tabindex="0" data-code="git clone git@github.com:nexgeneerz/aws-scenario-ecs-ec2.git" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #FFCB6B">git</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">clone</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">git@github.com:nexgeneerz/aws-scenario-ecs-ec2.git</span></span></code></pre></div><h2 class="wp-block-heading"><span id="ECS_EC2_-_Container_orchestration_without_Kubernetes">ECS EC2 – Container orchestration without Kubernetes</span></h2><p>Just like <a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/" data-type="post" data-id="43232">Fargate</a>, ECS EC2 is a runtime environment for services that run in Docker containers and offer maximum flexibility when it comes to creating applications of any size and type. A large part of the setup is accordingly also identical to the variant with Fargate, but here we have to take care of the EC2 instances (also called <em>Container Instances</em> in the ECS context) ourselves. The target architecture looks like this:</p><figure class="wp-block-image size-full"><img decoding="async" width="1801" height="1751" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/AWS_ECS_EC2_diagram.jpg" alt="Architecture overview for ECS on EC2" class="wp-image-43227" title="A comprehensive guide for Amazon ECS EC2 using Terraform 8" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/19110859/AWS_ECS_EC2_diagram.jpg 1801w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/19110859/AWS_ECS_EC2_diagram-600x583.jpg 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/19110859/AWS_ECS_EC2_diagram-350x340.jpg 350w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/19110859/AWS_ECS_EC2_diagram-1000x972.jpg 1000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/19110859/AWS_ECS_EC2_diagram-768x747.jpg 768w" sizes="(max-width: 1801px) 100vw, 1801px"><figcaption class="wp-element-caption">Architecture overview for ECS on EC2</figcaption></figure><p>In our scenario, we create the basis for a multi-tier architecture, but focus on one layer that serves as the presentation tier. The service is accessible via the Internet and is designed for High Availability (HA). This is achieved by deploying it in multiple Availability Zones (AZ), while dynamic scaling is ensured by an Autoscaling TargetTracking Policy.</p><h2 class="wp-block-heading"><span id="A_comparison_with_ECS_Fargate">A comparison with ECS Fargate</span></h2><p>In principle, we can of course achieve a production-ready result with both EC2 and <a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/" data-type="post" data-id="43232">Fargate</a>. The fundamental difference is that Fargate is the serverless variant of ECS on EC2: the entire management of the underlying infrastructure is taken over by AWS here – and Amazon naturally makes itself pay for this.</p><p>The following points should be considered when comparing EC2 versus Fargate:</p><ul><li>At a certain point, Fargate is more expensive than EC2. Determining the exact break-even is difficult due to the many variables, but as a rule of thumb you can say that Fargate is cheaper as long as the memory usage in the cluster does not exceed about 50%. On the other hand, Fargate becomes more expensive at higher utilization levels. <a href="https://aws.amazon.com/de/blogs/containers/theoretical-cost-optimization-by-amazon-ecs-launch-type-fargate-vs-ec2/" data-type="URL" data-id="https://aws.amazon.com/de/blogs/containers/theoretical-cost-optimization-by-amazon-ecs-launch-type-fargate-vs-ec2/" target="_blank" rel="noreferrer noopener">AWS gives a good insight into the pricing structure in this blog post</a>.</li><li>When using Fargate, the team does not have to worry about managing clusters, instances, containers, task definitions or other computing infrastructure like Autoscaling Groups at all. Depending on the team structure and existing knowledge, this can result in a not inconsiderable cost saving, but this is very individual depending on the company and is difficult to quantify.</li><li>ECS on EC2 offers much more flexibility when it comes to selecting specific instance types or installing and running daemon tasks, agents and the like on the EC2 Instances. Fargate does not offer this flexibility. For example, if you want to run the <a href="https://docs.datadoghq.com/agent/" data-type="URL" data-id="https://docs.datadoghq.com/agent/" target="_blank" rel="noreferrer noopener">Datadog Agent</a> as one daemon task per instance, this is not possible with Fargate.</li><li>The mounting of EBS Volumes is not possible with Fargate. Likewise, the use of GPUs in Fargate clusters is not supported.</li></ul><p>So, in summary, we can say that ECS on EC2 is the means of choice especially if you have the necessary know-how as well as the staff to manage the infrastructure, need a high or complete flexibility over the infrastructure and/or need to run special software like daemons as standalone daemon tasks. We must not forget that we can of course also mix within AWS and run individual services on Fargate, others on EC2 Instances. By the way, Spot Instances are supported by both ECS variants.</p><h2 class="wp-block-heading"><span id="ECS_on_EC2_and_CICD">ECS on EC2 and CI/CD</span></h2><p>When selecting technologies and strategies for a cloud-based infrastructure setup, the first question is always whether the technology supports a modern development approach with continuous integration and continuous deployment (CI/CD) as well as infrastructure-as-code. Fortunately, the latter is always given with all major Cloud Providers such as AWS, Google Cloud or Microsoft Azure thanks to Terraform, Pulumi or AWS’s own CloudFormation offering. For CI/CD, the following criteria must be met:</p><ul><li>All infrastructure must be able to be deployed and provisioned automatically.</li><li>It must be possible to replace running services with a new version on a rolling basis without interrupting ongoing operations.</li><li>The infrastructure and all changes must be versioned and available as code.</li><li>We want to support different environments like <code>development</code> or <code>production</code> using one code base.</li><li>All important components and resources such as instances must be monitorable with the help of metrics.</li></ul><p>In this article, we focus primarily on AWS-specific resources. We will look at the setup for automating the deployments, the project structure, and the underlying development principles in detail in a separate article, since the topic of ECS on EC2 is already complex enough on its own.</p><h2 class="wp-block-heading"><span id="Overview_of_the_main_components">Overview of the main components</span></h2><p>The most important components in our setup are the following:</p><ul><li><a href="https://docs.aws.amazon.com/route53/index.html" data-type="URL" data-id="https://docs.aws.amazon.com/route53/index.html" target="_blank" rel="noreferrer noopener">Route 53</a> for all routing and domain settings.</li><li><a href="https://docs.aws.amazon.com/ecr/" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/ecr/" rel="noreferrer noopener">Elastic Container Registry</a> (ECR) for deploying container images that contain our service</li><li><a href="https://docs.aws.amazon.com/acm/" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/acm/" rel="noreferrer noopener">Certificate Manager</a> for creating SSL certificates for the Application Load Balancer (ALB) and CloudFront distribution</li><li><a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html" rel="noreferrer noopener">Application Load Balancer</a> (ALB) and Target Groups/Listeners for routing requests to the different container instances</li><li><a href="https://docs.aws.amazon.com/autoscaling/index.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/autoscaling/index.html" rel="noreferrer noopener">Autoscaling Group</a> (ASG) and Autoscaling Policies for elastic scaling of EC2 instances</li><li><a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/launch-templates.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/autoscaling/ec2/userguide/launch-templates.html" rel="noreferrer noopener">Launch Template</a> with the definition of the EC2 instances, which are the basis for ECS</li><li><a href="https://en.wikipedia.org/wiki/Bastion_host" target="_blank" data-type="URL" data-id="https://en.wikipedia.org/wiki/Bastion_host" rel="noreferrer noopener">Bastion Host</a> to gain access via SSH for debugging purposes to the EC2 instances</li><li><a href="https://docs.aws.amazon.com/cloudfront/index.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/cloudfront/index.html" rel="noreferrer noopener">CloudFront Distribution</a> for worldwide fast access to our service like AWS Edge Locations as well as the possibility to use AWS WAF against SQL Injections or similar and AWS Shield against DDoS Attacks</li><li><a href="https://docs.aws.amazon.com/ecs/index.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/ecs/index.html" rel="noreferrer noopener">Elastic Container Service</a> (ECS) Cluster, ECS Service and ECS Tasks for running our service</li><li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-groups.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-groups.html" rel="noreferrer noopener">Security Groups</a> for detailed configuration of network-level firewall rules for EC2 and ALB</li><li><a href="https://docs.aws.amazon.com/vpc/index.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/vpc/index.html" rel="noreferrer noopener">VPC</a> for all subnets and Internet Gateway for inbound and outbound network access to the public subnets</li><li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Scenario2.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Scenario2.html" rel="noreferrer noopener">Private subnets</a> including NAT gateway for the ECS service</li><li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Scenario2.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Scenario2.html" rel="noreferrer noopener">Public subnets</a> for the ALB</li></ul><p>As you will see, we consistently use a unique name with the environment (e.g. <code>dev</code>) for naming resources. This allows us to provision resources from multiple environments (such as <code>staging</code> or <code>pre-production</code>) in the same AWS account in a real-life scenario.</p><p>Remember that you can find the full code base with a working local setup in our <a href="https://github.com/nexgeneerz/aws-scenario-ecs-ec2" target="_blank" data-type="URL" data-id="https://github.com/nexgeneerz/aws-scenario-ecs-ec2" rel="noreferrer noopener">GitHub repository</a>.</p><p>Let’s start with a few basic components, namely a Hosted Zone, the certificates and an Elastic Container Registry (ECR).</p><h2 class="wp-block-heading"><span id="Route_53_ECR_and_Certificate_Manager">Route 53, ECR and Certificate Manager</span></h2><p>For our example, we assume that our service will run under a subdomain, for example <code>https://service.example.com</code>. This will require us to create a new hosted zone in Route 53 with nameserver (NS) records in the hosted zone of the top level domain <code>example.com</code>.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Create Route 53 Hosted Zone for the domain of our service including NS records in the top level domainresource &quot;aws_route53_zone&quot; &quot;service&quot; {
name  = var.domain_name
}resource &quot;aws_route53_record&quot; &quot;service&quot; {
zone_id = var.tld_zone_id
name    = var.domain_name
type    = &quot;NS&quot;
ttl     = 300
records = [
aws_route53_zone.service.name_servers[0],
aws_route53_zone.service.name_servers[1],
aws_route53_zone.service.name_servers[2],
aws_route53_zone.service.name_servers[3]
]
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Create Route 53 Hosted Zone for the domain of our service including NS records in the top level domain</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route53_zone"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"service"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route53_record"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"service"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">zone_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">tld_zone_id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">type    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">NS</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">ttl     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">300</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">records </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name_servers</span><span style="color: #89DDFF">[</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">],</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name_servers</span><span style="color: #89DDFF">[</span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">],</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name_servers</span><span style="color: #89DDFF">[</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">],</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name_servers</span><span style="color: #89DDFF">[</span><span style="color: #F78C6C">3</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>Next are two certificates: one for the ALB and one for CloudFront. We remember: while the ALB certificate must be created in the region of the ALB itself, CloudFront certificates must be created in the region <code>us-east-1</code>. So if your setup is basically running in the North Virginia region, you can work with a single certificate, but otherwise you need two.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Certificate for Application Load Balancer including validation via CNAME recordresource &quot;aws_acm_certificate&quot; &quot;alb_certificate&quot; {
domain_name               = var.domain_name
validation_method         = &quot;DNS&quot;
subject_alternative_names = [&quot;*.${var.domain_name}&quot;]
}resource &quot;aws_acm_certificate_validation&quot; &quot;alb_certificate&quot; {
certificate_arn         = aws_acm_certificate.alb_certificate.arn
validation_record_fqdns = [aws_route53_record.generic_certificate_validation.fqdn]
}## Certificate for CloudFront Distribution in region us.east-1resource &quot;aws_acm_certificate&quot; &quot;cloudfront_certificate&quot; {
provider                  = aws.us_east_1
domain_name               = var.domain_name
validation_method         = &quot;DNS&quot;
subject_alternative_names = [&quot;*.${var.domain_name}&quot;]
}resource &quot;aws_acm_certificate_validation&quot; &quot;cloudfront_certificate&quot; {
provider                = aws.us_east_1
certificate_arn         = aws_acm_certificate.cloudfront_certificate.arn
validation_record_fqdns = [aws_route53_record.generic_certificate_validation.fqdn]
}## We only need one record for the DNS validation for both certificates, as records are the same for all regionsresource &quot;aws_route53_record&quot; &quot;generic_certificate_validation&quot; {
name    = tolist(aws_acm_certificate.alb_certificate.domain_validation_options)[0].resource_record_name
type    = tolist(aws_acm_certificate.alb_certificate.domain_validation_options)[0].resource_record_type
zone_id = aws_route53_zone.service.id
records = [tolist(aws_acm_certificate.alb_certificate.domain_validation_options)[0].resource_record_value]
ttl     = 300
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Certificate for Application Load Balancer including validation via CNAME record</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_acm_certificate"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"alb_certificate"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">domain_name               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">validation_method         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">DNS</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">subject_alternative_names </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">*.</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_acm_certificate_validation"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"alb_certificate"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">certificate_arn         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_acm_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">validation_record_fqdns </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_route53_record</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">generic_certificate_validation</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">fqdn</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Certificate for CloudFront Distribution in region us.east-1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_acm_certificate"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"cloudfront_certificate"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">provider                  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">us_east_1</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">domain_name               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">validation_method         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">DNS</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">subject_alternative_names </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">*.</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_acm_certificate_validation"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"cloudfront_certificate"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">provider                </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">us_east_1</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">certificate_arn         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_acm_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">cloudfront_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">validation_record_fqdns </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_route53_record</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">generic_certificate_validation</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">fqdn</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## We only need one record for the DNS validation for both certificates, as records are the same for all regions</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route53_record"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"generic_certificate_validation"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">tolist</span><span style="color: #89DDFF">(</span><span style="color: #F07178">aws_acm_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_validation_options</span><span style="color: #89DDFF">)[</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">].</span><span style="color: #EEFFFF">resource_record_name</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">type    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">tolist</span><span style="color: #89DDFF">(</span><span style="color: #F07178">aws_acm_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_validation_options</span><span style="color: #89DDFF">)[</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">].</span><span style="color: #EEFFFF">resource_record_type</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">zone_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">records </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #82AAFF">tolist</span><span style="color: #89DDFF">(</span><span style="color: #F07178">aws_acm_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_validation_options</span><span style="color: #89DDFF">)[</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">].</span><span style="color: #EEFFFF">resource_record_value</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">ttl     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">300</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>Just like the setup with Fargate, we need a container registry (a kind of repository for <a href="http://docker.com/" data-type="URL" data-id="http://docker.com" target="_blank" rel="noreferrer noopener">Docker</a> images) where we can store the latest images of our Presentation Tier service. Besides AWS’ own service ECR, services like <a href="http://hub.docker.com/" data-type="URL" data-id="http://hub.docker.com" target="_blank" rel="noreferrer noopener">Docker Hub</a> or <a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry" data-type="URL" data-id="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry" target="_blank" rel="noreferrer noopener">GitHub Container Registry</a> are appropriate alternatives. We also directly enable image scanning for known security issues. For the sake of completeness (also to save costs), a <a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/LifecyclePolicies.html" data-type="URL" data-id="https://docs.aws.amazon.com/AmazonECR/latest/userguide/LifecyclePolicies.html" target="_blank" rel="noreferrer noopener">lifecycle policy</a> should also be created to delete old or untagged images. This step is not shown in our example. <code>force_delete</code> should be disabled in a production environment, as this deletes the ECR resource including all images in the repository if a <code>terraform destroy</code> command or a change that forces a replacement is executed.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="resource &quot;aws_ecr_repository&quot; &quot;ecr&quot; {
name         = &quot;${lower(var.namespace)}/${var.service_name}&quot;
force_delete = var.ecr_force_deleteimage_scanning_configuration {
scan_on_push = true
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_ecr_repository"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecr"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #82AAFF">lower</span><span style="color: #89DDFF">(</span><span style="color: #C3E88D">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #89DDFF">)</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">/</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service_name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">force_delete </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecr_force_delete</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">image_scanning_configuration</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">scan_on_push </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><h2 class="wp-block-heading"><span id="The_network_configuration">The network configuration</span></h2><p>The basis for any Internet-based application in AWS is a virtual private cloud (VPC) in combination with subnets and resources such as Internet Gateways, NAT Gateways, and possibly other components such as site-to-site VPNs, Transit Gateways, and others.</p><p>In the next step, we will take care of these network components. We start with the VPC and an Internet Gateway:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Create VPC with a CIDR block that has enough capacity for the amount of DNS names you needresource &quot;aws_vpc&quot; &quot;default&quot; {
cidr_block           = var.vpc_cidr_block
enable_dns_support   = true
enable_dns_hostnames = truetags = {
Name     = &quot;${var.namespace}_VPC_${var.environment}&quot;
}
}## Create Internet Gateway for egress/ingress connections to resources in the public subnetsresource &quot;aws_internet_gateway&quot; &quot;default&quot; {
vpc_id = aws_vpc.default.idtags = {
Name     = &quot;${var.namespace}_InternetGateway_${var.environment}&quot;
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Create VPC with a CIDR block that has enough capacity for the amount of DNS names you need</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_vpc"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"default"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">cidr_block           </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">vpc_cidr_block</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">enable_dns_support   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">enable_dns_hostnames </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_VPC_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Create Internet Gateway for egress/ingress connections to resources in the public subnets</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_internet_gateway"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"default"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_InternetGateway_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>For High Availability we need to deploy our Private Subnets and Public Subnets into multiple (at least two) Availability Zones (AZ). For this we can use the following <code>data</code> resource from Terraform:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## This resource returns a list of all AZ available in the region configured in the AWS credentialsdata &quot;aws_availability_zones&quot; &quot;available&quot; {}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## This resource returns a list of all AZ available in the region configured in the AWS credentials</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">data</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_availability_zones"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"available"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{}</span></span></code></pre></div><h3 class="wp-block-heading">Public Subnets</h3><p>We now create a Public Subnet, Route Table, and a Route for outbound access to the Internet in each available AZ in our chosen AWS Region. The Public Subnets will be used for the Application Load Balancer (ALB) and the Bastion Host, not for the EC2 Instances that are part of the ECS Cluster.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## One public subnet per AZresource &quot;aws_subnet&quot; &quot;public&quot; {
count                   = var.az_count
cidr_block              = cidrsubnet(var.vpc_cidr_block, 8, var.az_count + count.index)
availability_zone       = data.aws_availability_zones.available.names[count.index]
vpc_id                  = aws_vpc.default.id
map_public_ip_on_launch = truetags = {
Name     = &quot;${var.namespace}_PublicSubnet_${count.index}_${var.environment}&quot;
}
}## Route Table with egress route to the internetresource &quot;aws_route_table&quot; &quot;public&quot; {
vpc_id = aws_vpc.default.idroute {
cidr_block = &quot;0.0.0.0/0&quot;
gateway_id = aws_internet_gateway.default.id
}tags = {
Name     = &quot;${var.namespace}_PublicRouteTable_${var.environment}&quot;
}
}## Associate Route Table with Public Subnetsresource &quot;aws_route_table_association&quot; &quot;public&quot; {
count          = var.az_count
subnet_id      = aws_subnet.public[count.index].id
route_table_id = aws_route_table.public.id
}## Make our Route Table the main Route Tableresource &quot;aws_main_route_table_association&quot; &quot;public_main&quot; {
vpc_id         = aws_vpc.default.id
route_table_id = aws_route_table.public.id
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## One public subnet per AZ</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_subnet"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"public"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">count                   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">az_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">cidr_block              </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">cidrsubnet</span><span style="color: #89DDFF">(</span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">vpc_cidr_block</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #F78C6C">8</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">az_count</span><span style="color: #F07178"> </span><span style="color: #89DDFF">+</span><span style="color: #F07178"> count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #89DDFF">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">availability_zone       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_availability_zones</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">available</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">names</span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id                  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">map_public_ip_on_launch </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_PublicSubnet_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Route Table with egress route to the internet</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route_table"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"public"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">route</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">cidr_block </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">0.0.0.0/0</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">gateway_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_internet_gateway</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_PublicRouteTable_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">##&nbsp;Associate Route Table with Public Subnets</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route_table_association"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"public"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">count          </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">az_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">subnet_id      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_subnet</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">public</span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #89DDFF">].</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">route_table_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_route_table</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">public</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">##&nbsp;Make our Route Table the main Route Table</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_main_route_table_association"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"public_main"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">route_table_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_route_table</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">public</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><h3 class="wp-block-heading">Private Subnets</h3><p>We perform almost the same steps for the Private Subnets, but here we have to add a NAT Gateway, otherwise there is no access to the Internet. Accordingly, a route to the Internet must be added to the route tables (CIDR block <code>0.0.0.0/0</code>). All our Container Instances will reside inside the Private Subnets without direct access from the internet.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Creates one Elastic IP per AZ (one for each NAT Gateway in each AZ)resource &quot;aws_eip&quot; &quot;nat_gateway&quot; {
count = var.az_count
vpc   = truetags = {
Name     = &quot;${var.namespace}_EIP_${count.index}_${var.environment}&quot;
}
}## Creates one NAT Gateway per AZresource &quot;aws_nat_gateway&quot; &quot;nat_gateway&quot; {
count         = var.az_count
subnet_id     = aws_subnet.public[count.index].id
allocation_id = aws_eip.nat_gateway[count.index].idtags = {
Name     = &quot;${var.namespace}_NATGateway_${count.index}_${var.environment}&quot;
}
}## One private subnet per AZresource &quot;aws_subnet&quot; &quot;private&quot; {
count             = var.az_count
cidr_block        = cidrsubnet(var.vpc_cidr_block, 8, count.index)
availability_zone = data.aws_availability_zones.available.names[count.index]
vpc_id            = aws_vpc.default.idtags = {
Name     = &quot;${var.namespace}_PrivateSubnet_${count.index}_${var.environment}&quot;
}
}## Route to the internet using the NAT Gatewayresource &quot;aws_route_table&quot; &quot;private&quot; {
count  = var.az_count
vpc_id = aws_vpc.default.idroute {
cidr_block     = &quot;0.0.0.0/0&quot;
nat_gateway_id = aws_nat_gateway.nat_gateway[count.index].id
}tags = {
Name     = &quot;${var.namespace}_PrivateRouteTable_${count.index}_${var.environment}&quot;
}
}## Associate Route Table with Private Subnetsresource &quot;aws_route_table_association&quot; &quot;private&quot; {
count          = var.az_count
subnet_id      = aws_subnet.private[count.index].id
route_table_id = aws_route_table.private.*.id
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Creates one Elastic IP per AZ (one for each NAT Gateway in each AZ)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_eip"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"nat_gateway"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">count </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">az_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_EIP_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Creates one NAT Gateway per AZ</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_nat_gateway"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"nat_gateway"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">count         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">az_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">subnet_id     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_subnet</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">public</span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #89DDFF">].</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">allocation_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_eip</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">nat_gateway</span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #89DDFF">].</span><span style="color: #EEFFFF">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_NATGateway_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## One private subnet per AZ</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_subnet"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"private"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">count             </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">az_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">cidr_block        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">cidrsubnet</span><span style="color: #89DDFF">(</span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">vpc_cidr_block</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #F78C6C">8</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #89DDFF">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">availability_zone </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_availability_zones</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">available</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">names</span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id            </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_PrivateSubnet_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Route to the internet using the NAT Gateway</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route_table"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"private"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">count  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">az_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">route</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">cidr_block     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">0.0.0.0/0</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">nat_gateway_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_nat_gateway</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">nat_gateway</span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #89DDFF">].</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_PrivateRouteTable_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">##&nbsp;Associate Route Table with Private Subnets</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route_table_association"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"private"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">count          </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">az_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">subnet_id      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_subnet</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">private</span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">count</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">index</span><span style="color: #89DDFF">].</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">route_table_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_route_table</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">private</span><span style="color: #89DDFF">.*.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><h2 class="wp-block-heading"><span id="The_compute_layer_on_EC2">The compute layer on EC2</span></h2><p>In contrast to ECS on Fargate, with ECS on EC2 we are responsible for the operation and setup of the EC2 Instances ourselves. On the one hand, this gives us more flexibility, but also leads to a higher operational effort. To keep this as small as possible, we use an AWS Launch Template for creating the EC2 Instances in our ECS Cluster.</p><p>We also need an EC2 Key Pair to gain access to the EC2 Instances. You can use your existing compatible SSH key or create a new one:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span role="button" tabindex="0" data-code="ssh-keygen -b 2048 -t rsa" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #FFCB6B">ssh-keygen</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">-b</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">2048</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">-t</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">rsa</span></span></code></pre></div><p>We will use this SSH key later to connect to one of our private EC2 instances via Bastion Host. In the next step you create a key pair resource:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Create a public and private key pair for login to the EC2 Instancesresource &quot;aws_key_pair&quot; &quot;default&quot; {
key_name   = &quot;${var.namespace}_KeyPair_${var.environment}&quot;
public_key = var.public_ec2_key
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Create a public and private key pair for login to the EC2 Instances</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_key_pair"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"default"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">key_name   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_KeyPair_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">public_key </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">public_ec2_key</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>Next up is the Launch Template. Here lies a small stumbling block, because you should make sure when selecting an appropriate Amazon Machine Image (AMI) to use an ECS-optimized image on which the ECS Agent is installed. In our example we use an AMI of the group <code>amzn2-ami-ecs-hvm-*-x86_64-ebs</code>. If this is not the case, you can install the ECS Agent manually, but without it you will not be able to use an EC2 Instance in an ECS Cluster.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Get most recent AMI for an ECS-optimized Amazon Linux 2 instancedata &quot;aws_ami&quot; &quot;amazon_linux_2&quot; {
most_recent = truefilter {
name   = &quot;virtualization-type&quot;
values = [&quot;hvm&quot;]
}filter {
name   = &quot;owner-alias&quot;
values = [&quot;amazon&quot;]
}filter {
name   = &quot;name&quot;
values = [&quot;amzn2-ami-ecs-hvm-*-x86_64-ebs&quot;]
}owners = [&quot;amazon&quot;]
}## Launch template for all EC2 instances that are part of the ECS clusterresource &quot;aws_launch_template&quot; &quot;ecs_launch_template&quot; {
name                   = &quot;${var.namespace}_EC2_LaunchTemplate_${var.environment}&quot;
image_id               = data.aws_ami.amazon_linux_2.id
instance_type          = var.instance_type
key_name               = aws_key_pair.default.key_name
user_data              = base64encode(data.template_file.user_data.rendered)
vpc_security_group_ids = [aws_security_group.ec2.id]iam_instance_profile {
arn = aws_iam_instance_profile.ec2_instance_role_profile.arn
}monitoring {
enabled = true
}
}data &quot;template_file&quot; &quot;user_data&quot; {
template = file(&quot;user_data.sh&quot;)vars = {
ecs_cluster_name = aws_ecs_cluster.default.name
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Get most recent AMI for an ECS-optimized Amazon Linux 2 instance</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">data</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_ami"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"amazon_linux_2"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">most_recent </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">filter</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">name   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">virtualization-type</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">values </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">hvm</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">filter</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">name   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">owner-alias</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">values </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">amazon</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">filter</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">name   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">name</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">values </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">amzn2-ami-ecs-hvm-*-x86_64-ebs</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">owners </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">amazon</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Launch template for all EC2 instances that are part of the ECS cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_launch_template"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_launch_template"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name                   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_EC2_LaunchTemplate_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">image_id               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_ami</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">amazon_linux_2</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">instance_type          </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">instance_type</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">key_name               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_key_pair</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">key_name</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">user_data              </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">base64encode</span><span style="color: #89DDFF">(</span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">template_file</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">user_data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">rendered</span><span style="color: #89DDFF">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_security_group_ids </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_security_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ec2</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span><span style="color: #89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">iam_instance_profile</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">arn </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_iam_instance_profile</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ec2_instance_role_profile</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">monitoring</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">enabled </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">data</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"template_file"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"user_data"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">template </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">file</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">user_data.sh</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vars </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">ecs_cluster_name</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> aws_ecs_cluster.default.name</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>In order to use the EC2 Instances as part of the ECS Cluster after startup, we need to configure the cluster name. To do this, the name is written to the ECS config file <code>/etc/ecs/ecs.config</code>. We do this step as part of the user data script <code>user_data.sh</code> that is executed when an EC2 Instance is started. Remember that user data scripts are <strong>not</strong> executed during reboot of an instance.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="#!/bin/bash## Configure cluster name using the template variable ${ecs_cluster_name}echo ECS_CLUSTER=&#39;${ecs_cluster_name}&#39; &gt;&gt; /etc/ecs/ecs.config" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Configure cluster name using the template variable ${ecs_cluster_name}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #82AAFF">echo</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">ECS_CLUSTER=</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">${ecs_cluster_name}</span><span style="color: #89DDFF">'</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">&gt;&gt;</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">/etc/ecs/ecs.config</span></span></code></pre></div><p>In the last step, we have to assign an IAM Role with the necessary permissions to the Launch Template and thus to the Container Instances:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Creates IAM Role which is assumed by the Container Instances (aka EC2 Instances)resource &quot;aws_iam_role&quot; &quot;ec2_instance_role&quot; {
name               = &quot;${var.namespace}_EC2_InstanceRole_${var.environment}&quot;
assume_role_policy = data.aws_iam_policy_document.ec2_instance_role_policy.json
}resource &quot;aws_iam_role_policy_attachment&quot; &quot;ec2_instance_role_policy&quot; {
role       = aws_iam_role.ec2_instance_role.name
policy_arn = &quot;arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role&quot;
}resource &quot;aws_iam_instance_profile&quot; &quot;ec2_instance_role_profile&quot; {
name  = &quot;${var.namespace}_EC2_InstanceRoleProfile_${var.environment}&quot;
role  = aws_iam_role.ec2_instance_role.id
}data &quot;aws_iam_policy_document&quot; &quot;ec2_instance_role_policy&quot; {
statement {
actions = [&quot;sts:AssumeRole&quot;]
effect  = &quot;Allow&quot;principals {
type        = &quot;Service&quot;
identifiers = [
&quot;ec2.amazonaws.com&quot;,
&quot;ecs.amazonaws.com&quot;
]
}
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Creates IAM Role which is assumed by the Container Instances (aka EC2 Instances)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_role"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ec2_instance_role"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_EC2_InstanceRole_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">assume_role_policy </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_iam_policy_document</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ec2_instance_role_policy</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">json</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_role_policy_attachment"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ec2_instance_role_policy"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">role       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_iam_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ec2_instance_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">policy_arn </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_instance_profile"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ec2_instance_role_profile"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_EC2_InstanceRoleProfile_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">role  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_iam_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ec2_instance_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">data</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_policy_document"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ec2_instance_role_policy"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">statement</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">actions </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">sts:AssumeRole</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">effect  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow</span><span style="color: #89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">principals</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">type        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Service</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">identifiers </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ec2.amazonaws.com</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ecs.amazonaws.com</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>Next, we create the ECS Cluster, the ECS Service, and the ECS Task Definition. We start with the ECS Cluster:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Creates an ECS Clusterresource &quot;aws_ecs_cluster&quot; &quot;default&quot; {
name  = &quot;${var.namespace}_ECSCluster_${var.environment}&quot;lifecycle {
create_before_destroy = true
}tags = {
Name     = &quot;${var.namespace}_ECSCluster_${var.environment}&quot;
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Creates an ECS Cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_ecs_cluster"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"default"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ECSCluster_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">lifecycle</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">create_before_destroy </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ECSCluster_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>This is followed by the ECS Service with the corresponding IAM Role. Among other things, we can make important configurations here as to how the ECS Tasks are to be distributed to the individual Container Instances. This is particularly important with regard to High Availability. In this case, the tasks are configured in such a way that the number of ECS Tasks is distributed evenly across EC2 instances to the various Availability Zones. We use the <code>binpack</code> method to make the <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-placement-strategies.html" data-type="URL" data-id="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-placement-strategies.html" target="_blank" rel="noreferrer noopener">most efficient use of space</a> on Container Instances.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Creates ECS Serviceresource &quot;aws_ecs_service&quot; &quot;service&quot; {
name                               = &quot;${var.namespace}_ECS_Service_${var.environment}&quot;
iam_role                           = aws_iam_role.ecs_service_role.arn
cluster                            = aws_ecs_cluster.default.id
task_definition                    = aws_ecs_task_definition.default.arn
desired_count                      = var.ecs_task_desired_count
deployment_minimum_healthy_percent = var.ecs_task_deployment_minimum_healthy_percent
deployment_maximum_percent         = var.ecs_task_deployment_maximum_percentload_balancer {
target_group_arn = aws_alb_target_group.service_target_group.arn
container_name   = var.service_name
container_port   = var.container_port
}## Spread tasks evenly accross all Availability Zones for High Availability
ordered_placement_strategy {
type  = &quot;spread&quot;
field = &quot;attribute:ecs.availability-zone&quot;
}
## Make use of all available space on the Container Instances
ordered_placement_strategy {
type  = &quot;binpack&quot;
field = &quot;memory&quot;
}## Do not update desired count again to avoid a reset to this number on every deployment
lifecycle {
ignore_changes = [desired_count]
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Creates ECS Service</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_ecs_service"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"service"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name                               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ECS_Service_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">iam_role                           </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_iam_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_service_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">cluster                            </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_ecs_cluster</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">task_definition                    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_ecs_task_definition</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">desired_count                      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_task_desired_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">deployment_minimum_healthy_percent </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_task_deployment_minimum_healthy_percent</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">deployment_maximum_percent         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_task_deployment_maximum_percent</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">load_balancer</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">target_group_arn </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_alb_target_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service_target_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">container_name   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service_name</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">container_port   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">container_port</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #545454; font-style: italic">## Spread tasks evenly accross all Availability Zones for High Availability</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">ordered_placement_strategy</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">type  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">spread</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">field </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">attribute:ecs.availability-zone</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #545454; font-style: italic">## Make use of all available space on the Container Instances</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">ordered_placement_strategy</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">type  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">binpack</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">field </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">memory</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #545454; font-style: italic">## Do not update desired count again to avoid a reset to this number on every deployment</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">lifecycle</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">ignore_changes </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">desired_count</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>It is important to ignore <code>desired_count</code> for changes in a deployment setup designed for high performance with CI/CD and <a href="https://nexgeneerz.io/how-does-trunk-based-development-work/" data-type="post" data-id="42029">frequent commits</a> (several times per hour) in Terraform. Our auto-scaling setup independently decides how many resources and ECS Tasks need to run concurrently to satisfy the Target Tracking Policy. If <code>desired_count</code> would be deployed again and again, we would bypass capacity planning each time and reset it, so to speak.</p><p>Now we can create the IAM Role for the ECS Service. This role will be assumed by ECS in our behalf to manage the ECS Cluster.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Create service-linked role used by the ECS Service to manage the ECS Clusterresource &quot;aws_iam_role&quot; &quot;ecs_service_role&quot; {
name               = &quot;${var.namespace}_ECS_ServiceRole_${var.environment}&quot;
assume_role_policy = data.aws_iam_policy_document.ecs_service_policy.json
}data &quot;aws_iam_policy_document&quot; &quot;ecs_service_policy&quot; {
statement {
actions = [&quot;sts:AssumeRole&quot;]
effect  = &quot;Allow&quot;principals {
type        = &quot;Service&quot;
identifiers = [&quot;ecs.amazonaws.com&quot;,]
}
}
}resource &quot;aws_iam_role_policy&quot; &quot;ecs_service_role_policy&quot; {
name   = &quot;${var.namespace}_ECS_ServiceRolePolicy_${var.environment}&quot;
policy = data.aws_iam_policy_document.ecs_service_role_policy.json
role   = aws_iam_role.ecs_service_role.id
}data &quot;aws_iam_policy_document&quot; &quot;ecs_service_role_policy&quot; {
statement {
effect  = &quot;Allow&quot;
actions = [
&quot;ec2:AuthorizeSecurityGroupIngress&quot;,
&quot;ec2:Describe*&quot;,
&quot;elasticloadbalancing:DeregisterInstancesFromLoadBalancer&quot;,
&quot;elasticloadbalancing:DeregisterTargets&quot;,
&quot;elasticloadbalancing:Describe*&quot;,
&quot;elasticloadbalancing:RegisterInstancesWithLoadBalancer&quot;,
&quot;elasticloadbalancing:RegisterTargets&quot;,
&quot;ec2:DescribeTags&quot;,
&quot;logs:CreateLogGroup&quot;,
&quot;logs:CreateLogStream&quot;,
&quot;logs:DescribeLogStreams&quot;,
&quot;logs:PutSubscriptionFilter&quot;,
&quot;logs:PutLogEvents&quot;
]
resources = [&quot;*&quot;]
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Create service-linked role used by the ECS Service to manage the ECS Cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_role"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_service_role"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ECS_ServiceRole_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">assume_role_policy </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_iam_policy_document</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_service_policy</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">json</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">data</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_policy_document"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_service_policy"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">statement</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">actions </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">sts:AssumeRole</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">effect  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow</span><span style="color: #89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">principals</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">type        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Service</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">identifiers </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ecs.amazonaws.com</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_role_policy"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_service_role_policy"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ECS_ServiceRolePolicy_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">policy </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_iam_policy_document</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_service_role_policy</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">json</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">role   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_iam_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_service_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">data</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_policy_document"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_service_role_policy"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">statement</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">effect  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">actions </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ec2:AuthorizeSecurityGroupIngress</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ec2:Describe*</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">elasticloadbalancing:DeregisterInstancesFromLoadBalancer</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">elasticloadbalancing:DeregisterTargets</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">elasticloadbalancing:Describe*</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">elasticloadbalancing:RegisterInstancesWithLoadBalancer</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">elasticloadbalancing:RegisterTargets</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ec2:DescribeTags</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">logs:CreateLogGroup</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">logs:CreateLogStream</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">logs:DescribeLogStreams</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">logs:PutSubscriptionFilter</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">logs:PutLogEvents</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">resources </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">*</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>And finally, the ECS Task Definition, which configures what settings our Docker container will use to run with our service. Here the following line is important:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span role="button" tabindex="0" data-code="image = &quot;${aws_ecr_repository.ecr.repository_url}:${var.sha1}&quot;" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #EEFFFF">image </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">aws_ecr_repository</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecr</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">repository_url</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">:</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">sha1</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span></code></pre></div><p>The variable <code>${var.hash}</code> comes from the underlying CI/CD system (e.g. Jenkins, CircleCI) and consists of the Git commit hash, which is different for each commit. This value is passed to Terraform as a variable with each deployment (e.g. via the <a href="https://developer.hashicorp.com/terraform/cli/config/environment-variables#tf_var_name" data-type="URL" data-id="https://developer.hashicorp.com/terraform/cli/config/environment-variables#tf_var_name" target="_blank" rel="noreferrer noopener">Environment Variable</a> <code>TF_VAR_hash</code> ). This ensures that with each deployment a new version of the ECS task is created and deployed – an essential part in a <a href="https://nexgeneerz.io/how-does-trunk-based-development-work/" data-type="post" data-id="42029">trunk-based development process</a> where each change is directly integrated and deployed according to Continuous Integration and Continuous Deployment (CI/CD) rules.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Creates ECS Task Definitionresource &quot;aws_ecs_task_definition&quot; &quot;default&quot; {
family             = &quot;${var.namespace}_ECS_TaskDefinition_${var.environment}&quot;
execution_role_arn = aws_iam_role.ecs_task_execution_role.arn
task_role_arn      = aws_iam_role.ecs_task_iam_role.arncontainer_definitions = jsonencode([
{
name         = var.service_name
image        = &quot;${aws_ecr_repository.ecr.repository_url}:${var.hash}&quot;
cpu          = var.cpu_units
memory       = var.memory
essential    = true
portMappings = [
{
containerPort = var.container_port
hostPort      = 0
protocol      = &quot;tcp&quot;
}
]
logConfiguration = {
logDriver = &quot;awslogs&quot;,
options   = {
&quot;awslogs-group&quot;         = aws_cloudwatch_log_group.log_group.name,
&quot;awslogs-region&quot;        = var.region,
&quot;awslogs-stream-prefix&quot; = &quot;app&quot;
}
}
}
])
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Creates ECS Task Definition</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_ecs_task_definition"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"default"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">family             </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ECS_TaskDefinition_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">execution_role_arn </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_iam_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_task_execution_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">task_role_arn      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_iam_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_task_iam_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">container_definitions </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">jsonencode</span><span style="color: #89DDFF">([</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">name</span><span style="color: #F07178">         </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> var.service_name</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">image</span><span style="color: #F07178">        </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">aws_ecr_repository</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecr</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">repository_url</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">:</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">hash</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">cpu</span><span style="color: #F07178">          </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> var.cpu_units</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">memory</span><span style="color: #F07178">       </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> var.memory</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">essential</span><span style="color: #F07178">    </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">portMappings</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> [</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">          </span><span style="color: #EEFFFF">containerPort</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> var.container_port</span></span>
<span class="line"><span style="color: #F07178">          </span><span style="color: #EEFFFF">hostPort</span><span style="color: #F07178">      </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #F78C6C">0</span></span>
<span class="line"><span style="color: #F07178">          </span><span style="color: #EEFFFF">protocol</span><span style="color: #F07178">      </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">tcp</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">      ]</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">logConfiguration</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #EEFFFF">logDriver</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">awslogs</span><span style="color: #89DDFF">"</span><span style="color: #F07178">,</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #EEFFFF">options</span><span style="color: #F07178">   </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">          </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">awslogs-group</span><span style="color: #89DDFF">"</span><span style="color: #F07178">         = aws_cloudwatch_log_group.log_group.name,</span></span>
<span class="line"><span style="color: #F07178">          </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">awslogs-region</span><span style="color: #89DDFF">"</span><span style="color: #F07178">        = var.region,</span></span>
<span class="line"><span style="color: #F07178">          </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">awslogs-stream-prefix</span><span style="color: #89DDFF">"</span><span style="color: #F07178"> = </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">app</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">])</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>Now we have to make sure out logging group actually exists. This is the logging group that will also be used for application logging inside our service (for example a Python app using a statement like the following:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span role="button" tabindex="0" data-code="logging.info(&#39;A log message&#39;)" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #EEFFFF">logging</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">info</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">A log message</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">)</span></span></code></pre></div><p>The definition of the log group contains a log retention period to delete older logs after some time.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Create log group for our serviceresource &quot;aws_cloudwatch_log_group&quot; &quot;log_group&quot; {
name              = &quot;/${lower(var.namespace)}/ecs/${var.service_name}&quot;
retention_in_days = var.retention_in_days
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Create log group for our service</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_cloudwatch_log_group"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"log_group"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name              </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">/</span><span style="color: #F78C6C">${</span><span style="color: #82AAFF">lower</span><span style="color: #89DDFF">(</span><span style="color: #C3E88D">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #89DDFF">)</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">/ecs/</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service_name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">retention_in_days </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">retention_in_days</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>For the ECS Task we create the two roles <code>Nexgeneerz_ECS_TaskExecutionRole</code> and <code>Nexgeneerz_ECS_TaskIAMRole</code>, which I will discuss in detail later.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## IAM Role for ECS Task executionresource &quot;aws_iam_role&quot; &quot;ecs_task_execution_role&quot; {
name               = &quot;${var.namespace}_ECS_TaskExecutionRole_${var.environment}&quot;
assume_role_policy = data.aws_iam_policy_document.task_assume_role_policy.json
}data &quot;aws_iam_policy_document&quot; &quot;task_assume_role_policy&quot; {
statement {
actions = [&quot;sts:AssumeRole&quot;]principals {
type        = &quot;Service&quot;
identifiers = [&quot;ecs-tasks.amazonaws.com&quot;]
}
}
}resource &quot;aws_iam_role_policy_attachment&quot; &quot;ecs_task_execution_role_policy&quot; {
role       = aws_iam_role.ecs_task_execution_role.name
policy_arn = &quot;arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy&quot;
}resource &quot;aws_iam_role&quot; &quot;ecs_task_iam_role&quot; {
name               = &quot;${var.namespace}_ECS_TaskIAMRole_${var.environment}&quot;
assume_role_policy = data.aws_iam_policy_document.task_assume_role_policy.json
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## IAM Role for ECS Task execution</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_role"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_task_execution_role"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ECS_TaskExecutionRole_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">assume_role_policy </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_iam_policy_document</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">task_assume_role_policy</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">json</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">data</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_policy_document"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"task_assume_role_policy"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">statement</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">actions </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">sts:AssumeRole</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">principals</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">type        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Service</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">identifiers </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ecs-tasks.amazonaws.com</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_role_policy_attachment"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_task_execution_role_policy"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">role       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_iam_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_task_execution_role</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">policy_arn </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_iam_role"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_task_iam_role"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ECS_TaskIAMRole_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">assume_role_policy </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_iam_policy_document</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">task_assume_role_policy</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">json</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>With this, we have finished the computing part and can turn to configure autoscaling on ECS.</p><h2 class="wp-block-heading"><span id="Autoscaling_on_ECS">Autoscaling on ECS</span></h2><p>First, let’s take a look at our setup. On the one hand, we have a set of <em>x</em> EC2 Instances that belong to an ECS Cluster and are used by one or more ECS Services (in our example, by one service). The EC2 Instances are provisioned by an Autoscaling Group and are registered in an ECS Cluster. The ECS Cluster in turn manages our containers (or ECS Tasks) that contain our service. So we also have the number of ECS Tasks that we can include in the Autoscaling Group.</p><p>This already creates some of the complexity with ECS on EC2 that AWS takes away from us with EC2 on Fargate: we have to figure out for ourselves which strategy we want to use to achieve flexible scale-out and scale-in of services. There are a variety of options here, but fortunately this task has become much easier with ECS Capacity Providers and ECS Service Autoscaling.</p><p>We configure autoscaling at two different levels using Target Tracking Policies:</p><ul><li>Capacity Provider with Target Tracking Policy for a target capacity</li><li>Service Autoscaling on ECS Service Level with Target Tracking Policy for CPU and memory usage</li></ul><h3 class="wp-block-heading">Capacity Providers</h3><p>An AWS Capacity Provider acts as a link between ECS Cluster and Autoscaling Group and is linked to both resources. In principle, each ECS Cluster can use multiple Capacity Providers and thus different Autoscaling Groups. This allows different infrastructure such as <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-on-demand-instances.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-on-demand-instances.html" rel="noreferrer noopener">on-demand instances</a> and <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html" rel="noreferrer noopener">spot instances</a> to be used simultaneously in the cluster.</p><p>Capacity Providers calculate the required infrastructure for ECS Task containers and Container Instances (aka EC2 Instances) based on variables such as virtual CPU or memory. They take care of scaling out and scaling in of both components on demand by means of a Target Tracking Policy with a target value for CPU and/or memory usage. For example, a target tracking value of 50% for CPU usage means that the Capacity Provider always tries to balance the number of EC2 Instances so that this value is not exceeded (scale-out) or significantly undercut (scale-in). It is this demand-based, elastic scaling of infrastructure that makes cloud providers such as AWS or Google Cloud extremely useful players, because as a user you only pay for the infrastructure that you really use. In an on-demand data center, unused compute power would idle around unused and still incur costs.</p><p>A very detailed insight into Capacity Providers can be found in <a href="https://medium.com/yipitdata-engineering/instance-auto-scaling-using-aws-capacity-providers-9ea7e66e311f" data-type="URL" data-id="https://medium.com/yipitdata-engineering/instance-auto-scaling-using-aws-capacity-providers-9ea7e66e311f" target="_blank" rel="noreferrer noopener">this article by Annie Holladay</a>. A general overview of the complex topic <a href="https://nathanpeck.com/amazon-ecs-scaling-best-practices/" data-type="URL" data-id="https://nathanpeck.com/amazon-ecs-scaling-best-practices/" target="_blank" rel="noreferrer noopener">Autoscaling on AWS is provided by Nathan Peck</a>, while <a href="https://www.linkedin.com/pulse/deep-dive-amazon-ecs-cluster-auto-scaling-durai-selvan/" data-type="URL" data-id="https://www.linkedin.com/pulse/deep-dive-amazon-ecs-cluster-auto-scaling-durai-selvan/" target="_blank" rel="noreferrer noopener">Durai Selvan discusses scaling on AWS ECS in particular</a>.</p><p>Our Capacity Provider configuration is defined as follows:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Creates Capacity Provider linked with ASG and ECS Clusterresource &quot;aws_ecs_capacity_provider&quot; &quot;cas&quot; {
name  = &quot;${var.namespace}_ECS_CapacityProvider_${var.environment}&quot;auto_scaling_group_provider {
auto_scaling_group_arn         = aws_autoscaling_group.ecs_autoscaling_group.arn
managed_termination_protection = &quot;ENABLED&quot;managed_scaling {
maximum_scaling_step_size = var.maximum_scaling_step_size
minimum_scaling_step_size = var.minimum_scaling_step_size
status                    = &quot;ENABLED&quot;
target_capacity           = var.target_capacity
}
}
}resource &quot;aws_ecs_cluster_capacity_providers&quot; &quot;cas&quot; {
cluster_name       = aws_ecs_cluster.default.name
capacity_providers = [aws_ecs_capacity_provider.cas.name]
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Creates Capacity Provider linked with ASG and ECS Cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_ecs_capacity_provider"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"cas"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ECS_CapacityProvider_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">auto_scaling_group_provider</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">auto_scaling_group_arn         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_autoscaling_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_autoscaling_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">managed_termination_protection </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ENABLED</span><span style="color: #89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">managed_scaling</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">maximum_scaling_step_size </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">maximum_scaling_step_size</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">minimum_scaling_step_size </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">minimum_scaling_step_size</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">status                    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ENABLED</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">target_capacity           </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">target_capacity</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_ecs_cluster_capacity_providers"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"cas"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">cluster_name       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_ecs_cluster</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">capacity_providers </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_ecs_capacity_provider</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">cas</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>Here, <code>maximum_scaling_step_size</code> and <code>minimum_scaling_step_size</code> define by how many EC2 Instances the capacity provider may <em>simultaneously</em> increase or decrease the number of Container Instances during a scale-out or scale-in. <code>managed_termination_protection</code> prevents EC2 Instances on which other tasks are running from <a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/as-instance-termination.html#instance-protection" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/autoscaling/ec2/userguide/as-instance-termination.html#instance-protection" rel="noreferrer noopener">being terminated</a>.</p><h3 class="wp-block-heading">Service Autoscaling on ECS</h3><p>Service Autoscaling handles elastic scaling of containers (ECS Tasks) and also works in our setup using Target Tracking for CPU and memory usage.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Define Target Tracking on ECS Cluster Task levelresource &quot;aws_appautoscaling_target&quot; &quot;ecs_target&quot; {
max_capacity       = var.ecs_task_max_count
min_capacity       = var.ecs_task_min_count
resource_id        = &quot;service/${aws_ecs_cluster.default.name}/${aws_ecs_service.service.name}&quot;
scalable_dimension = &quot;ecs:service:DesiredCount&quot;
service_namespace  = &quot;ecs&quot;
}## Policy for CPU tracking
resource &quot;aws_appautoscaling_policy&quot; &quot;ecs_cpu_policy&quot; {
name               = &quot;${var.namespace}_CPUTargetTrackingScaling_${var.environment}&quot;
policy_type        = &quot;TargetTrackingScaling&quot;
resource_id        = aws_appautoscaling_target.ecs_target.resource_id
scalable_dimension = aws_appautoscaling_target.ecs_target.scalable_dimension
service_namespace  = aws_appautoscaling_target.ecs_target.service_namespacetarget_tracking_scaling_policy_configuration {
target_value = var.cpu_target_tracking_desired_valuepredefined_metric_specification {
predefined_metric_type = &quot;ECSServiceAverageCPUUtilization&quot;
}
}
}## Policy for memory tracking
resource &quot;aws_appautoscaling_policy&quot; &quot;ecs_memory_policy&quot; {
name               = &quot;${var.namespace}_MemoryTargetTrackingScaling_${var.environment}&quot;
policy_type        = &quot;TargetTrackingScaling&quot;
resource_id        = aws_appautoscaling_target.ecs_target.resource_id
scalable_dimension = aws_appautoscaling_target.ecs_target.scalable_dimension
service_namespace  = aws_appautoscaling_target.ecs_target.service_namespacetarget_tracking_scaling_policy_configuration {
target_value = var.memory_target_tracking_desired_valuepredefined_metric_specification {
predefined_metric_type = &quot;ECSServiceAverageMemoryUtilization&quot;
}
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Define Target Tracking on ECS Cluster Task level</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_appautoscaling_target"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_target"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">max_capacity       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_task_max_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">min_capacity       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_task_min_count</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">resource_id        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">service/</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">aws_ecs_cluster</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">/</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">aws_ecs_service</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">scalable_dimension </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ecs:service:DesiredCount</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">service_namespace  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ecs</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Policy for CPU tracking</span></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_appautoscaling_policy"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_cpu_policy"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_CPUTargetTrackingScaling_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">policy_type        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">TargetTrackingScaling</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">resource_id        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_appautoscaling_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">resource_id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">scalable_dimension </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_appautoscaling_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">scalable_dimension</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">service_namespace  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_appautoscaling_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service_namespace</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">target_tracking_scaling_policy_configuration</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">target_value </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">cpu_target_tracking_desired_value</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">predefined_metric_specification</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">predefined_metric_type </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ECSServiceAverageCPUUtilization</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Policy for memory tracking</span></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_appautoscaling_policy"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_memory_policy"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_MemoryTargetTrackingScaling_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">policy_type        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">TargetTrackingScaling</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">resource_id        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_appautoscaling_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">resource_id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">scalable_dimension </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_appautoscaling_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">scalable_dimension</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">service_namespace  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_appautoscaling_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_target</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service_namespace</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">target_tracking_scaling_policy_configuration</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">target_value </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">memory_target_tracking_desired_value</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">predefined_metric_specification</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">predefined_metric_type </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ECSServiceAverageMemoryUtilization</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>In the <code>aws_appautoscaling_target</code> resource, we define the minimum and maximum number of tasks that may run simultaneously, just as in the Capacity Provider. This helps us to keep costs under control despite scalability. <code>min_capacity</code> is an important value that is set to at least 2 in our setup for ensuring High Availability. Since we configured <code>aws_ecs_service</code> with the <code>spread</code> <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-placement-strategies.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-placement-strategies.html" rel="noreferrer noopener">Placement Strategy</a>, this ensures that each of the two tasks runs in a different Availability Zone. In case of a failure of one AZ, a backup is still available and the service can be guaranteed without interruption.</p><p>We use <code>ECSServiceAverageCPUUtilization</code> and <code>ECSServiceAverageMemoryUtilization</code> as metrics, whose data decides whether a scale-out or scale-in should be triggered.</p><h3 class="wp-block-heading">Autoscaling Group</h3><p>The last missing part for linking ECS Cluster, Capacity Providers and Launch Template is the Autoscaling Group (ASG). Again, just like for the ECS tasks, we define the minimum and maximum number of EC2 Instances that can be created to avoid uncontrolled scaling. The Autoscaling Group uses our already configured Launch Template for launching new instances.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Creates an ASG linked with our main VPCresource &quot;aws_autoscaling_group&quot; &quot;ecs_autoscaling_group&quot; {
name                  = &quot;${var.namespace}_ASG_${var.environment}&quot;
max_size              = var.autoscaling_max_size
min_size              = var.autoscaling_min_size
vpc_zone_identifier   = aws_subnet.private.*.id
health_check_type     = &quot;EC2&quot;
protect_from_scale_in = trueenabled_metrics = [
&quot;GroupMinSize&quot;,
&quot;GroupMaxSize&quot;,
&quot;GroupDesiredCapacity&quot;,
&quot;GroupInServiceInstances&quot;,
&quot;GroupPendingInstances&quot;,
&quot;GroupStandbyInstances&quot;,
&quot;GroupTerminatingInstances&quot;,
&quot;GroupTotalInstances&quot;
]launch_template {
id      = aws_launch_template.ecs_launch_template.id
version = &quot;$Latest&quot;
}instance_refresh {
strategy = &quot;Rolling&quot;
}lifecycle {
create_before_destroy = true
}tag {
key                 = &quot;Name&quot;
value               = &quot;${var.namespace}_ASG_${var.environment}&quot;
propagate_at_launch = true
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Creates an ASG linked with our main VPC</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_autoscaling_group"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ecs_autoscaling_group"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name                  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ASG_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">max_size              </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">autoscaling_max_size</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">min_size              </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">autoscaling_min_size</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_zone_identifier   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_subnet</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">private</span><span style="color: #89DDFF">.*.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">health_check_type     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">EC2</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">protect_from_scale_in </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">enabled_metrics </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GroupMinSize</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GroupMaxSize</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GroupDesiredCapacity</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GroupInServiceInstances</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GroupPendingInstances</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GroupStandbyInstances</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GroupTerminatingInstances</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GroupTotalInstances</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">launch_template</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">id      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_launch_template</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ecs_launch_template</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">version </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">$Latest</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">instance_refresh</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">strategy </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Rolling</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">lifecycle</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">create_before_destroy </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">tag</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">key                 </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Name</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">value               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ASG_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">propagate_at_launch </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>The <code>instance_refresh</code> block has an important task, because it would allow us to configure the warmup time with which new EC2 instances should be available in order to reduce too long startup times. enabled_metrics” defines which metrics the ASG should provide. These are then available in CloudWatch. <code>protect_from_scale_in</code> must be set to <code>true</code> because we have enabled <code>managed_termination_protection</code> in the capacity provider.</p><p>An important detail is that the EC2 Instances within the Autoscaling Group are all created in the Private Subnets. This allows us to significantly increase the security level, because the firewall settings in the Security Groups only allow controlled traffic in the order CloudFront Distribution -&gt; ALB -&gt; Autoscaling Group.</p><h2 class="wp-block-heading"><span id="Application_Load_Balancer">Application Load Balancer</span></h2><p>The Application Load Balancer (ALB) is part of Amazon’s Elastic Load Balancing (ELB) and takes over the task of load balancing, i.e. the simultaneous distribution of requests to the available Container Instances and ECS Tasks. In contrast to the Container Instances, the ALB runs in the Public Subnets. It is a highly available component and redundant due to our setup with multiple AZs.</p><p>The ALB receives incoming traffic via ALB Listeners. We define an HTTPS Listener, which means we can only accept traffic on port <code>443</code> (HTTPS). We will configure the automatic redirection from HTTP to HTTPS later in the CloudFront Distribution.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Application Load Balancer in public subnets with HTTP default listener that redirects traffic to HTTPSresource &quot;aws_alb&quot; &quot;alb&quot; {
name            = &quot;${var.namespace}-ALB-${var.environment}&quot;
security_groups = [aws_security_group.alb.id]
subnets         = aws_subnet.public.*.id
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Application Load Balancer in public subnets with HTTP default listener that redirects traffic to HTTPS</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_alb"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"alb"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name            </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">-ALB-</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">security_groups </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_security_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">subnets         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_subnet</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">public</span><span style="color: #89DDFF">.*.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><h3 class="wp-block-heading">HTTPS Listener und Target Group</h3><p>The default action in the HTTPS Listener in the Application Load Balancer blocks all requests with the status code <code>403</code> (access denied). In the further course we will now add a listener rule that allows access only with a valid <a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/restrict-access-to-load-balancer.html" data-type="URL" data-id="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/restrict-access-to-load-balancer.html" target="_blank" rel="noreferrer noopener">Custom Origin Header</a>. As the certificate required for HTTPS we use our certificate <code>alb_certificate</code> created at the beginning.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Default HTTPS listener that blocks all traffic without valid custom origin headerresource &quot;aws_alb_listener&quot; &quot;alb_default_listener_https&quot; {
load_balancer_arn = aws_alb.alb.arn
port              = &quot;443&quot;
protocol          = &quot;HTTPS&quot;
certificate_arn   = aws_acm_certificate.alb_certificate.arn
ssl_policy        = &quot;ELBSecurityPolicy-TLS-1-2-Ext-2018-06&quot;default_action {
type = &quot;fixed-response&quot;fixed_response {
content_type = &quot;text/plain&quot;
message_body = &quot;Access denied&quot;
status_code  = &quot;403&quot;
}
}
depends_on = [aws_acm_certificate.alb_certificate]
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Default HTTPS listener that blocks all traffic without valid custom origin header</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_alb_listener"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"alb_default_listener_https"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">load_balancer_arn </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">port              </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">443</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">protocol          </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">HTTPS</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">certificate_arn   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_acm_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">ssl_policy        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ELBSecurityPolicy-TLS-1-2-Ext-2018-06</span><span style="color: #89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">default_action</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">type </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">fixed-response</span><span style="color: #89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">fixed_response</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">content_type </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">text/plain</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">message_body </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Access denied</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">status_code  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">403</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">depends_on </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_acm_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb_certificate</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>The ALB Listener Rule associates incoming requests sent with the correct Custom Origin header with our Target Group.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## HTTPS Listener Rule to only allow traffic with a valid custom origin header coming from CloudFrontresource &quot;aws_alb_listener_rule&quot; &quot;https_listener_rule&quot; {
listener_arn = aws_alb_listener.alb_default_listener_https.arnaction {
type             = &quot;forward&quot;
target_group_arn = aws_alb_target_group.service_target_group.arn
}condition {
host_header {
values = [&quot;${var.environment}.${var.domain_name}&quot;]
}
}condition {
http_header {
http_header_name = &quot;X-Custom-Header&quot;
values           = [var.custom_origin_host_header]
}
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## HTTPS Listener Rule to only allow traffic with a valid custom origin header coming from CloudFront</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_alb_listener_rule"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"https_listener_rule"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">listener_arn </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_alb_listener</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb_default_listener_https</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">action</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">type             </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">forward</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">target_group_arn </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_alb_target_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service_target_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">condition</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">host_header</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">values </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">.</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">condition</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">http_header</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">http_header_name </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">X-Custom-Header</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">values           </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">custom_origin_host_header</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>The Target Group is the output of the ALB, while the ALB Listener is the input. So traffic goes into the Listener and is forwarded to the appropriate Target Group, which then routes it to the appropriate backend resource (in our case Container Instances). From here, traffic is forwarded over HTTP on port <code>80</code>. Since we are not implementing an end-to-end encrypted solution and are now inside the Private Subnets, this is fine.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Target Group for our serviceresource &quot;aws_alb_target_group&quot; &quot;service_target_group&quot; {
name                 = &quot;${var.namespace}-TargetGroup-${var.environment}&quot;
port                 = &quot;80&quot;
protocol             = &quot;HTTP&quot;
vpc_id               = aws_vpc.default.id
deregistration_delay = 120health_check {
healthy_threshold   = &quot;2&quot;
unhealthy_threshold = &quot;2&quot;
interval            = &quot;60&quot;
matcher             = var.healthcheck_matcher
path                = var.healthcheck_endpoint
port                = &quot;traffic-port&quot;
protocol            = &quot;HTTP&quot;
timeout             = &quot;30&quot;
}
depends_on = [aws_alb.alb]
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Target Group for our service</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_alb_target_group"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"service_target_group"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name                 </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">-TargetGroup-</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">port                 </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">80</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">protocol             </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">HTTP</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">deregistration_delay </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">120</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">health_check</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">healthy_threshold   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">2</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">unhealthy_threshold </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">2</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">interval            </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">60</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">matcher             </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">healthcheck_matcher</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">path                </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">healthcheck_endpoint</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">port                </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">traffic-port</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">protocol            </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">HTTP</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">timeout             </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">30</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">depends_on </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>The <code>health_check</code> block defines which URL the ALB uses to decide if the target (our ECS Tasks running on the Container Instances) is healthy. <code>matcher</code> and <code>path</code> can be configured to use one or more HTTP status codes and a specific URL path for the <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/target-group-health-checks.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/target-group-health-checks.html" rel="noreferrer noopener">healthcheck</a>. <code>healthy_threshold</code> and <code>unhealthy_threshold</code> define how many (failed) healthchecks a target should be evaluated as healthy or unhealthy. These healthchecks are performed in intervals of seconds defined in <code>interval</code>.</p><p>Depending on the application logic, the <code>stickiness</code> block should be defined to ensure that <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/sticky-sessions.html" data-type="URL" data-id="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/sticky-sessions.html" target="_blank" rel="noreferrer noopener">sticky sessions</a> are used. This way, visitors are always directed to the same target and their session can still be used. However, this approach can cause problems, especially with frequent deployments and thus frequently changing targets, and is an approach that should be considered in the application architecture to enable efficient development methods such as <a href="https://nexgeneerz.io/how-does-trunk-based-development-work/" data-type="post" data-id="42029">trunk-based development</a>.</p><p>The linking of target group with our ECS Service happens exactly there, in the resource <code>aws_ecs_service</code>. In the block <code>load_balancer</code> the ARN of the target group is linked and the ECS Tasks are registered as targets.</p><h2 class="wp-block-heading"><span id="Security_Groups">Security Groups</span></h2><p>Next, we take care of the necessary Security Groups (SG) for ALB and EC2 Instances. The SG for the EC2 Instances allows all outgoing traffic (often necessary to make external API calls or for package managers like <code>pip</code> or <code>npm</code>). Incoming traffic is allowed on port <code>22</code> (SSH) exclusively from the Bastion Host, which we will create later. We also allow the so-called <a href="https://en.wikipedia.org/wiki/Ephemeral_port" data-type="URL" data-id="https://en.wikipedia.org/wiki/Ephemeral_port" target="_blank" rel="noreferrer noopener">ephemeral ports</a> <code>1024</code> – <code>65535</code> coming from the Security Group of the ALB.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## SG for EC2 instancesresource &quot;aws_security_group&quot; &quot;ec2&quot; {
name        = &quot;${var.namespace}_EC2_Instance_SecurityGroup_${var.environment}&quot;
description = &quot;Security group for EC2 instances in ECS cluster&quot;
vpc_id      = aws_vpc.default.idingress {
description     = &quot;Allow ingress traffic from ALB on HTTP on ephemeral ports&quot;
from_port       = 1024
to_port         = 65535
protocol        = &quot;tcp&quot;
security_groups = [aws_security_group.alb.id]
}ingress {
description     = &quot;Allow SSH ingress traffic from bastion host&quot;
from_port       = 22
to_port         = 22
protocol        = &quot;tcp&quot;
security_groups = [aws_security_group.bastion_host.id]
}egress {
description = &quot;Allow all egress traffic&quot;
from_port   = 0
to_port     = 0
protocol    = -1
cidr_blocks = [&quot;0.0.0.0/0&quot;]
}tags = {
Name     = &quot;${var.namespace}_EC2_Instance_SecurityGroup_${var.environment}&quot;
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## SG for EC2 instances</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_security_group"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"ec2"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_EC2_Instance_SecurityGroup_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">description </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Security group for EC2 instances in ECS cluster</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">ingress</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">description     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow ingress traffic from ALB on HTTP on ephemeral ports</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">from_port       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">1024</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">to_port         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">65535</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">protocol        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">tcp</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">security_groups </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_security_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">ingress</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">description     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow SSH ingress traffic from bastion host</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">from_port       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">22</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">to_port         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">22</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">protocol        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">tcp</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">security_groups </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_security_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">bastion_host</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">egress</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">description </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow all egress traffic</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">from_port   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">to_port     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">protocol    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">-</span><span style="color: #F78C6C">1</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">cidr_blocks </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">0.0.0.0/0</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_EC2_Instance_SecurityGroup_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>The ALB also allows all outbound traffic. Going in, we again limit access to known AWS CIDR block ranges, which we can query via the <code>aws_ec2_managed_prefix_list</code> resource in the form of <a href="https://aws.amazon.com/de/blogs/networking-and-content-delivery/limit-access-to-your-origins-using-the-aws-managed-prefix-list-for-amazon-cloudfront/" data-type="URL" data-id="https://aws.amazon.com/de/blogs/networking-and-content-delivery/limit-access-to-your-origins-using-the-aws-managed-prefix-list-for-amazon-cloudfront/" target="_blank" rel="noreferrer noopener">managed prefix lists</a>. This is an additional layer of security to the Custom Origin Header.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## SG for ALBresource &quot;aws_security_group&quot; &quot;alb&quot; {
name        = &quot;${var.namespace}_ALB_SecurityGroup_${var.environment}&quot;
description = &quot;Security group for ALB&quot;
vpc_id      = aws_vpc.default.idegress {
description = &quot;Allow all egress traffic&quot;
from_port   = 0
to_port     = 0
protocol    = -1
cidr_blocks = [&quot;0.0.0.0/0&quot;]
}tags = {
Name     = &quot;${var.namespace}_ALB_SecurityGroup_${var.environment}&quot;
}
}data &quot;aws_ec2_managed_prefix_list&quot; &quot;cloudfront&quot; {
name = &quot;com.amazonaws.global.cloudfront.origin-facing&quot;
}## We only allow incoming traffic on HTTP and HTTPS from known CloudFront CIDR blocks
resource &quot;aws_security_group_rule&quot; &quot;alb_cloudfront_https_ingress_only&quot; {
security_group_id = aws_security_group.alb.id
description       = &quot;Allow HTTPS access only from CloudFront CIDR blocks&quot;
from_port         = 443
protocol          = &quot;tcp&quot;
prefix_list_ids   = [data.aws_ec2_managed_prefix_list.cloudfront.id]
to_port           = 443
type              = &quot;ingress&quot;
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## SG for ALB</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_security_group"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"alb"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ALB_SecurityGroup_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">description </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Security group for ALB</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">egress</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">description </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow all egress traffic</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">from_port   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">to_port     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">protocol    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">-</span><span style="color: #F78C6C">1</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">cidr_blocks </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">0.0.0.0/0</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_ALB_SecurityGroup_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">data</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_ec2_managed_prefix_list"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"cloudfront"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">com.amazonaws.global.cloudfront.origin-facing</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## We only allow incoming traffic on HTTP and HTTPS from known CloudFront CIDR blocks</span></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_security_group_rule"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"alb_cloudfront_https_ingress_only"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">security_group_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_security_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">description       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow HTTPS access only from CloudFront CIDR blocks</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">from_port         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">443</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">protocol          </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">tcp</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">prefix_list_ids   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_ec2_managed_prefix_list</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">cloudfront</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">to_port           </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">443</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">type              </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">ingress</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><h2 class="wp-block-heading"><span id="CloudFront_Distribution">CloudFront Distribution</span></h2><p>As a final component, we use a CloudFront Distribution to provide fast, low-latency access to our service worldwide (a multi-region setup would improve this scenario even further), but also to use Web Application Firewall Rules (WAF) and benefit from AWS Shield enabled by default. WAF is used for detecting and preventing malicious attacks such as SQL injections, while AWS Shield provides a first level of DDoS attack security. AWS Shield can be upgraded to the paid AWS Shield Advanced as needed.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## CloudFront distributionresource &quot;aws_cloudfront_distribution&quot; &quot;default&quot; {
comment         = &quot;${var.namespace} CloudFront Distribution&quot;
enabled         = true
is_ipv6_enabled = true
aliases         = [&quot;${var.environment}.${var.domain_name}&quot;]default_cache_behavior {
allowed_methods        = [&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;, &quot;PUT&quot;, &quot;POST&quot;, &quot;PATCH&quot;, &quot;DELETE&quot;]
cached_methods         = [&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;]
target_origin_id       = aws_alb.alb.name
viewer_protocol_policy = &quot;redirect-to-https&quot;forwarded_values {
query_string = true
headers      = [&quot;*&quot;]cookies {
forward = &quot;all&quot;
}
}
}origin {
domain_name = aws_alb.alb.dns_name
origin_id   = aws_alb.alb.namecustom_header {
name  = &quot;X-Custom-Header&quot;
value = var.custom_origin_host_header
}custom_origin_config {
origin_read_timeout      = 60
origin_keepalive_timeout = 60
http_port                = 80
https_port               = 443
origin_protocol_policy   = &quot;https-only&quot;
origin_ssl_protocols     = [&quot;TLSv1&quot;, &quot;TLSv1.1&quot;, &quot;TLSv1.2&quot;]
}
}restrictions {
geo_restriction {
restriction_type = &quot;none&quot;
}
}viewer_certificate {
acm_certificate_arn      = aws_acm_certificate.cloudfront_certificate.arn
minimum_protocol_version = &quot;TLSv1.1_2016&quot;
ssl_support_method       = &quot;sni-only&quot;
}tags = {
Name     = &quot;${var.namespace}_CloudFront_${var.environment}&quot;
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## CloudFront distribution</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_cloudfront_distribution"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"default"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">comment         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D"> CloudFront Distribution</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">enabled         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">is_ipv6_enabled </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">aliases         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">.</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">default_cache_behavior</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">allowed_methods        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GET</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">HEAD</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">OPTIONS</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">PUT</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">POST</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">PATCH</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">DELETE</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">cached_methods         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">GET</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">HEAD</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">OPTIONS</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">target_origin_id       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">viewer_protocol_policy </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">redirect-to-https</span><span style="color: #89DDFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">forwarded_values</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">query_string </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">headers      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">*</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #FFCB6B">cookies</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #EEFFFF">forward </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">all</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">origin</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">domain_name </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">dns_name</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">origin_id   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">alb</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">custom_header</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">name  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">X-Custom-Header</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">value </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">custom_origin_host_header</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">custom_origin_config</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">origin_read_timeout      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">60</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">origin_keepalive_timeout </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">60</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">http_port                </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">80</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">https_port               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">443</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">origin_protocol_policy   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">https-only</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">origin_ssl_protocols     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">TLSv1</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">TLSv1.1</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">TLSv1.2</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">restrictions</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #FFCB6B">geo_restriction</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #EEFFFF">restriction_type </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">none</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">viewer_certificate</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">acm_certificate_arn      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_acm_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">cloudfront_certificate</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">arn</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">minimum_protocol_version </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">TLSv1.1_2016</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">ssl_support_method       </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">sni-only</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_CloudFront_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><p>CloudFront is linked to our ALB via <code>target_origin_id</code>. Using the configuration <code>redirect-to-https</code> we ensure that all incoming traffic for the user is always redirected to HTTPS. So if we as a user type <code>http://service.example.com</code>, we will automatically be redirected to <code>https://service.example.com</code>.</p><p>In the <code>custom_header</code> we configure our Custom Origin Header, which we have already prepared in our ALB Listener. As <code>acm_certificate_arn</code> we now use the certificate specially created in the <code>us-east-1</code> region here.</p><h2 class="wp-block-heading"><span id="Bastion_Host">Bastion Host</span></h2><p>One of the advantages of ECS on EC2 over ECS Fargate is that we have full control over the underlying compute layer (EC2 Instances). Among other things, this can also be helpful for debugging Docker containers that do not start correctly. For this, we need access to the EC2 Instances, which is possible via SSH. However, since the Container Instances are running in a Private Subnet and do not have a public IP, we need to find another way to establish a secure connection.</p><p>Using Bastion Host (sometimes also called Jump Host), a separate small EC2 Instance running in one of our Public Subnets and only allowing access via SSH on port <code>22</code>, users with the appropriate Private Key can connect to the Container Instances via <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/using-ssh-agent-forwarding" data-type="URL" data-id="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/using-ssh-agent-forwarding" target="_blank" rel="noreferrer noopener">SSH Agent Forwarding</a>. Alternatively, <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Connect-using-EC2-Instance-Connect.html" data-type="URL" data-id="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Connect-using-EC2-Instance-Connect.html" target="_blank" rel="noreferrer noopener">AWS Instance Connect</a> could be used to establish a terminal session on the Container Instance from the AWS Console without explicitly using the SSH key.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Bastion host SG and EC2 Instanceresource &quot;aws_security_group&quot; &quot;bastion_host&quot; {
name        = &quot;${var.namespace}_SecurityGroup_BastionHost_${var.environment}&quot;
description = &quot;Bastion host Security Group&quot;
vpc_id      = aws_vpc.default.idingress {
description = &quot;Allow SSH&quot;
from_port   = 22
to_port     = 22
protocol    = &quot;tcp&quot;
cidr_blocks = [&quot;0.0.0.0/0&quot;] ## The IP range could be limited to the developers IP addresses if they are fix
}egress {
description = &quot;Allow all outbound traffic&quot;
from_port   = 0
to_port     = 0
protocol    = -1
cidr_blocks = [&quot;0.0.0.0/0&quot;]
}
}resource &quot;aws_instance&quot; &quot;bastion_host&quot; {
ami                         = data.aws_ami.amazon_linux_2.id
instance_type               = &quot;t3.micro&quot;
subnet_id                   = aws_subnet.public[0].id
associate_public_ip_address = true
key_name                    = aws_key_pair.default.id
vpc_security_group_ids      = [aws_security_group.bastion_host.id]tags = {
Name     = &quot;${var.namespace}_EC2_BastionHost_${var.environment}&quot;
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Bastion host SG and EC2 Instance</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_security_group"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"bastion_host"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name        </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_SecurityGroup_BastionHost_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">description </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Bastion host Security Group</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_id      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_vpc</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">ingress</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">description </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow SSH</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">from_port   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">22</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">to_port     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">22</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">protocol    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">tcp</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">cidr_blocks </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">0.0.0.0/0</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span><span style="color: #F07178"> </span><span style="color: #545454; font-style: italic">## The IP range could be limited to the developers IP addresses if they are fix</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">egress</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">description </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Allow all outbound traffic</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">from_port   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">to_port     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">protocol    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">-</span><span style="color: #F78C6C">1</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">cidr_blocks </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">0.0.0.0/0</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_instance"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"bastion_host"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">ami                         </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">data</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">aws_ami</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">amazon_linux_2</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">instance_type               </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">t3.micro</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">subnet_id                   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_subnet</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">public</span><span style="color: #89DDFF">[</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">].</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">associate_public_ip_address </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">true</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">key_name                    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_key_pair</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">vpc_security_group_ids      </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">aws_security_group</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">bastion_host</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span><span style="color: #89DDFF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">tags </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">Name</span><span style="color: #F07178">     </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">namespace</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">_EC2_BastionHost_</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><h2 class="wp-block-heading"><span id="DNS_settings_with_Route_53">DNS settings with Route 53</span></h2><p>To put our whole setup together, we still need the final DNS settings, which we configure with Route 53. In our example we assume that our service runs under a subdomain like <code>service.example.com</code> and should be accessible for different development environments in the <code>dev</code> environment under <code>dev.service.example.com</code>. We therefore need a new Route 53 Hosted Zone for this subdomain, the appropriate nameserver (NS) records in the parent zone, and an A-record pointing to our CloudFront Distribution as the entry point for the service.</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span style="display:block;padding:16px 0 0 16px;margin-bottom:-1px;width:100%;text-align:left;background-color:#212121"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle></g></svg></span><span role="button" tabindex="0" data-code="## Hosted zone for development subdomain of our serviceresource &quot;aws_route53_zone&quot; &quot;environment&quot; {
name  = &quot;${var.environment}.${var.domain_name}&quot;
}resource &quot;aws_route53_record&quot; &quot;environment&quot; {
zone_id = aws_route53_zone.service.id
name    = &quot;${var.environment}.${var.domain_name}&quot;
type    = &quot;NS&quot;
ttl     = 300
records = [
aws_route53_zone.environment.name_servers[0],
aws_route53_zone.environment.name_servers[1],
aws_route53_zone.environment.name_servers[2],
aws_route53_zone.environment.name_servers[3]
]
}## Point A record to CloudFront distribution
resource &quot;aws_route53_record&quot; &quot;service_record&quot; {
name    = &quot;${var.environment}.${var.domain_name}&quot;
type    = &quot;A&quot;
zone_id = aws_route53_zone.environment.idalias {
name                   = aws_cloudfront_distribution.default.domain_name
zone_id                = aws_cloudfront_distribution.default.hosted_zone_id
evaluate_target_health = false
}
}" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Hosted zone for development subdomain of our service</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route53_zone"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"environment"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name  </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">.</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route53_record"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"environment"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">zone_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">service</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">.</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">type    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">NS</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">ttl     </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">300</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">records </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">[</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name_servers</span><span style="color: #89DDFF">[</span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">],</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name_servers</span><span style="color: #89DDFF">[</span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">],</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name_servers</span><span style="color: #89DDFF">[</span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">],</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">name_servers</span><span style="color: #89DDFF">[</span><span style="color: #F78C6C">3</span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">]</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Point A record to CloudFront distribution</span></span>
<span class="line"><span style="color: #FFCB6B">resource</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"aws_route53_record"</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">"service_record"</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">name    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #F78C6C">}</span><span style="color: #C3E88D">.</span><span style="color: #F78C6C">${</span><span style="color: #EEFFFF">var</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span><span style="color: #F78C6C">}</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">type    </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">A</span><span style="color: #89DDFF">"</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #EEFFFF">zone_id </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_route53_zone</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">environment</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #FFCB6B">alias</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">name                   </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_cloudfront_distribution</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">domain_name</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">zone_id                </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F07178">aws_cloudfront_distribution</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">default</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">hosted_zone_id</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #EEFFFF">evaluate_target_health </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">false</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span></code></pre></div><h2 class="wp-block-heading"><span id="IAM_Roles_in_AWS_ECS">IAM Roles in AWS ECS</span></h2><p>AWS ECS uses a total of four different IAM Roles, all of which are used within the context of EC2 Instances, ECS Service, and ECS Tasks. These roles can be a bit confusing if it is not clear which role does what.</p><p>We use the following IAM Roles:</p><ul><li>The <code>Nexgeneerz_EC2_InstanceRole</code> within the Launch Template: this role is assumed by every single EC2 Instance launched. Since we are working with AWS Elastic Container Services (ECS), we use AWS’s own service role <code>AmazonEC2ContainerServiceforEC2Role</code> here. For example, this role grants the permission <code>ecs:RegisterContainerInstance</code> , which is used by the ECS Service Agent running in the EC2 Instance to register itself as a newly started Container Instance in the ECS Cluster. An overview of all granted permissions can be found <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/security-iam-awsmanpol.html" data-type="URL" data-id="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/security-iam-awsmanpol.html" target="_blank" rel="noreferrer noopener">here</a>. In summary: the <code>Nexgeneerz_EC2_InstanceRole</code> is assumed by the Principal <em>EC2 Instance</em> to perform tasks like (de)registering Container Instances.</li><li>The <code>Nexgeneerz_ECS_ServiceRole</code>, which is used by the ECS Service: Here, a service-linked role with a policy similar to <code>AmazonECSServiceRolePolicy</code> is used to allow ECS to <a href="https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AmazonECSServiceRolePolicy.html" data-type="URL" data-id="https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AmazonECSServiceRolePolicy.html" target="_blank" rel="noreferrer noopener">manage the cluster</a>. In the AWS Console, this role would be automatically created for us, but in the case of Infrastructure-as-Code, we handle this ourselves and use a separate role for it to avoid conflicts when using multiple ECS Clusters and ECS Services.</li><li>In the resource <code>aws_ecs_task_definition</code> two roles are expected. The <code>execution_role_arn</code> is the <code>Nexgeneerz_ECS_TaskExecutionRole</code> role that takes the <code>AmazonECSTaskExecutionRolePolicy</code> policy. The Task Execution Role grants the ECS Agent the necessary rights to write log streams, for example. Depending on the requirements, it may be necessary to define a separate inline policy.</li><li>The role <code>Nexgeneerz_ECS_TaskIAMRole</code> is assumed by the executed ECS Task itself. It may be necessary if the talk needs access to additional AWS services (which is not the case in our example, so this role exists only as an empty container and does not get any permissions).</li></ul><h2 class="wp-block-heading"><span id="Connect_to_the_EC2_Instances">Connect to the EC2 Instances</span></h2><p>One of the advantages of ECS EC2 over ECS Fargate is the unrestricted access to the EC2 instances we control via the Launch Template, including Security Groups and SSH Keys. For debugging purposes it can sometimes be helpful to connect to these EC2 instances via SSH. For this purpose, we have stored the appropriate security group rules and created the bastion host, since the EC2 instances run in a private subnet without direct access from the Internet.</p><p>To connect to one of the instances, we need to determine its Private IP in the AWS Console for this EC2 instance (e.g. <code>192.173.98.20</code>). We also need the public IP address of the Bastion Host, let’s say it is <code>173.198.20.89</code>. Since we are using <a href="http://www.unixwiz.net/techtips/ssh-agent-forwarding.html" data-type="URL" data-id="http://www.unixwiz.net/techtips/ssh-agent-forwarding.html" target="_blank" rel="noreferrer noopener">agent forwarding over SSH</a>, we need to execute the following commands, using the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/managing-users.html" target="_blank" data-type="URL" data-id="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/managing-users.html" rel="noreferrer noopener">default EC2 Instance user</a> <code>ec2-user</code>:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span role="button" tabindex="0" data-code="## Add your private SSH key to the SSH Agent
ssh-add ~/.ssh/path_to_your_private_ssh_key## Connect to the Bastion Host EC2 Instance using the public IP address
ssh -A ec2-user@173.198.20.89" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## Add your private SSH key to the SSH Agent</span></span>
<span class="line"><span style="color: #FFCB6B">ssh-add</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">~/.ssh/path_to_your_private_ssh_key</span></span>
<span class="line"></span>
<span class="line"><span style="color: #545454; font-style: italic">## Connect to the Bastion Host EC2 Instance using the public IP address</span></span>
<span class="line"><span style="color: #FFCB6B">ssh</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">-A</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">ec2-user@173.198.20.89</span></span></code></pre></div><p>Once you are logged in to the Bastion Host, you can continue to connect from there to the private EC2 Instance:</p><div class="wp-block-kevinbatdorf-code-block-pro cbp-hl-loaded" style="font-size:.875rem;line-height:1.25rem"><span role="button" tabindex="0" data-code="## When you are logged in to the Bastion Host, connect to the private IP address of one of the EC2 Instances
ssh ec2-user@192.173.98.20" style="color: rgb(238, 255, 255); display: block;" aria-label="Copy" class="code-block-pro-copy-button cbp-cb-loaded"><svg xmlns="http://www.w3.org/2000/svg" style="width:24px;height:24px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path class="with-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path><path class="without-check" stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></span><pre class="shiki material-theme-darker" style="background-color: #212121"><code><span class="line"><span style="color: #545454; font-style: italic">## When you are logged in to the Bastion Host, connect to the private IP address of one of the EC2 Instances</span></span>
<span class="line"><span style="color: #FFCB6B">ssh</span><span style="color: #EEFFFF"> </span><span style="color: #C3E88D">ec2-user@192.173.98.20</span></span></code></pre></div><p>After we have successfully logged in, we can perform further actions, such as debugging why a particular Docker container is not starting.</p><h2 class="wp-block-heading"><span id="What_is_missing">What is missing?</span></h2><p>Although we have already covered many components necessary for a production-grade infrastructure in our setup, there are still some configurations that we have omitted from this tutorial for clarity and ease of understanding. These include the following components:</p><ul><li>Configuration of AWS Web Application Firewalls (WAF) Rules for CloudFront.</li><li>Possibly configuring ACL at the network level.</li><li>Restricting the IP range for the bastion host to specific CIDR blocks, although access control via AWS EC2 Instance Connect in the AWS Console is the preferred way to go here due to better access control.</li></ul><p>That said, this article already provides an in-depth look at configuring, provisioning and scaling ECS on EC2 for organizations that want to run their applications in Docker containers in the AWS Cloud.</p><h2 class="wp-block-heading"><span id="Conclusion">Conclusion</span></h2><p>ECS on EC2 is an extremely powerful tool for creating complex infrastructure without significant limitations. Building and managing the infrastructure requires a solid understanding of techniques such as autoscaling, as well as aspects such as load balancing, security groups and networking. In terms of flexibility, ECS on EC2 is almost on a par with Kubernetes and can be extended in almost any direction.</p><p>However, one should not underestimate the operational effort that goes hand in hand with this flexibility. Smaller teams in particular may reach their limits here if they first have to painstakingly acquire this knowledge themselves and neglect the operational part. With our <a href="https://nexgeneerz.io/cloud-for-startups-aws/" data-type="page" data-id="42670">Cloud Computing for Startups</a> offering, we support such companies in particular in taking advantage of flexible and highly available infrastructure, reliably building up the necessary knowledge and then being able to drive forward further development in line with business goals on their own responsibility. Infrastructure in the cloud will become more and more standard in the future and software engineering teams are well advised to acquire the necessary skills in time to ensure cost-efficient product development with fast time-to-market.</p><p>Whew, that was a big one! 😅</p><p>Hopefully you were able to learn something in our article about Amazon ECS EC2 with Terraform and apply it to your own use case.</p><p>Our goal at nexgeneerz.io is to share knowledge with others in the tech community and learn together. Because that’s the only way we can keep reducing the complexity that comes with such technologies.</p><p>If you liked this post, share it with your friends and colleagues. Together we can help more people learn and grow about cloud computing and Amazon ECS. You can also follow us on <a href="https://www.linkedin.com/company/nexgeneerz" target="_blank" data-type="URL" data-id="https://www.linkedin.com/company/nexgeneerz" rel="noreferrer noopener">LinkedIn</a> to stay up to date about new articles like this. 🚀</p><div class="reading-position-indicator-end"></div></div></div></div></div></div></div></section><section class="l-section wpb_row height_auto width_full"><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_top type_boxes stacking_default"><div class="vc_col-sm-4 wpb_column vc_column_container"><div class="vc_column-inner us_custom_7e20fa79 us_animate_this"><div class="wpb_wrapper"><div class="wpb_text_column"><div class="wpb_wrapper"><h3>Share this article</h3><div class="essb_links essb_displayed_shortcode essb_share essb_template_round-retina essb_template_modern-light-retina essb_1405702776 essb_icon_animation2 print-no" id="essb_displayed_shortcode_1405702776" data-essb-postid="43185" data-essb-position="shortcode" data-essb-button-style="icon" data-essb-template="round-retina essb_template_modern-light-retina" data-essb-counter-pos="hidden" data-essb-url="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/" data-essb-fullurl="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/" data-essb-instance="1405702776"><ul class="essb_links_list essb_force_hide_name essb_force_hide"><li class="essb_item essb_link_linkedin nolightbox"> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;ro=true&amp;trk=EasySocialShareButtons&amp;title=A+comprehensive+guide+for+Amazon+ECS+EC2+using+Terraform&amp;url=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F" title="Share on LinkedIn" onclick="essb.window(&#39;https://www.linkedin.com/shareArticle?mini=true&amp;ro=true&amp;trk=EasySocialShareButtons&amp;title=A+comprehensive+guide+for+Amazon+ECS+EC2+using+Terraform&amp;url=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F&#39;,&#39;linkedin&#39;,&#39;1405702776&#39;); return false;" target="_blank" rel="noreferrer noopener nofollow" class="nolightbox essb-s-c-linkedin essb-s-bgh-linkedin essb-s-ch-light essb-s-c-network essb-s-bgh-network"><span class="essb_icon essb_icon_linkedin"></span><span class="essb_network_name essb_noname"></span></a></li><li class="essb_item essb_link_xing nolightbox"> <a href="https://www.xing.com/spi/shares/new?url=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F" title="Share on Xing" onclick="essb.window(&#39;https://www.xing.com/spi/shares/new?url=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F&#39;,&#39;xing&#39;,&#39;1405702776&#39;); return false;" target="_blank" rel="noreferrer noopener nofollow" class="nolightbox essb-s-c-xing essb-s-bgh-xing essb-s-ch-light essb-s-c-network essb-s-bgh-network"><span class="essb_icon essb_icon_xing"></span><span class="essb_network_name essb_noname"></span></a></li><li class="essb_item essb_link_twitter nolightbox"> <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" title="Share on Twitter" onclick="essb.window(&#39;https://twitter.com/intent/tweet?text=A%20comprehensive%20guide%20for%20Amazon%20ECS%20EC2%20using%20Terraform&amp;url=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F&amp;counturl=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F&#39;,&#39;twitter&#39;,&#39;1405702776&#39;); return false;" target="_blank" rel="noreferrer noopener nofollow" class="nolightbox essb-s-c-twitter essb-s-bgh-twitter essb-s-ch-light essb-s-c-network essb-s-bgh-network"><span class="essb_icon essb_icon_twitter"></span><span class="essb_network_name essb_noname"></span></a></li><li class="essb_item essb_link_facebook nolightbox"> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F&amp;t=A+comprehensive+guide+for+Amazon+ECS+EC2+using+Terraform" title="Share on Facebook" onclick="essb.window(&#39;https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fnexgeneerz.io%2Faws-computing-with-ecs-ec2-terraform%2F&amp;t=A+comprehensive+guide+for+Amazon+ECS+EC2+using+Terraform&#39;,&#39;facebook&#39;,&#39;1405702776&#39;); return false;" target="_blank" rel="noreferrer noopener nofollow" class="nolightbox essb-s-c-facebook essb-s-bgh-facebook essb-s-ch-light essb-s-c-network essb-s-bgh-network"><span class="essb_icon essb_icon_facebook"></span><span class="essb_network_name essb_noname"></span></a></li></ul></div></div></div></div></div></div><div class="vc_col-sm-8 wpb_column vc_column_container"><div class="vc_column-inner us_custom_a518f36e us_animate_this"><div class="wpb_wrapper"><h3 style="text-align: left" class="vc_custom_heading">About the author</h3><div class="w-post-elm post_author author-bio vcard author color_link_inherit with_ava avapos_left"><a href="https://nexgeneerz.io/author/falko-burghausen/" class="fn" aria-hidden="true" tabindex="-1"><div class="post-author-ava" style="font-size:100px;"><img alt="Avatar of Falko Burghausen" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/4797f640c6637f259c12bc74755fb2cd(1).jpeg" srcset="https://secure.gravatar.com/avatar/4797f640c6637f259c12bc74755fb2cd?s=200&amp;d=mm&amp;r=g 2x" class="avatar avatar-100 photo" height="100" width="100" loading="lazy" decoding="async"></div></a><div class="post-author-meta"><a href="https://nexgeneerz.io/author/falko-burghausen/" class="post-author-name fn">Falko Burghausen</a><div class="post-author-info">Falko is a seasoned technical lead with many years of experience in the tech business. He has seen the IT industry both through the eyes of a software engineer and in a wide variety of leadership roles, including CTO in a Swiss HealthTech company. Falko is an AWS certified Cloud Solutions Architect and brings extensive knowledge in product and software development, leadership and cloud computing. A running-addicted part-time digital nomad, who is also often to be found with his camera as a landscape photographer somewhere in the Alps or the far north.</div></div></div></div></div></div></div></div></section><section class="l-section wpb_row height_medium color_alternate"><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_top type_default stacking_default"><div class="vc_col-sm-12 wpb_column vc_column_container"><div class="vc_column-inner us_custom_a518f36e us_animate_this"><div class="wpb_wrapper"><h3 style="text-align: left" class="vc_custom_heading">Related articles</h3><div class="w-grid type_masonry layout_42731 cols_2 overflow_hidden with_isotope with_css_animation" id="us_grid_3" style="--gap:1.5rem;" data-filterable="true"><style>@media (max-width:600px){#us_grid_3 .w-grid-list{margin:0}#us_grid_3 .w-grid-item{width:100%;padding:0;margin-bottom:var(--gap,0px)}}.layout_42731 .w-grid-item-h{background:#3F454A;color:var(--color-content-heading);border-radius:0.5rem;box-shadow:0 0.06rem 0.12rem rgba(0,0,0,0.1),0 0.2rem 0.6rem rgba(0,0,0,0.1);transition-duration:0.3s}.no-touch .layout_42731 .w-grid-item-h:hover{box-shadow:0 0.12rem 0.24rem rgba(0,0,0,0.1),0 0.4rem 1.2rem rgba(0,0,0,0.15);z-index:4}.layout_42731 .usg_vwrapper_1{position:static!important;padding:0.8rem 1.5rem 1.5rem 1.5rem!important}.layout_42731 .usg_post_taxonomy_1{font-size:0.6rem!important;line-height:1.5!important;font-weight:600!important;text-transform:uppercase!important}.layout_42731 .usg_post_title_1{color:inherit!important;font-size:1.2rem!important;font-weight:900!important}.layout_42731 .usg_post_author_1{font-weight:700!important}.layout_42731 .usg_hwrapper_2{margin-top:1rem!important}.layout_42731 .usg_post_custom_field_1{color:var(--color-header-middle-text-hover)!important}.layout_42731 .usg_post_content_1{color:var(--color-content-bg-alt)!important;font-size:1rem!important;line-height:1.6!important}@media (min-width:1176px) and (max-width:1280px){.layout_42731 .usg_post_title_1{font-weight:900!important}.layout_42731 .usg_hwrapper_2{margin-top:1rem!important}}@media (min-width:601px) and (max-width:1175px){.layout_42731 .usg_post_title_1{font-weight:900!important}.layout_42731 .usg_hwrapper_2{margin-top:1rem!important}}@media (max-width:600px){.layout_42731 .usg_post_title_1{font-size:1rem!important;font-weight:900!important}.layout_42731 .usg_hwrapper_2{margin-top:0.5rem!important}}</style><div class="w-grid-list" style="position: relative; height: 706.312px;"><article class="w-grid-item us_animate_fade size_1x1 post-43232 post type-post status-publish format-standard has-post-thumbnail hentry category-amazon-web-services-aws-cloud-computing tag-alb tag-cloudfront tag-cloudwatch tag-ecs tag-iam tag-internet-gateway tag-nat-gateway tag-route53 tag-security-group tag-subnet tag-target-group tag-trunk-based-development tag-vpc" data-id="43232" style="animation-delay: 0s; position: absolute; left: 0px; top: 0px;"><div class="w-grid-item-h"><div class="w-post-elm post_image usg_post_image_1 has_ratio"><div style="padding-bottom:56.25%"></div><a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/" aria-label="How to setup Amazon ECS Fargate using Terraform"><img width="600" height="338" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/ECS-Fargate-600x338.jpg" class="attachment-us_600_0 size-us_600_0 wp-post-image" alt="In-depth tutorial ECS Fargate" decoding="async" loading="lazy" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-600x338.jpg 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-350x197.jpg 350w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-1000x563.jpg 1000w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-768x432.jpg 768w, https://cdn.nexgeneerz.io/wp-content/uploads/2023/04/24210857/ECS-Fargate-scaled.jpg 2000w" sizes="(max-width: 600px) 100vw, 600px" title="How to setup Amazon ECS Fargate using Terraform 9"></a></div><div class="w-vwrapper usg_vwrapper_1 align_none valign_top"><div class="w-post-elm post_taxonomy usg_post_taxonomy_1 style_simple"><a class="term-4632 term-amazon-web-services-aws-cloud-computing" href="https://nexgeneerz.io/topic/cloud-infrastructure/amazon-web-services-aws-cloud-computing/">AWS Cloud Computing</a></div><h2 class="w-post-elm post_title usg_post_title_1 has_text_color entry-title color_link_inherit"><a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/">How to setup Amazon ECS Fargate using Terraform</a></h2><div class="w-post-elm post_content usg_post_content_1 has_text_color"><p>A tutorial as part of our series “Cloud Computing” with Amazon ECS Fargate in a production-ready setup using Infrastructure-as-Code with Terraform.</p></div><div class="w-hwrapper usg_hwrapper_2 less-375 tech-card-footer align_justify valign_middle" style="--hwrapper-gap:1.20rem"><div class="w-post-elm post_author usg_post_author_1 story-cards-author vcard author color_link_inherit with_ava avapos_left"><div class="post-author-ava" style="font-size:36px;"><img alt="Avatar of Falko Burghausen" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/4797f640c6637f259c12bc74755fb2cd(2).jpeg" srcset="https://secure.gravatar.com/avatar/4797f640c6637f259c12bc74755fb2cd?s=72&amp;d=mm&amp;r=g 2x" class="avatar avatar-36 photo" height="36" width="36" loading="lazy" decoding="async"></div><div class="post-author-meta"><div class="post-author-name">Falko Burghausen</div></div></div><div class="w-post-elm post_custom_field usg_post_custom_field_1 has_text_color type_text reading_time color_link_inherit"><i class="fas fa-clock"></i><span class="w-post-elm-value">12</span><span class="w-post-elm-after"> minutes</span></div></div></div></div></article><article class="w-grid-item us_animate_fade size_1x1 post-42029 post type-post status-publish format-standard has-post-thumbnail hentry category-engineering-productivity tag-agile tag-extreme-programming tag-trunk-based-development" data-id="42029" style="animation-delay: 0.1s; position: absolute; left: 577px; top: 0px;"><div class="w-grid-item-h"><div class="w-post-elm post_image usg_post_image_1 has_ratio"><div style="padding-bottom:56.25%"></div><a href="https://nexgeneerz.io/how-does-trunk-based-development-work/" aria-label="Trunk-based development – how does it work?"><img width="600" height="338" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/trunk-based-development-600x338.jpeg" class="attachment-us_600_0 size-us_600_0 wp-post-image" alt="Trunk-based development" decoding="async" loading="lazy" srcset="https://cdn.nexgeneerz.io/wp-content/uploads/2022/11/08175753/trunk-based-development-600x338.jpeg 600w, https://cdn.nexgeneerz.io/wp-content/uploads/2022/11/08175753/trunk-based-development-768x432.jpeg 768w, https://cdn.nexgeneerz.io/wp-content/uploads/2022/11/08175753/trunk-based-development.jpeg 2000w" sizes="(max-width: 600px) 100vw, 600px" title="Trunk-based development – how does it work? 10"></a></div><div class="w-vwrapper usg_vwrapper_1 align_none valign_top"><div class="w-post-elm post_taxonomy usg_post_taxonomy_1 style_simple"><a class="term-4574 term-engineering-productivity" href="https://nexgeneerz.io/topic/engineering-principles/engineering-productivity/">Engineering Productivity</a></div><h2 class="w-post-elm post_title usg_post_title_1 has_text_color entry-title color_link_inherit"><a href="https://nexgeneerz.io/how-does-trunk-based-development-work/">Trunk-based development – how does it work?</a></h2><div class="w-post-elm post_content usg_post_content_1 has_text_color"><p>Trunk-based development is a development method designed for high performance and continuous, automated deployments with great potential for engineering teams that want to work with state-of-the-art tools and processes.</p></div><div class="w-hwrapper usg_hwrapper_2 less-375 tech-card-footer align_justify valign_middle" style="--hwrapper-gap:1.20rem"><div class="w-post-elm post_author usg_post_author_1 story-cards-author vcard author color_link_inherit with_ava avapos_left"><div class="post-author-ava" style="font-size:36px;"><img alt="Avatar of Falko Burghausen" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/4797f640c6637f259c12bc74755fb2cd(2).jpeg" srcset="https://secure.gravatar.com/avatar/4797f640c6637f259c12bc74755fb2cd?s=72&amp;d=mm&amp;r=g 2x" class="avatar avatar-36 photo" height="36" width="36" loading="lazy" decoding="async"></div><div class="post-author-meta"><div class="post-author-name">Falko Burghausen</div></div></div><div class="w-post-elm post_custom_field usg_post_custom_field_1 has_text_color type_text reading_time color_link_inherit"><i class="fas fa-clock"></i><span class="w-post-elm-value">12</span><span class="w-post-elm-after"> minutes</span></div></div></div></div></article></div><div class="w-grid-preloader"><div class="g-preloader type_1"><div></div></div></div></div></div></div></div></div></div></section><section class="l-section wpb_row height_medium color_alternate"><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_top type_default stacking_default"><div class="vc_col-sm-12 wpb_column vc_column_container"><div class="vc_column-inner us_custom_a518f36e us_animate_this"><div class="wpb_wrapper"><div class="w-post-elm post_navigation layout_simple inv_false"><div class="post_navigation-item order_first to_prev"></div><a class="post_navigation-item order_second to_next" href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/" title="How to setup Amazon ECS Fargate using Terraform"><div class="post_navigation-item-arrow"></div><div class="post_navigation-item-meta">Next article</div><div class="post_navigation-item-title"><span>How to setup Amazon ECS Fargate using Terraform</span></div></a></div></div></div></div></div></div></section><section class="l-section wpb_row height_medium"><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_top type_default stacking_default"><div class="vc_col-sm-12 wpb_column vc_column_container"><div class="vc_column-inner us_custom_a518f36e us_animate_this"><div class="wpb_wrapper"><div class="w-post-elm post_comments layout_comments_template"><div id="comments" class="w-comments"><div id="respond" class="comment-respond"><h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://nexgeneerz.io/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate=""><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> <span class="required-field-message">Required fields are marked <span class="required">*</span></span></p><div class="w-form-row for_textarea required"><div class="w-form-row-field"><textarea aria-label="Comment" name="comment" placeholder="Comment *" data-required="true" aria-required="true"></textarea></div><div class="w-form-row-state">Fill out this field</div></div><div class="w-form-row for_text required"><div class="w-form-row-field">
<input aria-label="Name" type="text" name="author" value="" placeholder="Name *" data-required="true" aria-required="true"></div><div class="w-form-row-state">Fill out this field</div></div><div class="w-form-row for_email required"><div class="w-form-row-field">
<input aria-label="Email" type="email" name="email" value="" placeholder="Email *" data-required="true" aria-required="true"></div><div class="w-form-row-state">Please enter a valid email address.</div></div><div class="w-form-row for_agreement required"><div class="w-form-row-field">
<label>
<input type="checkbox" value="1" data-required="true" aria-required="true" name="wp-comment-cookies-consent">
<span>Save my name, email, and website in this browser for the next time I comment.</span>
</label></div><div class="w-form-row-state">You need to agree with the terms to proceed</div></div><div class="g-recaptcha-wrap" style="padding:10px 0 10px 0"><div class="g-recaptcha" data-sitekey="6LeXSSIkAAAAAAdBUGuVmPXwPlE8jWKPVA-mCnnH"><div style="width: 304px; height: 78px;"><div><iframe title="reCAPTCHA" width="304" height="78" role="presentation" name="a-udekmzl9acq1" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/anchor.html"></iframe></div><textarea id="g-recaptcha-response" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid rgb(193, 193, 193); margin: 10px 25px; padding: 0px; resize: none; display: none;"></textarea></div><iframe style="display: none;" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/saved_resource(1).html"></iframe></div></div><p class="form-submit"><button type="submit" class="w-btn us-btn-style_7"><span class="w-btn-label">Post Comment</span></button> <input type="hidden" name="comment_post_ID" value="43185" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0"></p><p class="comment-form-aios-antibot-keys"><input type="hidden" name="j7gvtsur" value="5a36rv5gogdv"><input type="hidden" name="y8gyo2qw" value="vw0mh9ljxlwi"><input type="hidden" name="7xrslk76" value="kfaz0vdcpocl"></p></form></div></div></div></div></div></div></div></div></section></main></div><footer id="page-footer" class="l-footer"><section class="l-section wpb_row height_small color_footer-bottom"><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_top type_default stacking_default"><div class="vc_col-sm-4 wpb_column vc_column_container"><div class="vc_column-inner us_custom_a518f36e us_animate_this"><div class="wpb_wrapper"><div class="vc_wp_posts wpb_content_element"><div class="widget widget_recent_entries"><h2 class="widgettitle">Our latest articles</h2><ul><li>
<a href="https://nexgeneerz.io/how-to-setup-amazon-ecs-fargate-terraform/">How to setup Amazon ECS Fargate using Terraform</a>
<span class="post-date">25. April 2023</span></li><li>
<a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/" aria-current="page">A comprehensive guide for Amazon ECS EC2 using Terraform</a>
<span class="post-date">24. April 2023</span></li><li>
<a href="https://nexgeneerz.io/about-story-points-estimations-and-other-expensive-misconceptions/">About Story Points, Estimations and other expensive misconceptions</a>
<span class="post-date">7. April 2023</span></li></ul></div></div></div></div></div><div class="vc_col-sm-4 wpb_column vc_column_container"><div class="vc_column-inner us_custom_a518f36e us_animate_this"><div class="wpb_wrapper"><h2 style="text-align: left" class="vc_custom_heading widgettitle us_custom_da7ceeb3">Our services</h2><nav class="w-menu layout_ver style_links us_menu_1" style="--main-gap:1rem;--main-ver-indent:0.8em;--main-hor-indent:0.8em;"><ul id="menu-footer-menu-en" class="menu"><li id="menu-item-43140" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-43140"><a href="https://nexgeneerz.io/fractional-cto-as-a-service/">Fractional CTO-as-a-Service</a></li><li id="menu-item-43141" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-43141"><a href="https://nexgeneerz.io/cloud-for-startups-aws/">Cloud Computing for Startups</a></li></ul><style>@media ( max-width:600px ){.us_menu_1 .menu{display:block!important}.us_menu_1 .menu>li{margin:0 0 var(--main-gap,1rem)!important}}</style></nav></div></div></div><div class="vc_col-sm-4 wpb_column vc_column_container"><div class="vc_column-inner us_custom_a518f36e us_animate_this"><div class="wpb_wrapper"><h2 style="text-align: left" class="vc_custom_heading widgettitle us_custom_da7ceeb3">Social Media</h2><div class="w-socials us_custom_1e0e9307 color_text shape_rounded style_outlined hover_fade" style="--gap:0.2em;"><div class="w-socials-list"><div class="w-socials-item linkedin"><a target="_blank" rel="nofollow" href="https://www.linkedin.com/company/nexgeneerz" class="w-socials-item-link" title="LinkedIn" aria-label="LinkedIn"><span class="w-socials-item-link-hover"></span><i class="fab fa-linkedin"></i><span class="ripple-container"></span></a></div><div class="w-socials-item medium"><a target="_blank" rel="nofollow" href="https://medium.com/@falko.burghausen" class="w-socials-item-link" title="Medium" aria-label="Medium"><span class="w-socials-item-link-hover"></span><i class="fab fa-medium"></i><span class="ripple-container"></span></a></div><div class="w-socials-item github"><a target="_blank" rel="nofollow" href="https://github.com/nexgeneerz" class="w-socials-item-link" title="GitHub" aria-label="GitHub"><span class="w-socials-item-link-hover"></span><i class="fab fa-github"></i><span class="ripple-container"></span></a></div><div class="w-socials-item rss"><a target="_blank" rel="nofollow" href="https://nexgeneerz.io/feed" class="w-socials-item-link" title="RSS" aria-label="RSS"><span class="w-socials-item-link-hover"></span><i class="fas fa-rss"></i><span class="ripple-container"></span></a></div></div></div></div></div></div></div></div></section><section class="l-section wpb_row footer-bottom height_auto color_footer-top"><div class="l-section-h i-cf"><div class="g-cols vc_row via_flex valign_top type_default reversed stacking_default"><div class="vc_col-sm-12 vc_col-xs-12 wpb_column vc_column_container"><div class="vc_column-inner"><div class="wpb_wrapper"><nav class="w-menu us_custom_dfc0bc7e layout_hor style_links not_responsive us_menu_2" style="--main-gap:1rem;--main-ver-indent:0.8em;--main-hor-indent:0.8em;"><ul id="menu-footer-imprint-menu-en" class="menu"><li id="menu-item-25036" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-25036"><a href="https://nexgeneerz.io/contact/">Imprint</a></li><li id="menu-item-25034" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-25034"><a rel="privacy-policy" href="https://nexgeneerz.io/data-policy/">Data policy</a></li><li id="menu-item-25035" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-25035"><a href="https://nexgeneerz.io/disclaimer/">Disclaimer</a></li><li id="menu-item-30346" class="borlabs-cookie-preference menu-item menu-item-type-custom menu-item-object-custom menu-item-30346"><a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#">Cookie settings</a></li></ul></nav><div class="w-hwrapper us_custom_36de0169 valign_top wrap align_center"><div class="wpb_text_column us_custom_c89666ab"><div class="wpb_wrapper"><p>Made with ❤️ in Switzerland</p></div></div><div class="wpb_text_column"><div class="wpb_wrapper"><p>© 2023 nexgeneerz.io</p></div></div></div></div></div></div></div></div></section></footer>
<a class="w-toplink pos_right" href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" title="Back to top" aria-label="Back to top" role="button"><i class="far fa-angle-up"></i></a>	<button id="w-header-show" class="w-header-show" aria-label="Menu"><span>Menu</span></button><div class="w-header-overlay"></div><div data-nosnippet=""><script id="BorlabsCookieBoxWrap" type="text/template"><div
    id="BorlabsCookieBox"
    class="BorlabsCookie"
    role="dialog"
    aria-labelledby="CookieBoxTextHeadline"
    aria-describedby="CookieBoxTextDescription"
    aria-modal="true"
>
    <div class="bottom-right" style="display: none;">
        <div class="_brlbs-box-wrap">
            <div class="_brlbs-box _brlbs-box-advanced">
                <div class="cookie-box">
                    <div class="container">
                        <div class="row">
                            <div class="col-12">
                                <div class="_brlbs-flex-center">
                                    
                                    <span role="heading" aria-level="3" class="_brlbs-h3" id="CookieBoxTextHeadline">Our website uses cookies.</span>
                                </div>

                                <p id="CookieBoxTextDescription"><span class="_brlbs-paragraph _brlbs-text-description">We use cookies to provide you with a user-friendly, secure and effective website. For more information, please see our Privacy Policy or Cookie Details.</span></p>

                                                                    <fieldset>
                                        <legend class="sr-only">Our website uses cookies.</legend>
                                        <ul>
                                                                                                <li>
                                                        <label class="_brlbs-checkbox">
                                                            Essential                                                            <input
                                                                id="checkbox-essential"
                                                                tabindex="0"
                                                                type="checkbox"
                                                                name="cookieGroup[]"
                                                                value="essential"
                                                                 checked                                                                 disabled                                                                data-borlabs-cookie-checkbox
                                                            >
                                                            <span class="_brlbs-checkbox-indicator"></span>
                                                        </label>
                                                    </li>
                                                                                                    <li>
                                                        <label class="_brlbs-checkbox">
                                                            Statistics                                                            <input
                                                                id="checkbox-statistics"
                                                                tabindex="0"
                                                                type="checkbox"
                                                                name="cookieGroup[]"
                                                                value="statistics"
                                                                                                                                                                                                data-borlabs-cookie-checkbox
                                                            >
                                                            <span class="_brlbs-checkbox-indicator"></span>
                                                        </label>
                                                    </li>
                                                                                        </ul>
                                    </fieldset>

                                    
                                                                    <p class="_brlbs-accept">
                                        <a
                                            href="#"
                                            tabindex="0"
                                            role="button"
                                            class="_brlbs-btn _brlbs-btn-accept-all _brlbs-cursor"
                                            data-cookie-accept-all
                                        >
                                            Accept all                                        </a>
                                    </p>

                                    <p class="_brlbs-accept">
                                        <a
                                            href="#"
                                            tabindex="0"
                                            role="button"
                                            id="CookieBoxSaveButton"
                                            class="_brlbs-btn _brlbs-cursor"
                                            data-cookie-accept
                                        >
                                            Save settings                                        </a>
                                    </p>
                                
                                
                                <p class="_brlbs-manage ">
                                    <a href="#" class="_brlbs-cursor  " tabindex="0" role="button" data-cookie-individual>
                                        Settings                                    </a>
                                </p>

                                <p class="_brlbs-legal">
                                    <a href="#" class="_brlbs-cursor" tabindex="0" role="button" data-cookie-individual>
                                        Cookie details                                    </a>

                                                                            <span class="_brlbs-separator"></span>
                                        <a href="https://nexgeneerz.io/data-policy/" tabindex="0" role="button">
                                            Privacy policy                                        </a>
                                    
                                                                            <span class="_brlbs-separator"></span>
                                        <a href="https://nexgeneerz.io/contact/" tabindex="0" role="button">
                                            Imprint                                        </a>
                                                                    </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div
    class="cookie-preference"
    aria-hidden="true"
    role="dialog"
    aria-describedby="CookiePrefDescription"
    aria-modal="true"
>
    <div class="container not-visible">
        <div class="row no-gutters">
            <div class="col-12">
                <div class="row no-gutters align-items-top">
                    <div class="col-12">
                        <div class="_brlbs-flex-center">
                                                    <span role="heading" aria-level="3" class="_brlbs-h3">Privacy settings</span>
                        </div>

                        <p id="CookiePrefDescription">
                            <span class="_brlbs-paragraph _brlbs-text-description">Here you will find an overview of all cookies used. You can give your consent to whole categories or have further information displayed to you and thus select only certain cookies.</span>                        </p>

                        <div class="row no-gutters align-items-center">
                            <div class="col-12 col-sm-7">
                                <p class="_brlbs-accept">
                                                                            <a
                                            href="#"
                                            class="_brlbs-btn _brlbs-btn-accept-all _brlbs-cursor"
                                            tabindex="0"
                                            role="button"
                                            data-cookie-accept-all
                                        >
                                            Accept all                                        </a>
                                        
                                    <a
                                        href="#"
                                        id="CookiePrefSave"
                                        tabindex="0"
                                        role="button"
                                        class="_brlbs-btn _brlbs-cursor"
                                        data-cookie-accept
                                    >
                                        Save settings                                    </a>

                                                                    </p>
                            </div>

                            <div class="col-12 col-sm-5">
                                <p class="_brlbs-refuse">
                                    <a
                                        href="#"
                                        class="_brlbs-cursor"
                                        tabindex="0"
                                        role="button"
                                        data-cookie-back
                                    >
                                        Back                                    </a>

                                                                    </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div data-cookie-accordion>
                                            <fieldset>
                            <legend class="sr-only">Privacy settings</legend>

                                                                                                <div class="bcac-item">
                                        <div class="d-flex flex-row">
                                            <label class="w-75">
                                                <span role="heading" aria-level="4" class="_brlbs-h4">Essential (4)</span>
                                            </label>

                                            <div class="w-25 text-right">
                                                                                            </div>
                                        </div>

                                        <div class="d-block">
                                            <p>Essential cookies enable basic functions and are necessary for the proper functioning of the website.</p>

                                            <p class="text-center">
                                                <a
                                                    href="#"
                                                    class="_brlbs-cursor d-block"
                                                    tabindex="0"
                                                    role="button"
                                                    data-cookie-accordion-target="essential"
                                                >
                                                    <span data-cookie-accordion-status="show">
                                                        Show cookie information                                                    </span>

                                                    <span data-cookie-accordion-status="hide" class="borlabs-hide">
                                                        Hide cookie information                                                    </span>
                                                </a>
                                            </p>
                                        </div>

                                        <div
                                            class="borlabs-hide"
                                            data-cookie-accordion-parent="essential"
                                        >
                                                                                            <table>
                                                    
                                                    <tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                Borlabs Cookie                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>Eigentümer dieser Website<span>, </span><a href="https://nexgeneerz.io/contact/">Imprint</a></td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Speichert die Einstellungen der Besucher, die in der Cookie Box von Borlabs Cookie ausgewählt wurden.</td>
                                                        </tr>
                                                        
                                                    
                                                    
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>borlabs-cookie</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie lifetime</th>
                                                            <td>1 Jahr</td>
                                                        </tr>
                                                                                                        </table>
                                                                                                <table>
                                                    
                                                    <tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                Post Views Counter                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>Owner of this website</td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Simple count of unique users, recognized by a cookie set by us. No data such as IP addresses or similar are stored here.</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Data policy</th>
                                                            <td class="_brlbs-pp-url">
                                                                <a
                                                                    href="https://nexgeneerz.io/en/data-policy"
                                                                    target="_blank"
                                                                    rel="nofollow noopener noreferrer"
                                                                >
                                                                    https://nexgeneerz.io/en/data-policy                                                                </a>
                                                            </td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Host(s)</th>
                                                            <td>nexgeneerz.io, www.nexgeneerz.io</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>pvc_visits[0]</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie lifetime</th>
                                                            <td>1 day</td>
                                                        </tr>
                                                                                                        </table>
                                                                                                <table>
                                                    
                                                    <tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                WPML                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>Owner of this website</td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Saves the current language.</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Data policy</th>
                                                            <td class="_brlbs-pp-url">
                                                                <a
                                                                    href="https://nexgeneerz.io/en/data-policy"
                                                                    target="_blank"
                                                                    rel="nofollow noopener noreferrer"
                                                                >
                                                                    https://nexgeneerz.io/en/data-policy                                                                </a>
                                                            </td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Host(s)</th>
                                                            <td>nexgeneerz.io, www.nexgeneerz.io</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>_icl_*, wpml_*, wp-wpml_*</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie lifetime</th>
                                                            <td>1 day</td>
                                                        </tr>
                                                                                                        </table>
                                                                                                <table>
                                                    
                                                    <tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                Google reCAPTCHA                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>Google Ireland Limited, Gordon House, Barrow Street, Dublin 4, Ireland</td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Cookie from Google for spam prevention (e.g. comments from bots).</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Data policy</th>
                                                            <td class="_brlbs-pp-url">
                                                                <a
                                                                    href="https://policies.google.com/privacy"
                                                                    target="_blank"
                                                                    rel="nofollow noopener noreferrer"
                                                                >
                                                                    https://policies.google.com/privacy                                                                </a>
                                                            </td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Host(s)</th>
                                                            <td>.recaptcha.net</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>_GRECAPTCHA</td>
                                                        </tr>
                                                        
                                                                                                    </table>
                                                                                        </div>
                                    </div>
                                                                                                                                                                                                        <div class="bcac-item">
                                        <div class="d-flex flex-row">
                                            <label class="w-75">
                                                <span role="heading" aria-level="4" class="_brlbs-h4">Statistics (1)</span>
                                            </label>

                                            <div class="w-25 text-right">
                                                                                                    <label class="_brlbs-btn-switch">
                                                        <span class="sr-only">Statistics</span>
                                                        <input
                                                            tabindex="0"
                                                            id="borlabs-cookie-group-statistics"
                                                            type="checkbox"
                                                            name="cookieGroup[]"
                                                            value="statistics"
                                                                                                                        data-borlabs-cookie-switch
                                                        />
                                                        <span class="_brlbs-slider"></span>
                                                        <span
                                                            class="_brlbs-btn-switch-status"
                                                            data-active="On"
                                                            data-inactive="Off">
                                                        </span>
                                                    </label>
                                                                                                </div>
                                        </div>

                                        <div class="d-block">
                                            <p>Statistics Cookies collect information anonymously. This information helps us to understand how our visitors use our website.</p>

                                            <p class="text-center">
                                                <a
                                                    href="#"
                                                    class="_brlbs-cursor d-block"
                                                    tabindex="0"
                                                    role="button"
                                                    data-cookie-accordion-target="statistics"
                                                >
                                                    <span data-cookie-accordion-status="show">
                                                        Show cookie information                                                    </span>

                                                    <span data-cookie-accordion-status="hide" class="borlabs-hide">
                                                        Hide cookie information                                                    </span>
                                                </a>
                                            </p>
                                        </div>

                                        <div
                                            class="borlabs-hide"
                                            data-cookie-accordion-parent="statistics"
                                        >
                                                                                            <table>
                                                                                                            <tr>
                                                            <th scope="row">Accept</th>
                                                            <td>
                                                                <label class="_brlbs-btn-switch _brlbs-btn-switch--textRight">
                                                                    <span class="sr-only">Matomo</span>
                                                                    <input
                                                                        id="borlabs-cookie-matomo"
                                                                        tabindex="0"
                                                                        type="checkbox" data-cookie-group="statistics"
                                                                        name="cookies[statistics][]"
                                                                        value="matomo"
                                                                                                                                                data-borlabs-cookie-switch
                                                                    />

                                                                    <span class="_brlbs-slider"></span>

                                                                    <span
                                                                        class="_brlbs-btn-switch-status"
                                                                        data-active="On"
                                                                        data-inactive="Off"
                                                                        aria-hidden="true">
                                                                    </span>
                                                                </label>
                                                            </td>
                                                        </tr>
                                                        
                                                    <tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                Matomo                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>beAnywhere</td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Cookie from Matomo for website analytics. Generates statistical data about how the visitor uses the website.</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Data policy</th>
                                                            <td class="_brlbs-pp-url">
                                                                <a
                                                                    href="https://nexgeneerz.io/en/data-policy"
                                                                    target="_blank"
                                                                    rel="nofollow noopener noreferrer"
                                                                >
                                                                    https://nexgeneerz.io/en/data-policy                                                                </a>
                                                            </td>
                                                        </tr>
                                                        
                                                    
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>_pk_*.*</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie lifetime</th>
                                                            <td>13 Monate</td>
                                                        </tr>
                                                                                                        </table>
                                                                                        </div>
                                    </div>
                                                                                                </fieldset>
                                        </div>

                <div class="d-flex justify-content-between">
                    <p class="_brlbs-branding flex-fill">
                                            </p>

                    <p class="_brlbs-legal flex-fill">
                                                    <a href="https://nexgeneerz.io/data-policy/">
                                Privacy policy                            </a>
                            
                                                    <span class="_brlbs-separator"></span>
                            
                                                    <a href="https://nexgeneerz.io/contact/">
                                Imprint                            </a>
                                                </p>
                </div>
            </div>
        </div>
    </div>
</div>
            </div>
        </div>
    </div>
</div></script><div id="BorlabsCookieBox" class="BorlabsCookie" role="dialog" aria-labelledby="CookieBoxTextHeadline" aria-describedby="CookieBoxTextDescription" aria-modal="false">
    <div class="bottom-right" style="display: none;">
        <div class="_brlbs-box-wrap">
            <div class="_brlbs-box _brlbs-box-advanced">
                <div class="cookie-box">
                    <div class="container">
                        <div class="row">
                            <div class="col-12">
                                <div class="_brlbs-flex-center">
                                    
                                    <span role="heading" aria-level="3" class="_brlbs-h3" id="CookieBoxTextHeadline">Our website uses cookies.</span>
                                </div>

                                <p id="CookieBoxTextDescription"><span class="_brlbs-paragraph _brlbs-text-description">We use cookies to provide you with a user-friendly, secure and effective website. For more information, please see our Privacy Policy or Cookie Details.</span></p>

                                                                    <fieldset>
                                        <legend class="sr-only">Our website uses cookies.</legend>
                                        <ul>
                                                                                                <li>
                                                        <label class="_brlbs-checkbox">
                                                            Essential                                                            <input id="checkbox-essential" tabindex="0" type="checkbox" name="cookieGroup[]" value="essential" checked="" disabled="" data-borlabs-cookie-checkbox="">
                                                            <span class="_brlbs-checkbox-indicator"></span>
                                                        </label>
                                                    </li>
                                                                                                    <li>
                                                        <label class="_brlbs-checkbox">
                                                            Statistics                                                            <input id="checkbox-statistics" tabindex="0" type="checkbox" name="cookieGroup[]" value="statistics" data-borlabs-cookie-checkbox="">
                                                            <span class="_brlbs-checkbox-indicator"></span>
                                                        </label>
                                                    </li>
                                                                                        </ul>
                                    </fieldset>

                                    
                                                                    <p class="_brlbs-accept">
                                        <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" tabindex="0" role="button" class="_brlbs-btn _brlbs-btn-accept-all _brlbs-cursor" data-cookie-accept-all="">
                                            Accept all                                        </a>
                                    </p>

                                    <p class="_brlbs-accept">
                                        <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" tabindex="0" role="button" id="CookieBoxSaveButton" class="_brlbs-btn _brlbs-cursor" data-cookie-accept="">
                                            Save settings                                        </a>
                                    </p>
                                
                                
                                <p class="_brlbs-manage ">
                                    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" class="_brlbs-cursor  " tabindex="0" role="button" data-cookie-individual="">
                                        Settings                                    </a>
                                </p>

                                <p class="_brlbs-legal">
                                    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" class="_brlbs-cursor" tabindex="0" role="button" data-cookie-individual="">
                                        Cookie details                                    </a>

                                                                            <span class="_brlbs-separator"></span>
                                        <a href="https://nexgeneerz.io/data-policy/" tabindex="0" role="button">
                                            Privacy policy                                        </a>
                                    
                                                                            <span class="_brlbs-separator"></span>
                                        <a href="https://nexgeneerz.io/contact/" tabindex="0" role="button">
                                            Imprint                                        </a>
                                                                    </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="cookie-preference" aria-hidden="true" role="dialog" aria-describedby="CookiePrefDescription" aria-modal="true">
    <div class="container not-visible">
        <div class="row no-gutters">
            <div class="col-12">
                <div class="row no-gutters align-items-top">
                    <div class="col-12">
                        <div class="_brlbs-flex-center">
                                                    <span role="heading" aria-level="3" class="_brlbs-h3">Privacy settings</span>
                        </div>

                        <p id="CookiePrefDescription">
                            <span class="_brlbs-paragraph _brlbs-text-description">Here you will find an overview of all cookies used. You can give your consent to whole categories or have further information displayed to you and thus select only certain cookies.</span>                        </p>

                        <div class="row no-gutters align-items-center">
                            <div class="col-12 col-sm-7">
                                <p class="_brlbs-accept">
                                                                            <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" class="_brlbs-btn _brlbs-btn-accept-all _brlbs-cursor" tabindex="0" role="button" data-cookie-accept-all="">
                                            Accept all                                        </a>
                                        
                                    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" id="CookiePrefSave" tabindex="0" role="button" class="_brlbs-btn _brlbs-cursor" data-cookie-accept="">
                                        Save settings                                    </a>

                                                                    </p>
                            </div>

                            <div class="col-12 col-sm-5">
                                <p class="_brlbs-refuse">
                                    <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" class="_brlbs-cursor" tabindex="0" role="button" data-cookie-back="">
                                        Back                                    </a>

                                                                    </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div data-cookie-accordion="">
                                            <fieldset>
                            <legend class="sr-only">Privacy settings</legend>

                                                                                                <div class="bcac-item">
                                        <div class="d-flex flex-row">
                                            <label class="w-75">
                                                <span role="heading" aria-level="4" class="_brlbs-h4">Essential (4)</span>
                                            </label>

                                            <div class="w-25 text-right">
                                                                                            </div>
                                        </div>

                                        <div class="d-block">
                                            <p>Essential cookies enable basic functions and are necessary for the proper functioning of the website.</p>

                                            <p class="text-center">
                                                <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" class="_brlbs-cursor d-block" tabindex="0" role="button" data-cookie-accordion-target="essential">
                                                    <span data-cookie-accordion-status="show">
                                                        Show cookie information                                                    </span>

                                                    <span data-cookie-accordion-status="hide" class="borlabs-hide">
                                                        Hide cookie information                                                    </span>
                                                </a>
                                            </p>
                                        </div>

                                        <div class="borlabs-hide" data-cookie-accordion-parent="essential">
                                                                                            <table>
                                                    
                                                    <tbody><tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                Borlabs Cookie                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>Eigentümer dieser Website<span>, </span><a href="https://nexgeneerz.io/contact/">Imprint</a></td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Speichert die Einstellungen der Besucher, die in der Cookie Box von Borlabs Cookie ausgewählt wurden.</td>
                                                        </tr>
                                                        
                                                    
                                                    
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>borlabs-cookie</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie lifetime</th>
                                                            <td>1 Jahr</td>
                                                        </tr>
                                                                                                        </tbody></table>
                                                                                                <table>
                                                    
                                                    <tbody><tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                Post Views Counter                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>Owner of this website</td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Simple count of unique users, recognized by a cookie set by us. No data such as IP addresses or similar are stored here.</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Data policy</th>
                                                            <td class="_brlbs-pp-url">
                                                                <a href="https://nexgeneerz.io/en/data-policy" target="_blank" rel="nofollow noopener noreferrer">
                                                                    https://nexgeneerz.io/en/data-policy                                                                </a>
                                                            </td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Host(s)</th>
                                                            <td>nexgeneerz.io, www.nexgeneerz.io</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>pvc_visits[0]</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie lifetime</th>
                                                            <td>1 day</td>
                                                        </tr>
                                                                                                        </tbody></table>
                                                                                                <table>
                                                    
                                                    <tbody><tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                WPML                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>Owner of this website</td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Saves the current language.</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Data policy</th>
                                                            <td class="_brlbs-pp-url">
                                                                <a href="https://nexgeneerz.io/en/data-policy" target="_blank" rel="nofollow noopener noreferrer">
                                                                    https://nexgeneerz.io/en/data-policy                                                                </a>
                                                            </td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Host(s)</th>
                                                            <td>nexgeneerz.io, www.nexgeneerz.io</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>_icl_*, wpml_*, wp-wpml_*</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie lifetime</th>
                                                            <td>1 day</td>
                                                        </tr>
                                                                                                        </tbody></table>
                                                                                                <table>
                                                    
                                                    <tbody><tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                Google reCAPTCHA                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>Google Ireland Limited, Gordon House, Barrow Street, Dublin 4, Ireland</td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Cookie from Google for spam prevention (e.g. comments from bots).</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Data policy</th>
                                                            <td class="_brlbs-pp-url">
                                                                <a href="https://policies.google.com/privacy" target="_blank" rel="nofollow noopener noreferrer">
                                                                    https://policies.google.com/privacy                                                                </a>
                                                            </td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Host(s)</th>
                                                            <td>.recaptcha.net</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>_GRECAPTCHA</td>
                                                        </tr>
                                                        
                                                                                                    </tbody></table>
                                                                                        </div>
                                    </div>
                                                                                                                                                                                                        <div class="bcac-item">
                                        <div class="d-flex flex-row">
                                            <label class="w-75">
                                                <span role="heading" aria-level="4" class="_brlbs-h4">Statistics (1)</span>
                                            </label>

                                            <div class="w-25 text-right">
                                                                                                    <label class="_brlbs-btn-switch">
                                                        <span class="sr-only">Statistics</span>
                                                        <input tabindex="0" id="borlabs-cookie-group-statistics" type="checkbox" name="cookieGroup[]" value="statistics" data-borlabs-cookie-switch="">
                                                        <span class="_brlbs-slider"></span>
                                                        <span class="_brlbs-btn-switch-status" data-active="On" data-inactive="Off">
                                                        </span>
                                                    </label>
                                                                                                </div>
                                        </div>

                                        <div class="d-block">
                                            <p>Statistics Cookies collect information anonymously. This information helps us to understand how our visitors use our website.</p>

                                            <p class="text-center">
                                                <a href="https://nexgeneerz.io/aws-computing-with-ecs-ec2-terraform/#" class="_brlbs-cursor d-block" tabindex="0" role="button" data-cookie-accordion-target="statistics">
                                                    <span data-cookie-accordion-status="show">
                                                        Show cookie information                                                    </span>

                                                    <span data-cookie-accordion-status="hide" class="borlabs-hide">
                                                        Hide cookie information                                                    </span>
                                                </a>
                                            </p>
                                        </div>

                                        <div class="borlabs-hide" data-cookie-accordion-parent="statistics">
                                                                                            <table>
                                                                                                            <tbody><tr>
                                                            <th scope="row">Accept</th>
                                                            <td>
                                                                <label class="_brlbs-btn-switch _brlbs-btn-switch--textRight">
                                                                    <span class="sr-only">Matomo</span>
                                                                    <input id="borlabs-cookie-matomo" tabindex="0" type="checkbox" data-cookie-group="statistics" name="cookies[statistics][]" value="matomo" data-borlabs-cookie-switch="">

                                                                    <span class="_brlbs-slider"></span>

                                                                    <span class="_brlbs-btn-switch-status" data-active="On" data-inactive="Off" aria-hidden="true">
                                                                    </span>
                                                                </label>
                                                            </td>
                                                        </tr>
                                                        
                                                    <tr>
                                                        <th scope="row">Name</th>
                                                        <td>
                                                            <label>
                                                                Matomo                                                            </label>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <th scope="row">Provider</th>
                                                        <td>beAnywhere</td>
                                                    </tr>

                                                                                                            <tr>
                                                            <th scope="row">Reason</th>
                                                            <td>Cookie from Matomo for website analytics. Generates statistical data about how the visitor uses the website.</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Data policy</th>
                                                            <td class="_brlbs-pp-url">
                                                                <a href="https://nexgeneerz.io/en/data-policy" target="_blank" rel="nofollow noopener noreferrer">
                                                                    https://nexgeneerz.io/en/data-policy                                                                </a>
                                                            </td>
                                                        </tr>
                                                        
                                                    
                                                                                                            <tr>
                                                            <th scope="row">Cookie name</th>
                                                            <td>_pk_*.*</td>
                                                        </tr>
                                                        
                                                                                                            <tr>
                                                            <th scope="row">Cookie lifetime</th>
                                                            <td>13 Monate</td>
                                                        </tr>
                                                                                                        </tbody></table>
                                                                                        </div>
                                    </div>
                                                                                                </fieldset>
                                        </div>

                <div class="d-flex justify-content-between">
                    <p class="_brlbs-branding flex-fill">
                                            </p>

                    <p class="_brlbs-legal flex-fill">
                                                    <a href="https://nexgeneerz.io/data-policy/">
                                Privacy policy                            </a>
                            
                                                    <span class="_brlbs-separator"></span>
                            
                                                    <a href="https://nexgeneerz.io/contact/">
                                Imprint                            </a>
                                                </p>
                </div>
            </div>
        </div>
    </div>
</div>
            </div>
        </div>
    </div>
</div></div> <script></script> <script data-no-optimize="1">!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).LazyLoad=e()}(this,function(){"use strict";function e(){return(e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n,a=arguments[e];for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t}).apply(this,arguments)}function i(t){return e({},it,t)}function o(t,e){var n,a="LazyLoad::Initialized",i=new t(e);try{n=new CustomEvent(a,{detail:{instance:i}})}catch(t){(n=document.createEvent("CustomEvent")).initCustomEvent(a,!1,!1,{instance:i})}window.dispatchEvent(n)}function l(t,e){return t.getAttribute(gt+e)}function c(t){return l(t,bt)}function s(t,e){return function(t,e,n){e=gt+e;null!==n?t.setAttribute(e,n):t.removeAttribute(e)}(t,bt,e)}function r(t){return s(t,null),0}function u(t){return null===c(t)}function d(t){return c(t)===vt}function f(t,e,n,a){t&&(void 0===a?void 0===n?t(e):t(e,n):t(e,n,a))}function _(t,e){nt?t.classList.add(e):t.className+=(t.className?" ":"")+e}function v(t,e){nt?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")}function g(t){return t.llTempImage}function b(t,e){!e||(e=e._observer)&&e.unobserve(t)}function p(t,e){t&&(t.loadingCount+=e)}function h(t,e){t&&(t.toLoadCount=e)}function n(t){for(var e,n=[],a=0;e=t.children[a];a+=1)"SOURCE"===e.tagName&&n.push(e);return n}function m(t,e){(t=t.parentNode)&&"PICTURE"===t.tagName&&n(t).forEach(e)}function a(t,e){n(t).forEach(e)}function E(t){return!!t[st]}function I(t){return t[st]}function y(t){return delete t[st]}function A(e,t){var n;E(e)||(n={},t.forEach(function(t){n[t]=e.getAttribute(t)}),e[st]=n)}function k(a,t){var i;E(a)&&(i=I(a),t.forEach(function(t){var e,n;e=a,(t=i[n=t])?e.setAttribute(n,t):e.removeAttribute(n)}))}function L(t,e,n){_(t,e.class_loading),s(t,ut),n&&(p(n,1),f(e.callback_loading,t,n))}function w(t,e,n){n&&t.setAttribute(e,n)}function x(t,e){w(t,ct,l(t,e.data_sizes)),w(t,rt,l(t,e.data_srcset)),w(t,ot,l(t,e.data_src))}function O(t,e,n){var a=l(t,e.data_bg_multi),i=l(t,e.data_bg_multi_hidpi);(a=at&&i?i:a)&&(t.style.backgroundImage=a,n=n,_(t=t,(e=e).class_applied),s(t,ft),n&&(e.unobserve_completed&&b(t,e),f(e.callback_applied,t,n)))}function N(t,e){!e||0<e.loadingCount||0<e.toLoadCount||f(t.callback_finish,e)}function C(t,e,n){t.addEventListener(e,n),t.llEvLisnrs[e]=n}function M(t){return!!t.llEvLisnrs}function z(t){if(M(t)){var e,n,a=t.llEvLisnrs;for(e in a){var i=a[e];n=e,i=i,t.removeEventListener(n,i)}delete t.llEvLisnrs}}function R(t,e,n){var a;delete t.llTempImage,p(n,-1),(a=n)&&--a.toLoadCount,v(t,e.class_loading),e.unobserve_completed&&b(t,n)}function T(o,r,c){var l=g(o)||o;M(l)||function(t,e,n){M(t)||(t.llEvLisnrs={});var a="VIDEO"===t.tagName?"loadeddata":"load";C(t,a,e),C(t,"error",n)}(l,function(t){var e,n,a,i;n=r,a=c,i=d(e=o),R(e,n,a),_(e,n.class_loaded),s(e,dt),f(n.callback_loaded,e,a),i||N(n,a),z(l)},function(t){var e,n,a,i;n=r,a=c,i=d(e=o),R(e,n,a),_(e,n.class_error),s(e,_t),f(n.callback_error,e,a),i||N(n,a),z(l)})}function G(t,e,n){var a,i,o,r,c;t.llTempImage=document.createElement("IMG"),T(t,e,n),E(c=t)||(c[st]={backgroundImage:c.style.backgroundImage}),o=n,r=l(a=t,(i=e).data_bg),c=l(a,i.data_bg_hidpi),(r=at&&c?c:r)&&(a.style.backgroundImage='url("'.concat(r,'")'),g(a).setAttribute(ot,r),L(a,i,o)),O(t,e,n)}function D(t,e,n){var a;T(t,e,n),a=e,e=n,(t=It[(n=t).tagName])&&(t(n,a),L(n,a,e))}function V(t,e,n){var a;a=t,(-1<yt.indexOf(a.tagName)?D:G)(t,e,n)}function F(t,e,n){var a;t.setAttribute("loading","lazy"),T(t,e,n),a=e,(e=It[(n=t).tagName])&&e(n,a),s(t,vt)}function j(t){t.removeAttribute(ot),t.removeAttribute(rt),t.removeAttribute(ct)}function P(t){m(t,function(t){k(t,Et)}),k(t,Et)}function S(t){var e;(e=At[t.tagName])?e(t):E(e=t)&&(t=I(e),e.style.backgroundImage=t.backgroundImage)}function U(t,e){var n;S(t),n=e,u(e=t)||d(e)||(v(e,n.class_entered),v(e,n.class_exited),v(e,n.class_applied),v(e,n.class_loading),v(e,n.class_loaded),v(e,n.class_error)),r(t),y(t)}function $(t,e,n,a){var i;n.cancel_on_exit&&(c(t)!==ut||"IMG"===t.tagName&&(z(t),m(i=t,function(t){j(t)}),j(i),P(t),v(t,n.class_loading),p(a,-1),r(t),f(n.callback_cancel,t,e,a)))}function q(t,e,n,a){var i,o,r=(o=t,0<=pt.indexOf(c(o)));s(t,"entered"),_(t,n.class_entered),v(t,n.class_exited),i=t,o=a,n.unobserve_entered&&b(i,o),f(n.callback_enter,t,e,a),r||V(t,n,a)}function H(t){return t.use_native&&"loading"in HTMLImageElement.prototype}function B(t,i,o){t.forEach(function(t){return(a=t).isIntersecting||0<a.intersectionRatio?q(t.target,t,i,o):(e=t.target,n=t,a=i,t=o,void(u(e)||(_(e,a.class_exited),$(e,n,a,t),f(a.callback_exit,e,n,t))));var e,n,a})}function J(e,n){var t;et&&!H(e)&&(n._observer=new IntersectionObserver(function(t){B(t,e,n)},{root:(t=e).container===document?null:t.container,rootMargin:t.thresholds||t.threshold+"px"}))}function K(t){return Array.prototype.slice.call(t)}function Q(t){return t.container.querySelectorAll(t.elements_selector)}function W(t){return c(t)===_t}function X(t,e){return e=t||Q(e),K(e).filter(u)}function Y(e,t){var n;(n=Q(e),K(n).filter(W)).forEach(function(t){v(t,e.class_error),r(t)}),t.update()}function t(t,e){var n,a,t=i(t);this._settings=t,this.loadingCount=0,J(t,this),n=t,a=this,Z&&window.addEventListener("online",function(){Y(n,a)}),this.update(e)}var Z="undefined"!=typeof window,tt=Z&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),et=Z&&"IntersectionObserver"in window,nt=Z&&"classList"in document.createElement("p"),at=Z&&1<window.devicePixelRatio,it={elements_selector:".lazy",container:tt||Z?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_poster:"poster",class_applied:"applied",class_loading:"litespeed-loading",class_loaded:"litespeed-loaded",class_error:"error",class_entered:"entered",class_exited:"exited",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1},ot="src",rt="srcset",ct="sizes",lt="poster",st="llOriginalAttrs",ut="loading",dt="loaded",ft="applied",_t="error",vt="native",gt="data-",bt="ll-status",pt=[ut,dt,ft,_t],ht=[ot],mt=[ot,lt],Et=[ot,rt,ct],It={IMG:function(t,e){m(t,function(t){A(t,Et),x(t,e)}),A(t,Et),x(t,e)},IFRAME:function(t,e){A(t,ht),w(t,ot,l(t,e.data_src))},VIDEO:function(t,e){a(t,function(t){A(t,ht),w(t,ot,l(t,e.data_src))}),A(t,mt),w(t,lt,l(t,e.data_poster)),w(t,ot,l(t,e.data_src)),t.load()}},yt=["IMG","IFRAME","VIDEO"],At={IMG:P,IFRAME:function(t){k(t,ht)},VIDEO:function(t){a(t,function(t){k(t,ht)}),k(t,mt),t.load()}},kt=["IMG","IFRAME","VIDEO"];return t.prototype={update:function(t){var e,n,a,i=this._settings,o=X(t,i);{if(h(this,o.length),!tt&&et)return H(i)?(e=i,n=this,o.forEach(function(t){-1!==kt.indexOf(t.tagName)&&F(t,e,n)}),void h(n,0)):(t=this._observer,i=o,t.disconnect(),a=t,void i.forEach(function(t){a.observe(t)}));this.loadAll(o)}},destroy:function(){this._observer&&this._observer.disconnect(),Q(this._settings).forEach(function(t){y(t)}),delete this._observer,delete this._settings,delete this.loadingCount,delete this.toLoadCount},loadAll:function(t){var e=this,n=this._settings;X(t,n).forEach(function(t){b(t,e),V(t,n,e)})},restoreAll:function(){var e=this._settings;Q(e).forEach(function(t){U(t,e)})}},t.load=function(t,e){e=i(e);V(t,e)},t.resetStatus=function(t){r(t)},Z&&function(t,e){if(e)if(e.length)for(var n,a=0;n=e[a];a+=1)o(t,n);else o(t,e)}(t,window.lazyLoadOptions),t});!function(e,t){"use strict";function a(){t.body.classList.add("litespeed_lazyloaded")}function n(){console.log("[LiteSpeed] Start Lazy Load Images"),d=new LazyLoad({elements_selector:"[data-lazyloaded]",callback_finish:a}),o=function(){d.update()},e.MutationObserver&&new MutationObserver(o).observe(t.documentElement,{childList:!0,subtree:!0,attributes:!0})}var d,o;e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent("onload",n)}(window,document);</script><script data-optimized="1" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/3aed0b9471b77459078761339b867f6f.js"></script>


<progress value="960" id="reading-position-indicator" class="solid  position-bottom" max="37686.25"><div class="progress-container"><span class="progress-bar"></span></div></progress><div style="background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); box-shadow: rgba(0, 0, 0, 0.2) 2px 2px 3px; position: absolute; transition: visibility 0s linear 0.3s, opacity 0.3s linear 0s; opacity: 0; visibility: hidden; z-index: 2000000000; left: 0px; top: -10000px;"><div style="width: 100%; height: 100%; position: fixed; top: 0px; left: 0px; z-index: 2000000000; background-color: rgb(255, 255, 255); opacity: 0.05;"></div><div class="g-recaptcha-bubble-arrow" style="border: 11px solid transparent; width: 0px; height: 0px; position: absolute; pointer-events: none; margin-top: -11px; z-index: 2000000000;"></div><div class="g-recaptcha-bubble-arrow" style="border: 10px solid transparent; width: 0px; height: 0px; position: absolute; pointer-events: none; margin-top: -10px; z-index: 2000000000;"></div><div style="z-index: 2000000000; position: relative;"><iframe title="recaptcha challenge expires in two minutes" name="c-udekmzl9acq1" frameborder="0" scrolling="no" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-top-navigation allow-modals allow-popups-to-escape-sandbox allow-storage-access-by-user-activation" src="./How to setup ECS EC2 with Terraform — Tutorial by nexgeneerz_files/bframe.html" style="width: 100%; height: 100%;"></iframe></div></div></body></html>